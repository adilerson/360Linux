(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8789],{8789:(Fe,G,M)=>{"use strict";M.r(G),M.d(G,{CapacitorVideoPlayerWeb:()=>R});var S=M(5861),C=M(7423),O=M(2070),A=M.n(O);class b{constructor(v,E,o,x,p,T,y,d,e,a){this.pipMode=!1,this._videoType=null,this._videoContainer=null,this._firstReadyToPlay=!0,this._isEnded=!1,this._videoRate=1,this._videoExitOnEnd=!0,this._videoLoopOnEnd=!1,this._url=E,this._container=y,this._mode=v,this._width=e||320,this._height=a||180,this._mode=v,this._videoRate=x,this._zIndex=d||1,this._playerId=o,this._videoExitOnEnd=p,this._videoLoopOnEnd=T}initialize(){var v=this;return(0,S.Z)(function*(){if(v._getVideoType()){"fullscreen"===v._mode&&(v._container.style.position="absolute",v._container.style.width="100vw",v._container.style.height="100vh"),"embedded"===v._mode&&(v._container.style.position="relative",v._container.style.width=v._width.toString()+"px",v._container.style.height=v._height.toString()+"px"),v._container.style.left="0",v._container.style.top="0",v._container.style.display="flex",v._container.style.alignItems="center",v._container.style.justifyContent="center",v._container.style.backgroundColor="#000000",v._container.style.zIndex=v._zIndex.toString();const o="fullscreen"===v._mode?window.innerWidth:v._width,x="fullscreen"===v._mode?window.innerHeight:v._height,p="http://www.w3.org/2000/svg",T=document.createElementNS(p,"svg");T.setAttributeNS(null,"width",o.toString()),T.setAttributeNS(null,"height",x.toString());const y="0 0 "+o.toString()+" "+x.toString();T.setAttributeNS(null,"viewBox",y),T.style.zIndex=(v._zIndex+1).toString();const d=document.createElementNS(p,"rect");d.setAttributeNS(null,"x","0"),d.setAttributeNS(null,"y","0"),d.setAttributeNS(null,"width",o.toString()),d.setAttributeNS(null,"height",x.toString()),d.setAttributeNS(null,"fill","#000000"),T.appendChild(d),v._container.appendChild(T);const e=o*v._height/v._width;v._videoContainer=document.createElement("div"),v._videoContainer.style.position="absolute",v._videoContainer.style.left="0",v._videoContainer.style.width=o.toString()+"px",v._videoContainer.style.height=e.toString()+"px",v._videoContainer.style.zIndex=(v._zIndex+2).toString(),v._container.appendChild(v._videoContainer),(yield v.createVideoElement(o,e))||v._createEvent("Exit",v._playerId,"Video Error: failed to create the Video Element")}else v._createEvent("Exit",v._playerId,"Url Error: type not supported")})()}createVideoElement(v,E){var o=this;return(0,S.Z)(function*(){o.videoEl=document.createElement("video"),o.videoEl.controls=!0,o.videoEl.style.zIndex=(o._zIndex+3).toString(),o.videoEl.style.width=`${v.toString()}px`,o.videoEl.style.height=`${E.toString()}px`,o.videoEl.playbackRate=o._videoRate,o._videoContainer.appendChild(o.videoEl);const x=yield o._setPlayer();if(x&&(o.videoEl.onended=(0,S.Z)(function*(){o._isEnded=!0,o.isPlaying=!1,o.videoEl&&(o.videoEl.currentTime=0),o._videoExitOnEnd?("fullscreen"===o._mode&&o._closeFullscreen(),o._createEvent("Ended",o._playerId)):o._videoLoopOnEnd&&null!=o.videoEl&&(yield o.videoEl.play())}),o.videoEl.oncanplay=(0,S.Z)(function*(){o._firstReadyToPlay&&(o._createEvent("Ready",o._playerId),null!=o.videoEl&&(o.videoEl.muted=!1,"fullscreen"===o._mode&&(yield o.videoEl.play()),o._firstReadyToPlay=!1))}),o.videoEl.onplay=()=>{o.isPlaying=!0,o._firstReadyToPlay&&(o._firstReadyToPlay=!1),o._createEvent("Play",o._playerId)},o.videoEl.onplaying=()=>{o._createEvent("Playing",o._playerId)},o.videoEl.onpause=()=>{o.isPlaying=!1,o._createEvent("Pause",o._playerId)},"fullscreen"===o._mode)){const p=document.createElement("button");p.textContent="X",p.style.position="absolute",p.style.left="1%",p.style.top="5%",p.style.width="5vmin",p.style.padding="0.5%",p.style.fontSize="1.2rem",p.style.background="rgba(51,51,51,.4)",p.style.color="#fff",p.style.visibility="hidden",p.style.zIndex=(o._zIndex+4).toString(),p.style.border="1px solid rgba(51,51,51,.4)",p.style.borderRadius="20px",o._videoContainer.onclick=(0,S.Z)(function*(){o._initial=yield o._doHide(p,3e3)}),o._videoContainer.ontouchstart=(0,S.Z)(function*(){o._initial=yield o._doHide(p,3e3)}),o._videoContainer.onmousemove=(0,S.Z)(function*(){o._initial=yield o._doHide(p,3e3)}),p.onclick=()=>{o._createEvent("Exit",o._playerId)},p.ontouchstart=()=>{o._createEvent("Exit",o._playerId)},o._videoContainer.appendChild(p),o._initial=yield o._doHide(p,3e3),o._goFullscreen()}return x})()}_goFullscreen(){var v=this;return(0,S.Z)(function*(){v._container.mozRequestFullScreen?v._container.mozRequestFullScreen():v._container.webkitRequestFullscreen?v._container.webkitRequestFullscreen():v._container.msRequestFullscreen?v._container.msRequestFullscreen():v._container.requestFullscreen&&v._container.requestFullscreen()})()}_setPlayer(){var v=this;return(0,S.Z)(function*(){return new Promise(E=>{if(null!=v.videoEl){if(A().isSupported()&&"application/x-mpegURL"===v._videoType){const o=new(A());o.loadSource(v._url),o.attachMedia(v.videoEl),o.on(A().Events.MANIFEST_PARSED,()=>{null!=v.videoEl?(v.videoEl.muted=!0,v.videoEl.crossOrigin="anonymous",E(!0)):E(!1)})}else"video/mp4"===v._videoType?(v.videoEl.src=v._url,"https"!=v._url.substring(0,5)&&"http"===v._url.substring(0,4)&&(v.videoEl.crossOrigin="anonymous"),("https"===v._url.substring(0,5)||"http"===v._url.substring(0,4))&&(v.videoEl.muted=!0),E(!0)):E(!1);v.videoEl.addEventListener("enterpictureinpicture",o=>{v.pipWindow=o.pictureInPictureWindow,console.log(" Enter PiP Mode ",v.pipWindow),v.pipMode=!0,v._closeFullscreen()}),v.videoEl.addEventListener("leavepictureinpicture",()=>{console.log(" Exit PiP Mode "),v.pipMode=!1,v._isEnded||(v._goFullscreen(),null!=v.videoEl&&v.videoEl.play())})}else E(!1)})})()}_getVideoType(){let v=!1,E="";const o=this._url?this._url:"";if(null!=o&&o.length>0)try{if(null==o.substring(o.lastIndexOf("/")).match(/(.*)\.(.*)/))E="";else{const p=o.match(/(.*)\.(.*)/);E=null!=p?p[2].split("?")[0]:""}switch(E){case"mp4":case"":case"webm":case"cmaf":case"cmfv":case"cmfa":this._videoType="video/mp4";break;case"m3u8":this._videoType="application/x-mpegURL";break;default:this._videoType=null}v=!0}catch(x){v=!1}return v}_doHide(v,E){var o=this;return(0,S.Z)(function*(){return clearTimeout(o._initial),v.style.visibility="visible",setTimeout(()=>{v.style.visibility="hidden"},E)})()}_createEvent(v,E,o){const x=o||null;let p;p=null!=x?new CustomEvent(`videoPlayer${v}`,{detail:{fromPlayerId:E,message:x}}):new CustomEvent(`videoPlayer${v}`,{detail:{fromPlayerId:E,currentTime:this.videoEl?this.videoEl.currentTime:0}}),this._container.dispatchEvent(p)}_closeFullscreen(){const v=document;(v.fullscreenElement&&null!==v.fullscreenElement||v.webkitFullscreenElement&&null!==v.webkitFullscreenElement||v.mozFullScreenElement&&null!==v.mozFullScreenElement||v.msFullscreenElement&&null!==v.msFullscreenElement)&&(v.mozCancelFullScreen?v.mozCancelFullScreen():v.webkitExitFullscreen?v.webkitExitFullscreen():v.msExitFullscreen?v.msExitFullscreen():v.exitFullscreen&&v.exitFullscreen())}}class R extends C.Uw{constructor(){super(...arguments),this._players=[]}echo(v){return(0,S.Z)(function*(){return console.log("ECHO",v),Promise.resolve({result:!0,method:"echo",value:v})})()}initPlayer(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a capVideoPlayerOptions object"});const o=v.mode?v.mode:"";if(null==o||0===o.length)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Mode (fullscreen/embedded)"});if("fullscreen"===o||"embedded"===o){const x=v.url?v.url:"";if(null==x||0===x.length)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Video Url"});if("internal"==x)return Promise.resolve({result:!1,method:"initPlayer",message:"Internal Videos not supported on Web Platform"});const p=v.playerId?v.playerId:"";if(null==p||0===p.length)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Player Id"});const T=v.rate?v.rate:1;let y=!0;if(Object.keys(v).includes("exitOnEnd")){const m=v.exitOnEnd;y=null==m||m}let d=!1;if(Object.keys(v).includes("loopOnEnd")&&!y){const m=v.loopOnEnd;d=null!=m&&m}const e=v.componentTag?v.componentTag:"";if(null==e||0===e.length)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Component Tag"});let a=null;"embedded"===o&&(a=E.checkSize(v));const h=yield E._initializeVideoPlayer(x,p,o,T,y,d,e,a);return Promise.resolve({result:h})}return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Mode either fullscreen or embedded)"})})()}isPlaying(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"isPlaying",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"isPlaying",result:!0,value:E._players[o].isPlaying}:{method:"isPlaying",result:!1,message:"Given PlayerId does not exist)"})})()}play(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"play",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),E._players[o]?(yield E._players[o].videoEl.play(),Promise.resolve({method:"play",result:!0,value:!0})):Promise.resolve({method:"play",result:!1,message:"Given PlayerId does not exist)"})})()}pause(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"pause",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),E._players[o]?(E._players[o].isPlaying&&(yield E._players[o].videoEl.pause()),Promise.resolve({method:"pause",result:!0,value:!0})):Promise.resolve({method:"pause",result:!1,message:"Given PlayerId does not exist)"})})()}getDuration(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"getDuration",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"getDuration",result:!0,value:E._players[o].videoEl.duration}:{method:"getDuration",result:!1,message:"Given PlayerId does not exist)"})})()}setRate(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"setRate",message:"Must provide a capVideoRateOptions object"});let o=v.playerId?v.playerId:"";(null==o||0===o.length)&&(o="fullscreen"),console.log(`>>> in plugin options.rate: ${v.rate}`);const p=v.rate&&[.25,.5,.75,1,2,4].includes(v.rate)?v.rate:1;return console.log(`>>> in plugin rate: ${p}`),E._players[o]?(E._players[o].videoEl.playbackRate=p,Promise.resolve({method:"setRate",result:!0,value:p})):Promise.resolve({method:"setRate",result:!1,message:"Given PlayerId does not exist)"})})()}getRate(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"getRate",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"getRate",result:!0,value:E._players[o].videoEl.playbackRate}:{method:"getRate",result:!1,message:"Given PlayerId does not exist)"})})()}setVolume(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"setVolume",message:"Must provide a capVideoVolumeOptions object"});let o=v.playerId?v.playerId:"";(null==o||0===o.length)&&(o="fullscreen");const x=v.volume?v.volume:.5;return E._players[o]?(E._players[o].videoEl.volume=x,Promise.resolve({method:"setVolume",result:!0,value:x})):Promise.resolve({method:"setVolume",result:!1,message:"Given PlayerId does not exist)"})})()}getVolume(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"getVolume",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"getVolume",result:!0,value:E._players[o].videoEl.volume}:{method:"getVolume",result:!1,message:"Given PlayerId does not exist)"})})()}setMuted(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"setMuted",message:"Must provide a capVideoMutedOptions object"});let o=v.playerId?v.playerId:"";(null==o||0===o.length)&&(o="fullscreen");const x=!!v.muted&&v.muted;return E._players[o]?(E._players[o].videoEl.muted=x,Promise.resolve({method:"setMuted",result:!0,value:x})):Promise.resolve({method:"setMuted",result:!1,message:"Given PlayerId does not exist)"})})()}getMuted(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"getMuted",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"getMuted",result:!0,value:E._players[o].videoEl.muted}:{method:"getMuted",result:!1,message:"Given PlayerId does not exist)"})})()}setCurrentTime(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"setCurrentTime",message:"Must provide a capVideoTimeOptions object"});let o=v.playerId?v.playerId:"";(null==o||0===o.length)&&(o="fullscreen");let x=v.seektime?v.seektime:0;if(E._players[o]){const p=E._players[o].videoEl.duration;return x=x<=p&&x>=0?x:p/2,E._players[o].videoEl.currentTime=x,Promise.resolve({method:"setCurrentTime",result:!0,value:x})}return Promise.resolve({method:"setCurrentTime",result:!1,message:"Given PlayerId does not exist)"})})()}getCurrentTime(v){var E=this;return(0,S.Z)(function*(){if(null==v)return Promise.resolve({result:!1,method:"getCurrentTime",message:"Must provide a capVideoPlayerIdOptions object"});let o=v.playerId?v.playerId:"";return(null==o||0===o.length)&&(o="fullscreen"),Promise.resolve(E._players[o]?{method:"getCurrentTime",result:!0,value:E._players[o].videoEl.currentTime}:{method:"getCurrentTime",result:!1,message:"Given PlayerId does not exist)"})})()}stopAllPlayers(){var v=this;return(0,S.Z)(function*(){for(const E in v._players){if(v._players[E].pipMode){const o=document;o.pictureInPictureElement&&(yield o.exitPictureInPicture())}v._players[E].videoEl.paused||v._players[E].videoEl.pause()}return Promise.resolve({method:"stopAllPlayers",result:!0,value:!0})})()}checkSize(v){const E={width:v.width?v.width:320,height:v.height?v.height:180},o=E.height/E.width;return E.width>window.innerWidth&&(E.width=window.innerWidth,E.height=Math.floor(E.width*o)),E.height>window.innerHeight&&(E.height=window.innerHeight,E.width=Math.floor(E.height/o)),E}_initializeVideoPlayer(v,E,o,x,p,T,y,d){var e=this;return(0,S.Z)(function*(){const a=v?-1==v.indexOf("%2F")?encodeURI(v):v:null;if(null===a)return Promise.resolve(!1);const h=yield e._getContainerElement(E,y);if(null===h)return Promise.resolve({method:"initPlayer",result:!1,message:"componentTag or divContainerElement must be provided"});if("embedded"===o&&null==d)return Promise.resolve({method:"initPlayer",result:!1,message:"playerSize must be defined in embedded mode"});if(h.addEventListener("videoPlayerPlay",m=>{e.handlePlayerPlay(m.detail)}),h.addEventListener("videoPlayerPause",m=>{e.handlePlayerPause(m.detail)}),h.addEventListener("videoPlayerEnded",m=>{"fullscreen"===o&&h.remove(),e.handlePlayerEnded(m.detail)}),h.addEventListener("videoPlayerReady",m=>{e.handlePlayerReady(m.detail)}),h.addEventListener("videoPlayerExit",()=>{"fullscreen"===o&&h.remove(),e.handlePlayerExit()}),"embedded"===o)e._players[E]=new b("embedded",a,E,x,p,T,h,2,d.width,d.height),yield e._players[E].initialize();else{if("fullscreen"!==o)return Promise.resolve({method:"initPlayer",result:!1,message:"mode not supported"});e._players.fullscreen=new b("fullscreen",a,"fullscreen",x,p,T,h,99995),yield e._players.fullscreen.initialize()}return Promise.resolve({method:"initPlayer",result:!0,value:!0})})()}_getContainerElement(v,E){return(0,S.Z)(function*(){const o=document.createElement("div");if(o.id=`vc_${v}`,null!=E&&E.length>0){const x=document.querySelector(`${E}`);if(null===x)return Promise.resolve(null);let p=null;const T=x.shadowRoot?x.shadowRoot:null;return p=null!=T?T.querySelector(`[id='${v}']`):x.querySelector(`[id='${v}']`),null!=p&&p.appendChild(o),Promise.resolve(o)}return Promise.resolve(null)})()}handlePlayerPlay(v){this.notifyListeners("jeepCapVideoPlayerPlay",v)}handlePlayerPause(v){this.notifyListeners("jeepCapVideoPlayerPause",v)}handlePlayerEnded(v){this.notifyListeners("jeepCapVideoPlayerEnded",v)}handlePlayerExit(){this.notifyListeners("jeepCapVideoPlayerExit",{dismiss:!0})}handlePlayerReady(v){this.notifyListeners("jeepCapVideoPlayerReady",v)}}},2070:function(Fe){"undefined"!=typeof window&&(Fe.exports=function(G){var M={};function S(C){if(M[C])return M[C].exports;var O=M[C]={i:C,l:!1,exports:{}};return G[C].call(O.exports,O,O.exports,S),O.l=!0,O.exports}return S.m=G,S.c=M,S.d=function(C,O,A){S.o(C,O)||Object.defineProperty(C,O,{enumerable:!0,get:A})},S.r=function(C){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(C,"__esModule",{value:!0})},S.t=function(C,O){if(1&O&&(C=S(C)),8&O||4&O&&"object"==typeof C&&C&&C.__esModule)return C;var A=Object.create(null);if(S.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:C}),2&O&&"string"!=typeof C)for(var b in C)S.d(A,b,function(R){return C[R]}.bind(null,b));return A},S.n=function(C){var O=C&&C.__esModule?function(){return C.default}:function(){return C};return S.d(O,"a",O),O},S.o=function(C,O){return Object.prototype.hasOwnProperty.call(C,O)},S.p="/dist/",S(S.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(G,M,S){"use strict";var C=Object.prototype.hasOwnProperty,O="~";function A(){}function b(E,o,x){this.fn=E,this.context=o,this.once=x||!1}function R(E,o,x,p,T){if("function"!=typeof x)throw new TypeError("The listener must be a function");var y=new b(x,p||E,T),d=O?O+o:o;return E._events[d]?E._events[d].fn?E._events[d]=[E._events[d],y]:E._events[d].push(y):(E._events[d]=y,E._eventsCount++),E}function I(E,o){0==--E._eventsCount?E._events=new A:delete E._events[o]}function v(){this._events=new A,this._eventsCount=0}Object.create&&(A.prototype=Object.create(null),(new A).__proto__||(O=!1)),v.prototype.eventNames=function(){var x,p,o=[];if(0===this._eventsCount)return o;for(p in x=this._events)C.call(x,p)&&o.push(O?p.slice(1):p);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(x)):o},v.prototype.listeners=function(o){var p=this._events[O?O+o:o];if(!p)return[];if(p.fn)return[p.fn];for(var T=0,y=p.length,d=new Array(y);T<y;T++)d[T]=p[T].fn;return d},v.prototype.listenerCount=function(o){var p=this._events[O?O+o:o];return p?p.fn?1:p.length:0},v.prototype.emit=function(o,x,p,T,y,d){var e=O?O+o:o;if(!this._events[e])return!1;var m,i,a=this._events[e],h=arguments.length;if(a.fn){switch(a.once&&this.removeListener(o,a.fn,void 0,!0),h){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,x),!0;case 3:return a.fn.call(a.context,x,p),!0;case 4:return a.fn.call(a.context,x,p,T),!0;case 5:return a.fn.call(a.context,x,p,T,y),!0;case 6:return a.fn.call(a.context,x,p,T,y,d),!0}for(i=1,m=new Array(h-1);i<h;i++)m[i-1]=arguments[i];a.fn.apply(a.context,m)}else{var l,r=a.length;for(i=0;i<r;i++)switch(a[i].once&&this.removeListener(o,a[i].fn,void 0,!0),h){case 1:a[i].fn.call(a[i].context);break;case 2:a[i].fn.call(a[i].context,x);break;case 3:a[i].fn.call(a[i].context,x,p);break;case 4:a[i].fn.call(a[i].context,x,p,T);break;default:if(!m)for(l=1,m=new Array(h-1);l<h;l++)m[l-1]=arguments[l];a[i].fn.apply(a[i].context,m)}}return!0},v.prototype.on=function(o,x,p){return R(this,o,x,p,!1)},v.prototype.once=function(o,x,p){return R(this,o,x,p,!0)},v.prototype.removeListener=function(o,x,p,T){var y=O?O+o:o;if(!this._events[y])return this;if(!x)return I(this,y),this;var d=this._events[y];if(d.fn)d.fn===x&&(!T||d.once)&&(!p||d.context===p)&&I(this,y);else{for(var e=0,a=[],h=d.length;e<h;e++)(d[e].fn!==x||T&&!d[e].once||p&&d[e].context!==p)&&a.push(d[e]);a.length?this._events[y]=1===a.length?a[0]:a:I(this,y)}return this},v.prototype.removeAllListeners=function(o){var x;return o?this._events[x=O?O+o:o]&&I(this,x):(this._events=new A,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=O,v.EventEmitter=v,G.exports=v},"./node_modules/url-toolkit/src/url-toolkit.js":function(G,M,S){var O,A,b,R,I;O=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,A=/^(?=([^\/?#]*))\1([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,G.exports=I={buildAbsoluteURL:function(v,E,o){if(o=o||{},v=v.trim(),!(E=E.trim())){if(!o.alwaysNormalize)return v;var x=I.parseURL(v);if(!x)throw new Error("Error trying to parse base URL.");return x.path=I.normalizePath(x.path),I.buildURLFromParts(x)}var p=I.parseURL(E);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return o.alwaysNormalize?(p.path=I.normalizePath(p.path),I.buildURLFromParts(p)):E;var T=I.parseURL(v);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&"/"!==T.path[0]){var y=A.exec(T.path);T.netLoc=y[1],T.path=y[2]}T.netLoc&&!T.path&&(T.path="/");var d={scheme:T.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(d.netLoc=T.netLoc,"/"!==p.path[0]))if(p.path){var e=T.path,a=e.substring(0,e.lastIndexOf("/")+1)+p.path;d.path=I.normalizePath(a)}else d.path=T.path,p.params||(d.params=T.params,p.query||(d.query=T.query));return null===d.path&&(d.path=o.alwaysNormalize?I.normalizePath(p.path):p.path),I.buildURLFromParts(d)},parseURL:function(v){var E=O.exec(v);return E?{scheme:E[1]||"",netLoc:E[2]||"",path:E[3]||"",params:E[4]||"",query:E[5]||"",fragment:E[6]||""}:null},normalizePath:function(v){for(v=v.split("").reverse().join("").replace(b,"");v.length!==(v=v.replace(R,"")).length;);return v.split("").reverse().join("")},buildURLFromParts:function(v){return v.scheme+v.netLoc+v.path+v.params+v.query+v.fragment}}},"./node_modules/webworkify-webpack/index.js":function(G,M,S){function C(o){var x={};function p(y){if(x[y])return x[y].exports;var d=x[y]={i:y,l:!1,exports:{}};return o[y].call(d.exports,d,d.exports,p),d.l=!0,d.exports}p.m=o,p.c=x,p.i=function(y){return y},p.d=function(y,d,e){p.o(y,d)||Object.defineProperty(y,d,{configurable:!1,enumerable:!0,get:e})},p.r=function(y){Object.defineProperty(y,"__esModule",{value:!0})},p.n=function(y){var d=y&&y.__esModule?function(){return y.default}:function(){return y};return p.d(d,"a",d),d},p.o=function(y,d){return Object.prototype.hasOwnProperty.call(y,d)},p.p="/",p.oe=function(y){throw console.error(y),y};var T=p(p.s=ENTRY_MODULE);return T.default||T}var O="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function b(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(o){return!isNaN(1*o)}function I(o,x,p){var T={};T[p]=[];var y=x.toString(),d=y.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return T;for(var h,e=d[1],a=new RegExp("(\\\\n|\\W)"+b(e)+A,"g");h=a.exec(y);)"dll-reference"!==h[3]&&T[p].push(h[3]);for(a=new RegExp("\\("+b(e)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+A,"g");h=a.exec(y);)o[h[2]]||(T[p].push(h[1]),o[h[2]]=S(h[1]).m),T[h[2]]=T[h[2]]||[],T[h[2]].push(h[4]);for(var m=Object.keys(T),i=0;i<m.length;i++)for(var r=0;r<T[m[i]].length;r++)R(T[m[i]][r])&&(T[m[i]][r]=1*T[m[i]][r]);return T}function v(o){return Object.keys(o).reduce(function(p,T){return p||o[T].length>0},!1)}G.exports=function(o,x){var p={main:S.m},T=(x=x||{}).all?{main:Object.keys(p.main)}:function E(o,x){for(var p={main:[x]},T={main:[]},y={main:{}};v(p);)for(var d=Object.keys(p),e=0;e<d.length;e++){var a=d[e],m=p[a].pop();if(y[a]=y[a]||{},!y[a][m]&&o[a][m]){y[a][m]=!0,T[a]=T[a]||[],T[a].push(m);for(var i=I(o,o[a][m],a),r=Object.keys(i),l=0;l<r.length;l++)p[r[l]]=p[r[l]]||[],p[r[l]]=p[r[l]].concat(i[r[l]])}}return T}(p,o),y="";Object.keys(T).filter(function(m){return"main"!==m}).forEach(function(m){for(var i=0;T[m][i];)i++;T[m].push(i),p[m][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",y=y+"var "+m+" = ("+C.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+T[m].map(function(r){return JSON.stringify(r)+": "+p[m][r].toString()}).join(",")+"});\n"}),y=y+"new (("+C.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+T.main.map(function(m){return JSON.stringify(m)+": "+p.main[m].toString()}).join(",")+"}))(self);";var d=new window.Blob([y],{type:"text/javascript"});if(x.bare)return d;var a=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),h=new window.Worker(a);return h.objectURL=a,h}},"./src/config.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"hlsDefaultConfig",function(){return l}),S.d(M,"mergeConfig",function(){return t}),S.d(M,"enableStreamingMode",function(){return s});var C=S("./src/controller/abr-controller.ts"),O=S("./src/controller/audio-stream-controller.ts"),A=S("./src/controller/audio-track-controller.ts"),b=S("./src/controller/subtitle-stream-controller.ts"),R=S("./src/controller/subtitle-track-controller.ts"),I=S("./src/controller/buffer-controller.ts"),v=S("./src/controller/timeline-controller.ts"),E=S("./src/controller/cap-level-controller.ts"),o=S("./src/controller/fps-controller.ts"),x=S("./src/controller/eme-controller.ts"),p=S("./src/controller/cmcd-controller.ts"),T=S("./src/utils/xhr-loader.ts"),y=S("./src/utils/fetch-loader.ts"),d=S("./src/utils/cues.ts"),e=S("./src/utils/mediakeys-helper.ts"),a=S("./src/utils/logger.ts");function h(){return h=Object.assign?Object.assign.bind():function(u){for(var n=1;n<arguments.length;n++){var f=arguments[n];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},h.apply(this,arguments)}function m(u,n){var f=Object.keys(u);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(u);n&&(g=g.filter(function(D){return Object.getOwnPropertyDescriptor(u,D).enumerable})),f.push.apply(f,g)}return f}function i(u){for(var n=1;n<arguments.length;n++){var f=null!=arguments[n]?arguments[n]:{};n%2?m(Object(f),!0).forEach(function(g){r(u,g,f[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(f)):m(Object(f)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(f,g))})}return u}function r(u,n,f){return n in u?Object.defineProperty(u,n,{value:f,enumerable:!0,configurable:!0,writable:!0}):u[n]=f,u}var l=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:C.default,bufferController:I.default,capLevelController:E.default,fpsController:o.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},function c(){return{cueHandler:d.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:R.default,timelineController:v.TimelineController,audioStreamController:O.default,audioTrackController:A.default,emeController:x.default,cmcdController:p.default});function t(u,n){if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==n.liveMaxLatencyDurationCount&&(void 0===n.liveSyncDurationCount||n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==n.liveMaxLatencyDuration&&(void 0===n.liveSyncDuration||n.liveMaxLatencyDuration<=n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},u,n)}function s(u){var n=u.loader;n!==y.default&&n!==T.default?(a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1):Object(y.fetchSupported)()&&(u.loader=y.default,u.progressive=!0,u.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/utils/ewma-bandwidth-estimator.ts"),A=S("./src/events.ts"),b=S("./src/errors.ts"),R=S("./src/types/loader.ts"),I=S("./src/utils/logger.ts");function v(x,p){for(var T=0;T<p.length;T++){var y=p[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(x,y.key,y)}}M.default=function(){function x(T){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=T;var y=T.config;this.bwEstimator=new O.default(y.abrEwmaSlowVoD,y.abrEwmaFastVoD,y.abrEwmaDefaultEstimate),this.registerListeners()}var p=x.prototype;return p.registerListeners=function(){var y=this.hls;y.on(A.Events.FRAG_LOADING,this.onFragLoading,this),y.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),y.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),y.on(A.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var y=this.hls;y.off(A.Events.FRAG_LOADING,this.onFragLoading,this),y.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),y.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),y.off(A.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},p.onFragLoading=function(y,d){var a,e=d.frag;e.type!==R.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=e,this.partCurrent=null!=(a=d.part)?a:null,this.timer=self.setInterval(this.onCheck,100))},p.onLevelLoaded=function(y,d){var e=this.hls.config;d.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},p._abandonRulesCheck=function(){var y=this.fragCurrent,d=this.partCurrent,e=this.hls,a=e.autoLevelEnabled,m=e.media;if(y&&m){var i=d?d.stats:y.stats,r=d?d.duration:y.duration;if(i.aborted||i.loaded&&i.loaded===i.total||0===y.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(a&&!m.paused&&m.playbackRate&&m.readyState){var l=e.mainForwardBufferInfo;if(null!==l){var c=performance.now()-i.loading.start,t=Math.abs(m.playbackRate);if(!(c<=500*r/t)){var s=i.loaded&&i.loading.first,u=this.bwEstimator.getEstimate(),n=e.levels,f=e.minAutoLevel,D=i.total||Math.max(i.loaded,Math.round(r*n[y.level].maxBitrate/8)),L=s?1e3*i.loaded/c:0,P=L?(D-i.loaded)/L:8*D/u,B=l.len/t;if(!(P<=B)){var U,F=Number.POSITIVE_INFINITY;for(U=y.level-1;U>f;U--){var N=n[U].maxBitrate;if((F=L?r*N/(6.4*L):r*N/u)<B)break}F>=P||(I.logger.warn("Fragment "+y.sn+(d?" part "+d.index:"")+" of level "+y.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+"\n      Current BW estimate: "+(Object(C.isFiniteNumber)(u)?(u/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+P.toFixed(3)+" s\n      Estimated load time for the next fragment: "+F.toFixed(3)+" s\n      Time to underbuffer: "+B.toFixed(3)+" s"),e.nextLoadLevel=U,s&&this.bwEstimator.sample(c,i.loaded),this.clearTimer(),y.loader&&(this.fragCurrent=this.partCurrent=null,y.loader.abort()),e.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:y,part:d,stats:i}))}}}}}},p.onFragLoaded=function(y,d){var e=d.frag,a=d.part;if(e.type===R.PlaylistLevelType.MAIN&&Object(C.isFiniteNumber)(e.sn)){var h=a?a.stats:e.stats,m=a?a.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],r=(i.loaded?i.loaded.bytes:0)+h.loaded,l=(i.loaded?i.loaded.duration:0)+m;i.loaded={bytes:r,duration:l},i.realBitrate=Math.round(8*r/l)}e.bitrateTest&&this.onFragBuffered(A.Events.FRAG_BUFFERED,{stats:h,frag:e,part:a,id:e.type})}},p.onFragBuffered=function(y,d){var e=d.frag,a=d.part,h=a?a.stats:e.stats;if(!h.aborted&&e.type===R.PlaylistLevelType.MAIN&&"initSegment"!==e.sn){var m=h.parsing.end-h.loading.start;this.bwEstimator.sample(m,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=e.bitrateTest?m/1e3:0}},p.onError=function(y,d){switch(d.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},p.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},p.getNextABRAutoLevel=function(){var y=this.fragCurrent,d=this.partCurrent,e=this.hls,a=e.maxAutoLevel,h=e.config,m=e.minAutoLevel,i=e.media,r=d?d.duration:y?y.duration:0,c=i&&0!==i.playbackRate?Math.abs(i.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,s=e.mainForwardBufferInfo,u=(s?s.len:0)/c,n=this.findBestLevel(t,m,a,u,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(n>=0)return n;I.logger.trace((u?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var f=r?Math.min(r,h.maxStarvationDelay):h.maxStarvationDelay,g=h.abrBandWidthFactor,D=h.abrBandWidthUpFactor;if(!u){var L=this.bitrateTestDelay;L&&(f=(r?Math.min(r,h.maxLoadingDelay):h.maxLoadingDelay)-L,I.logger.trace("bitrate test took "+Math.round(1e3*L)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),g=D=1)}return n=this.findBestLevel(t,m,a,u+f,g,D),Math.max(n,0)},p.findBestLevel=function(y,d,e,a,h,m){for(var i,r=this.fragCurrent,l=this.partCurrent,c=this.lastLoadedFragLevel,t=this.hls.levels,s=t[c],u=!(null==s||null===(i=s.details)||void 0===i||!i.live),n=null==s?void 0:s.codecSet,f=l?l.duration:r?r.duration:0,g=e;g>=d;g--){var D=t[g];if(D&&(!n||D.codecSet===n)){var B,L=D.details,P=(l?null==L?void 0:L.partTarget:null==L?void 0:L.averagetargetduration)||f,F=t[g].maxBitrate,U=F*P/(B=g<=c?h*y:m*y);if(I.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(B)+"/"+F+"/"+P+"/"+a+"/"+U),B>F&&(0===U||!Object(C.isFiniteNumber)(U)||u&&!this.bitrateTestDelay||U<a))return g}}return-1},function E(x,p,T){return p&&v(x.prototype,p),T&&v(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}(x,[{key:"nextAutoLevel",get:function(){var y=this._nextAutoLevel;if(-1!==y&&!this.bwEstimator.canEstimate())return y;var e=this.getNextABRAutoLevel();return-1!==y&&this.hls.levels[e].loadError?y:(-1!==y&&(e=Math.min(y,e)),e)},set:function(y){this._nextAutoLevel=y}}]),x}()},"./src/controller/audio-stream-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/controller/base-stream-controller.ts"),A=S("./src/events.ts"),b=S("./src/utils/buffer-helper.ts"),R=S("./src/controller/fragment-tracker.ts"),I=S("./src/types/level.ts"),v=S("./src/types/loader.ts"),E=S("./src/loader/fragment.ts"),o=S("./src/demux/chunk-cache.ts"),x=S("./src/demux/transmuxer-interface.ts"),p=S("./src/types/transmuxer.ts"),T=S("./src/controller/fragment-finders.ts"),y=S("./src/utils/discontinuities.ts"),d=S("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var c=arguments[l];for(var t in c)Object.prototype.hasOwnProperty.call(c,t)&&(r[t]=c[t])}return r},e.apply(this,arguments)}function a(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,h(r,l)}function h(r,l){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t})(r,l)}M.default=function(r){function l(t,s){var u;return(u=r.call(this,t,s,"[audio-stream-controller]")||this).videoBuffer=null,u.videoTrackCC=-1,u.waitingVideoCC=-1,u.audioSwitch=!1,u.trackId=-1,u.waitingData=null,u.mainDetails=null,u.bufferFlushed=!1,u.cachedTrackLoadedData=null,u._registerListeners(),u}a(l,r);var c=l.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var s=this.hls;s.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(A.Events.ERROR,this.onError,this),s.on(A.Events.BUFFER_RESET,this.onBufferReset,this),s.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var s=this.hls;s.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(A.Events.ERROR,this.onError,this),s.off(A.Events.BUFFER_RESET,this.onBufferReset,this),s.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.onInitPtsFound=function(s,u){var n=u.frag,g=u.initPTS;if("main"===u.id){var D=n.cc;this.initPTS[n.cc]=g,this.log("InitPTS for cc: "+D+" found from main: "+g),this.videoTrackCC=D,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},c.startLoad=function(s){if(!this.levels)return this.startPosition=s,void(this.state=O.State.STOPPED);var u=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,u>0&&-1===s?(this.log("Override startPosition with lastCurrentTime @"+u.toFixed(3)),s=u,this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},c.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:var s,u=this.levels,f=null==u||null===(s=u[this.trackId])||void 0===s?void 0:s.details;if(f){if(this.waitForCdnTuneIn(f))break;this.state=O.State.WAITING_INIT_PTS}break;case O.State.FRAG_LOADING_WAITING_RETRY:var g,D=performance.now(),L=this.retryDate;(!L||D>=L||null!==(g=this.media)&&void 0!==g&&g.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=O.State.IDLE);break;case O.State.WAITING_INIT_PTS:var P=this.waitingData;if(P){var B=P.frag,F=P.part,U=P.cache,N=P.complete;if(void 0!==this.initPTS[B.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var K={frag:B,part:F,payload:U.flush(),networkDetails:null};this._handleFragmentLoadProgress(K),N&&r.prototype._handleFragmentLoadComplete.call(this,K)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var w=this.getLoadPosition(),W=b.BufferHelper.bufferInfo(this.mediaBuffer,w,this.config.maxBufferHole);Object(T.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,B)<0&&(this.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}this.onTickEnd()},c.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},c.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},c.onTickEnd=function(){var s=this.media;s&&s.readyState&&(!this.loadedmetadata&&(this.mediaBuffer?this.mediaBuffer:s).buffered.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime)},c.doTickIdle=function(){var s,u,n=this.hls,f=this.levels,g=this.media,D=this.trackId;if(f&&f[D]&&(g||!this.startFragRequested&&n.config.startFragPrefetch)){var B=f[D].details;if(!B||B.live&&this.levelLastLoaded!==D||this.waitForCdnTuneIn(B))return void(this.state=O.State.WAITING_TRACK);var F=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&F&&(this.bufferFlushed=!1,this.afterBufferFlushed(F,E.ElementaryStreamTypes.AUDIO,v.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(F,v.PlaylistLevelType.AUDIO);if(null!==U){var N=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,v.PlaylistLevelType.MAIN),k=U.len,K=this.getMaxBufferLength(null==N?void 0:N.len),w=this.audioSwitch;if(!(k>=K)||w){if(!w&&this._streamEnded(U,B))return n.trigger(A.Events.BUFFER_EOS,{type:"audio"}),void(this.state=O.State.ENDED);var j=B.fragments[0].start,_=U.end;if(w&&g){var Y=this.getLoadPosition();_=Y,B.PTSKnown&&Y<j&&(U.end>j||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),g.currentTime=j+.05)}if(!(N&&_>N.end+B.targetduration)&&(N&&N.len||!U.len)){var z=this.getNextFragment(_,B);if(!z)return void(this.bufferFlushed=!0);"identity"!==(null===(s=z.decryptdata)||void 0===s?void 0:s.keyFormat)||null!==(u=z.decryptdata)&&void 0!==u&&u.key?this.loadFragment(z,B,_):this.loadKey(z,B)}}}}},c.getMaxBufferLength=function(s){var u=r.prototype.getMaxBufferLength.call(this);return s?Math.max(u,s):u},c.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},c.onAudioTracksUpdated=function(s,u){var n=u.audioTracks;this.resetTransmuxer(),this.levels=n.map(function(f){return new I.Level(f)})},c.onAudioTrackSwitching=function(s,u){var n=!!u.url;this.trackId=u.id;var f=this.fragCurrent;null!=f&&f.loader&&f.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},c.onLevelLoaded=function(s,u){this.mainDetails=u.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},c.onAudioTrackLoaded=function(s,u){var n;if(null!=this.mainDetails){var f=this.levels,g=u.details,D=u.id;if(f){this.log("Track "+D+" loaded ["+g.startSN+","+g.endSN+"],duration:"+g.totalduration);var L=f[D],P=0;if(g.live||null!==(n=L.details)&&void 0!==n&&n.live){var B=this.mainDetails;if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed||!B)return;!L.details&&g.hasProgramDateTime&&B.hasProgramDateTime?(Object(y.alignMediaPlaylistByPDT)(g,B),P=g.fragments[0].start):P=this.alignPlaylists(g,L.details)}L.details=g,this.levelLastLoaded=D,!this.startFragRequested&&(this.mainDetails||!g.live)&&this.setStartPosition(L.details,P),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(g)&&(this.state=O.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+D)}else this.cachedTrackLoadedData=u},c._handleFragmentLoadProgress=function(s){var u,n=s.frag,f=s.part,g=s.payload,D=this.config,L=this.trackId,P=this.levels;if(P){var B=P[L];console.assert(B,"Audio track is defined on fragment load progress");var F=B.details;console.assert(F,"Audio track details are defined on fragment load progress");var U=D.defaultAudioCodec||B.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new x.default(this.hls,v.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var k=this.initPTS[n.cc],K=null===(u=n.initSegment)||void 0===u?void 0:u.data;if(void 0!==k){var W=f?f.index:-1,_=new p.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,g.byteLength,W,-1!==W);N.push(g,K,U,"",n,f,F.totalduration,!1,_,k)}else this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+L),(this.waitingData=this.waitingData||{frag:n,part:f,cache:new o.default,complete:!1}).cache.push(new Uint8Array(g)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},c._handleFragmentLoadComplete=function(s){this.waitingData?this.waitingData.complete=!0:r.prototype._handleFragmentLoadComplete.call(this,s)},c.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.onBufferCreated=function(s,u){var n=u.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),u.tracks.video&&(this.videoBuffer=u.tracks.video.buffer||null)},c.onFragBuffered=function(s,u){var n=u.frag,f=u.part;if(n.type===v.PlaylistLevelType.AUDIO){if(this.fragContextChanged(n))return void this.warn("Fragment "+n.sn+(f?" p: "+f.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);"initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,f)}},c.onError=function(s,u){switch(u.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(v.PlaylistLevelType.AUDIO,u);break;case d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case d.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=u.fatal?O.State.ERROR:O.State.IDLE,this.warn(u.details+" while loading frag, switching to "+this.state+" state"));break;case d.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===u.parent&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var n=!0,f=this.getFwdBufferInfo(this.mediaBuffer,v.PlaylistLevelType.AUDIO);f&&f.len>.5&&(n=!this.reduceMaxBufferLength(f.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},c.onBufferFlushed=function(s,u){u.type===E.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},c._handleTransmuxComplete=function(s){var u,n="audio",f=this.hls,g=s.remuxResult,D=s.chunkMeta,L=this.getCurrentContext(D);if(!L)return this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(D.level);var P=L.frag,B=L.part,F=L.level.details,U=g.audio,N=g.text,k=g.id3,K=g.initSegment;if(!this.fragContextChanged(P)&&F){if(this.state=O.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),null!=K&&K.tracks&&(this._bufferInitSegment(K.tracks,P,D),f.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:n,tracks:K.tracks})),U){var w=U.startPTS,W=U.endPTS,j=U.startDTS,_=U.endDTS;B&&(B.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:w,endPTS:W,startDTS:j,endDTS:_}),P.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,w,W,j,_),this.bufferFragmentData(U,P,B,D)}if(null!=k&&null!==(u=k.samples)&&void 0!==u&&u.length){var Y=e({id:n,frag:P,details:F},k);f.trigger(A.Events.FRAG_PARSING_METADATA,Y)}if(N){var z=e({id:n,frag:P,details:F},N);f.trigger(A.Events.FRAG_PARSING_USERDATA,z)}}},c._bufferInitSegment=function(s,u,n){if(this.state===O.State.PARSING){s.video&&delete s.video;var f=s.audio;if(f){f.levelCodec=f.codec,f.id="audio",this.log("Init audio buffer, container:"+f.container+", codecs[parsed]=["+f.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,s);var g=f.initSegment;null!=g&&g.byteLength&&this.hls.trigger(A.Events.BUFFER_APPENDING,{type:"audio",frag:u,part:null,chunkMeta:n,parent:u.type,data:g}),this.tick()}}},c.loadFragment=function(s,u,n){var f=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||f===R.FragmentState.NOT_LOADED||f===R.FragmentState.PARTIAL)&&("initSegment"===s.sn?this._loadInitSegment(s):u.live&&!Object(C.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,s,u,n)))},c.completeAudioSwitch=function(){var s=this.hls,n=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:n})},l}(O.default)},"./src/controller/audio-track-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/controller/base-playlist-controller.ts"),b=S("./src/types/loader.ts");function R(x,p){for(var T=0;T<p.length;T++){var y=p[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(x,y.key,y)}}function v(x,p){x.prototype=Object.create(p.prototype),x.prototype.constructor=x,E(x,p)}function E(x,p){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,d){return y.__proto__=d,y})(x,p)}M.default=function(x){function p(y){var d;return(d=x.call(this,y,"[audio-track-controller]")||this).tracks=[],d.groupId=null,d.tracksInGroup=[],d.trackId=-1,d.trackName="",d.selectDefaultTrack=!0,d.registerListeners(),d}v(p,x);var T=p.prototype;return T.registerListeners=function(){var d=this.hls;d.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.on(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.on(C.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var d=this.hls;d.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.off(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.off(C.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,x.prototype.destroy.call(this)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},T.onManifestParsed=function(d,e){this.tracks=e.audioTracks||[]},T.onAudioTrackLoaded=function(d,e){var a=e.id,h=e.details,m=this.tracksInGroup[a];if(m){var i=m.details;m.details=e.details,this.log("audioTrack "+a+" loaded ["+h.startSN+"-"+h.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,e,i))}else this.warn("Invalid audio track id "+a)},T.onLevelLoading=function(d,e){this.switchLevel(e.level)},T.onLevelSwitching=function(d,e){this.switchLevel(e.level)},T.switchLevel=function(d){var e=this.hls.levels[d];if(null!=e&&e.audioGroupIds){var a=e.audioGroupIds[e.urlId];if(this.groupId!==a){this.groupId=a;var h=this.tracks.filter(function(i){return!a||i.groupId===a});this.selectDefaultTrack&&!h.some(function(i){return i.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var m={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(C.Events.AUDIO_TRACKS_UPDATED,m),this.selectInitialTrack()}}},T.onError=function(d,e){x.prototype.onError.call(this,d,e),!e.fatal&&e.context&&e.context.type===b.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},T.setAudioTrack=function(d){var e=this.tracksInGroup;if(d<0||d>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var a=e[this.trackId];this.log("Now switching to audio-track index "+d);var h=e[d],m=h.id,i=h.groupId,r=void 0===i?"":i,l=h.name,c=h.type,t=h.url;if(this.trackId=d,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(C.Events.AUDIO_TRACK_SWITCHING,{id:m,groupId:r,name:l,type:c,url:t}),!h.details||h.details.live){var s=this.switchParams(h.url,null==a?void 0:a.details);this.loadPlaylist(s)}}},T.selectInitialTrack=function(){console.assert(this.tracksInGroup.length,"Initial audio track should be selected when tracks are known");var a=this.findTrackId(this.trackName)||this.findTrackId();-1!==a?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},T.findTrackId=function(d){for(var e=this.tracksInGroup,a=0;a<e.length;a++){var h=e[a];if((!this.selectDefaultTrack||h.default)&&(!d||d===h.name))return h.id}return-1},T.loadPlaylist=function(d){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var a=e.id,h=e.groupId,m=e.url;if(d)try{m=d.addDirectives(m)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("loading audio-track playlist for id: "+a),this.clearTimer(),this.hls.trigger(C.Events.AUDIO_TRACK_LOADING,{url:m,id:a,groupId:h,deliveryDirectives:d||null})}},function I(x,p,T){return p&&R(x.prototype,p),T&&R(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}(p,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(d){this.selectDefaultTrack=!1,this.setAudioTrack(d)}}]),p}(A.default)},"./src/controller/base-playlist-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return I});var C=S("./src/polyfills/number.ts"),O=S("./src/types/level.ts"),A=S("./src/controller/level-helper.ts"),b=S("./src/utils/logger.ts"),R=S("./src/errors.ts"),I=function(){function v(o,x){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,x+":"),this.warn=b.logger.warn.bind(b.logger,x+":"),this.hls=o}var E=v.prototype;return E.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},E.onError=function(x,p){p.fatal&&p.type===R.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},E.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},E.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},E.stopLoad=function(){this.canLoad=!1,this.clearTimer()},E.switchParams=function(x,p){var T=null==p?void 0:p.renditionReports;if(T)for(var y=0;y<T.length;y++){var d=T[y],e=""+d.URI;if(e===x.slice(-e.length)){var a=parseInt(d["LAST-MSN"]),h=parseInt(d["LAST-PART"]);if(p&&this.hls.config.lowLatencyMode){var m=Math.min(p.age-p.partTarget,p.targetduration);void 0!==h&&m>p.partTarget&&(h+=1)}if(Object(C.isFiniteNumber)(a))return new O.HlsUrlParameters(a,Object(C.isFiniteNumber)(h)?h:void 0,O.HlsSkip.No)}}},E.loadPlaylist=function(x){},E.shouldLoadTrack=function(x){return this.canLoad&&x&&!!x.url&&(!x.details||x.details.live)},E.playlistLoaded=function(x,p,T){var y=this,d=p.details,e=p.stats,a=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(d.advancedDateTime=Date.now()-a,d.live||null!=T&&T.live){if(d.reloaded(T),T&&this.log("live playlist "+x+" "+(d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:"MISSED")),T&&d.fragments.length>0&&Object(A.mergeDetails)(T,d),!this.canLoad||!d.live)return;var h,m=void 0,i=void 0;if(d.canBlockReload&&d.endSN&&d.advanced){var r=this.hls.config.lowLatencyMode,l=d.lastPartSn,c=d.endSN,t=d.lastPartIndex,u=l===c;-1!==t?(m=u?c+1:l,i=u?r?0:t:t+1):m=c+1;var f=d.age,D=Math.min(f+d.ageHeader-d.partTarget,1.5*d.targetduration);if(D>0){if(T&&D>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+D+" with playlist age: "+d.age),D=0;else{var L=Math.floor(D/d.targetduration);m+=L,void 0!==i&&(i+=Math.round(D%d.targetduration/d.partTarget)),this.log("CDN Tune-in age: "+d.ageHeader+"s last advanced "+f.toFixed(2)+"s goal: "+D+" skip sn "+L+" to part "+i)}d.tuneInGoal=D}if(h=this.getDeliveryDirectives(d,p.deliveryDirectives,m,i),r||!u)return void this.loadPlaylist(h)}else h=this.getDeliveryDirectives(d,p.deliveryDirectives,m,i);var B=Object(A.computeReloadInterval)(d,e);void 0!==m&&d.canBlockReload&&(B-=d.partTarget||1),this.log("reload live playlist "+x+" in "+Math.round(B)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(h)},B)}else this.clearTimer()},E.getDeliveryDirectives=function(x,p,T,y){var d=Object(O.getSkipValue)(x,T);return null!=p&&p.skip&&x.deltaUpdateFailed&&(T=p.msn,y=p.part,d=O.HlsSkip.No),new O.HlsUrlParameters(T,y,d)},E.retryLoadingOrFail=function(x){var d,p=this,T=this.hls.config,y=this.retryCount<T.levelLoadingMaxRetry;if(y)if(this.retryCount++,x.details.indexOf("LoadTimeOut")>-1&&null!==(d=x.context)&&void 0!==d&&d.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+x.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+x.details+'"')}else this.warn('cannot recover from error "'+x.details+'"'),this.clearTimer(),x.fatal=!0;return y},v}()},"./src/controller/base-stream-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"State",function(){return c}),S.d(M,"default",function(){return t});var C=S("./src/polyfills/number.ts"),O=S("./src/task-loop.ts"),A=S("./src/controller/fragment-tracker.ts"),b=S("./src/utils/buffer-helper.ts"),R=S("./src/utils/logger.ts"),I=S("./src/events.ts"),v=S("./src/errors.ts"),E=S("./src/types/transmuxer.ts"),o=S("./src/utils/mp4-tools.ts"),x=S("./src/utils/discontinuities.ts"),p=S("./src/controller/fragment-finders.ts"),T=S("./src/controller/level-helper.ts"),y=S("./src/loader/fragment-loader.ts"),d=S("./src/crypt/decrypter.ts"),e=S("./src/utils/time-ranges.ts"),a=S("./src/types/loader.ts");function h(s,u){for(var n=0;n<u.length;n++){var f=u[n];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(s,f.key,f)}}function i(s){if(void 0===s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function r(s,u){s.prototype=Object.create(u.prototype),s.prototype.constructor=s,l(s,u)}function l(s,u){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,g){return f.__proto__=g,f})(s,u)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(s){function u(f,g,D){var L;return(L=s.call(this)||this).hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=c.STOPPED,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=D,L.log=R.logger.log.bind(R.logger,D+":"),L.warn=R.logger.warn.bind(R.logger,D+":"),L.hls=f,L.fragmentLoader=new y.default(f.config),L.fragmentTracker=g,L.config=f.config,L.decrypter=new d.default(f,f.config),f.on(I.Events.KEY_LOADED,L.onKeyLoaded,i(L)),f.on(I.Events.LEVEL_SWITCHING,L.onLevelSwitching,i(L)),L}r(u,s);var n=u.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(g){},n.stopLoad=function(){this.fragmentLoader.abort();var g=this.fragCurrent;g&&this.fragmentTracker.removeFragment(g),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},n._streamEnded=function(g,D){var L=this.fragCurrent,P=this.fragmentTracker;if(!D.live&&L&&this.media&&L.sn>=D.endSN&&!g.nextStart){var B=D.partList;if(null!=B&&B.length){var F=B[B.length-1];return b.BufferHelper.isBuffered(this.media,F.start+F.duration/2)}var N=P.getState(L);return N===A.FragmentState.PARTIAL||N===A.FragmentState.OK}return!1},n.onMediaAttached=function(g,D){var L=this.media=this.mediaBuffer=D.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),L.addEventListener("seeking",this.onvseeking),L.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(P.startPosition)},n.onMediaDetaching=function(){var g=this.media;null!=g&&g.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),g&&this.onvseeking&&this.onvended&&(g.removeEventListener("seeking",this.onvseeking),g.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},n.onMediaSeeking=function(){var g=this.config,D=this.fragCurrent,L=this.media,B=this.state,F=L?L.currentTime:0,U=b.BufferHelper.bufferInfo(this.mediaBuffer||L,F,g.maxBufferHole);if(this.log("media seeking to "+(Object(C.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+B),B===c.ENDED)this.resetLoadingState();else if(D&&!U.len){var N=g.maxFragLookUpTolerance,w=F>D.start+D.duration+N;(F<D.start-N||w)&&(w&&D.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),D.loader.abort()),this.resetLoadingState())}L&&(this.lastCurrentTime=F),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onKeyLoaded=function(g,D){if(this.state===c.KEY_LOADING&&D.frag===this.fragCurrent&&this.levels){this.state=c.IDLE;var L=this.levels[D.frag.level].details;L&&this.loadFragment(D.frag,L,D.frag.start)}},n.onLevelSwitching=function(g,D){this.fragLoadError=0},n.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},n.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},n.loadKey=function(g,D){this.log("Loading key for "+g.sn+" of ["+D.startSN+"-"+D.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+g.level),this.state=c.KEY_LOADING,this.fragCurrent=g,this.hls.trigger(I.Events.KEY_LOADING,{frag:g})},n.loadFragment=function(g,D,L){this._loadFragForPlayback(g,D,L)},n._loadFragForPlayback=function(g,D,L){var P=this;this._doFragLoad(g,D,L,function(U){if(P.fragContextChanged(g))return P.warn("Fragment "+g.sn+(U.part?" p: "+U.part.index:"")+" of level "+g.level+" was dropped during download."),void P.fragmentTracker.removeFragment(g);g.stats.chunkCount++,P._handleFragmentLoadProgress(U)}).then(function(F){if(F){P.fragLoadError=0;var U=P.state;if(P.fragContextChanged(g))return void((U===c.FRAG_LOADING||!P.fragCurrent&&U===c.PARSING)&&(P.fragmentTracker.removeFragment(g),P.state=c.IDLE));"payload"in F&&(P.log("Loaded fragment "+g.sn+" of level "+g.level),P.hls.trigger(I.Events.FRAG_LOADED,F)),P._handleFragmentLoadComplete(F)}}).catch(function(F){P.state===c.STOPPED||P.state===c.ERROR||(P.warn(F),P.resetFragmentLoading(g))})},n.flushMainBuffer=function(g,D,L){if(void 0===L&&(L=null),g-D){var P={startOffset:g,endOffset:D,type:L};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,P)}},n._loadInitSegment=function(g){var D=this;this._doFragLoad(g).then(function(L){if(!L||D.fragContextChanged(g)||!D.levels)throw new Error("init load aborted");return L}).then(function(L){var P=D.hls,B=L.payload,F=g.decryptdata;if(B&&B.byteLength>0&&F&&F.key&&F.iv&&"AES-128"===F.method){var U=self.performance.now();return D.decrypter.webCryptoDecrypt(new Uint8Array(B),F.key.buffer,F.iv.buffer).then(function(N){var k=self.performance.now();return P.trigger(I.Events.FRAG_DECRYPTED,{frag:g,payload:N,stats:{tstart:U,tdecrypt:k}}),L.payload=N,L})}return L}).then(function(L){var P=D.fragCurrent,B=D.hls,F=D.levels;if(!F)throw new Error("init load aborted, missing levels");console.assert(F[g.level].details,"Level details are defined when init segment is loaded");var N=g.stats;D.state=c.IDLE,D.fragLoadError=0,g.data=new Uint8Array(L.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),L.frag===P&&B.trigger(I.Events.FRAG_BUFFERED,{stats:N,frag:P,part:null,id:g.type}),D.tick()}).catch(function(L){D.state===c.STOPPED||D.state===c.ERROR||(D.warn(L),D.resetFragmentLoading(g))})},n.fragContextChanged=function(g){var D=this.fragCurrent;return!g||!D||g.level!==D.level||g.sn!==D.sn||g.urlId!==D.urlId},n.fragBufferedComplete=function(g,D){var L=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+g.type+" sn: "+g.sn+(D?" part: "+D.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+g.level+" "+(L?e.default.toString(b.BufferHelper.getBuffered(L)):"(detached)")),this.state=c.IDLE,L&&(!this.loadedmetadata&&L.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},n.seekToStartPos=function(){},n._handleFragmentLoadComplete=function(g){var D=this.transmuxer;if(D){var L=g.frag,P=g.part,B=g.partsLoaded,F=!B||0===B.length||B.some(function(N){return!N}),U=new E.ChunkMetadata(L.level,L.sn,L.stats.chunkCount+1,0,P?P.index:-1,!F);D.flush(U)}},n._handleFragmentLoadProgress=function(g){},n._doFragLoad=function(g,D,L,P){var B=this;if(void 0===L&&(L=null),!this.levels)throw new Error("frag load aborted, missing levels");if(L=Math.max(g.start,L||0),this.config.lowLatencyMode&&D){var F=D.partList;if(F&&P){L>g.end&&D.fragmentHint&&(g=D.fragmentHint);var U=this.getNextPart(F,g,L);if(U>-1){var N=F[U];return this.log("Loading part sn: "+g.sn+" p: "+N.index+" cc: "+g.cc+" of playlist ["+D.startSN+"-"+D.endSN+"] parts [0-"+U+"-"+(F.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+g.level+", target: "+parseFloat(L.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=c.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:g,part:F[U],targetBufferTime:L}),this.doFragPartsLoad(g,F,U,P).catch(function(k){return B.handleFragLoadError(k)})}if(!g.url||this.loadedEndOfParts(F,L))return Promise.resolve(null)}}return this.log("Loading fragment "+g.sn+" cc: "+g.cc+" "+(D?"of ["+D.startSN+"-"+D.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+g.level+", target: "+parseFloat(L.toFixed(3))),Object(C.isFiniteNumber)(g.sn)&&!this.bitrateTest&&(this.nextLoadPosition=g.start+g.duration),this.state=c.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:g,targetBufferTime:L}),this.fragmentLoader.load(g,P).catch(function(k){return B.handleFragLoadError(k)})},n.doFragPartsLoad=function(g,D,L,P){var B=this;return new Promise(function(F,U){var N=[];!function K(w){var W=D[w];B.fragmentLoader.loadPart(g,W,P).then(function(j){N[W.index]=j;var _=j.part;B.hls.trigger(I.Events.FRAG_LOADED,j);var Y=D[w+1];if(!Y||Y.fragment!==g)return F({frag:g,part:_,partsLoaded:N});K(w+1)}).catch(U)}(L)})},n.handleFragLoadError=function(g){var D=g.data;return D&&D.details===v.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(D.frag,D.part):this.hls.trigger(I.Events.ERROR,D),null},n._handleTransmuxerFlush=function(g){var D=this.getCurrentContext(g);if(D&&this.state===c.PARSING){var L=D.frag,P=D.part,B=D.level,F=self.performance.now();L.stats.parsing.end=F,P&&(P.stats.parsing.end=F),this.updateLevelTiming(L,P,B,g.partial)}else this.fragCurrent||(this.state=c.IDLE)},n.getCurrentContext=function(g){var D=this.levels,L=g.level,P=g.sn,B=g.part;if(!D||!D[L])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+L+". The current chunk will not be buffered."),null;var F=D[L],U=B>-1?Object(T.getPartWith)(F,P,B):null,N=U?U.fragment:Object(T.getFragmentWithSN)(F,P,this.fragCurrent);return N?{frag:N,part:U,level:F}:null},n.bufferFragmentData=function(g,D,L,P){if(g&&this.state===c.PARSING){var B=g.data1,F=g.data2,U=B;B&&F&&(U=Object(o.appendUint8Array)(B,F)),U&&U.length&&(this.hls.trigger(I.Events.BUFFER_APPENDING,{type:g.type,frag:D,part:L,chunkMeta:P,parent:D.type,data:U}),g.dropped&&g.independent&&!L&&this.flushBufferGap(D))}},n.flushBufferGap=function(g){var D=this.media;if(D){if(!b.BufferHelper.isBuffered(D,D.currentTime))return void this.flushMainBuffer(0,g.start);var L=D.currentTime,P=b.BufferHelper.bufferInfo(D,L,0),F=Math.min(2*this.config.maxFragLookUpTolerance,.25*g.duration),U=Math.max(Math.min(g.start-F,P.end-F),L+F);g.start-U>F&&this.flushMainBuffer(U,g.start)}},n.getFwdBufferInfo=function(g,D){var L=this.config,P=this.getLoadPosition();if(!Object(C.isFiniteNumber)(P))return null;var B=b.BufferHelper.bufferInfo(g,P,L.maxBufferHole);if(0===B.len&&void 0!==B.nextStart){var F=this.fragmentTracker.getBufferedFrag(P,D);if(F&&B.nextStart<F.end)return b.BufferHelper.bufferInfo(g,P,Math.max(B.nextStart,L.maxBufferHole))}return B},n.getMaxBufferLength=function(g){var L,D=this.config;return L=g?Math.max(8*D.maxBufferSize/g,D.maxBufferLength):D.maxBufferLength,Math.min(L,D.maxMaxBufferLength)},n.reduceMaxBufferLength=function(g){var D=this.config;return D.maxMaxBufferLength>=(g||D.maxBufferLength)&&(D.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+D.maxMaxBufferLength+"s"),!0)},n.getNextFragment=function(g,D){var L=D.fragments,P=L.length;if(!P)return null;var U,B=this.config,F=L[0].start;if(D.live){var N=B.initialLiveManifestSize;if(P<N)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+N+")"),null;!D.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(U=this.getInitialLiveFragment(D,L),this.startPosition=U?this.hls.liveSyncPosition||U.start:g)}else g<=F&&(U=L[0]);return U||(U=this.getFragmentAtPosition(g,B.lowLatencyMode?D.partEnd:D.fragmentEnd,D)),this.mapToInitFragWhenRequired(U)},n.mapToInitFragWhenRequired=function(g){return null==g||!g.initSegment||null!=g&&g.initSegment.data||this.bitrateTest?g:g.initSegment},n.getNextPart=function(g,D,L){for(var P=-1,B=!1,F=!0,U=0,N=g.length;U<N;U++){var k=g[U];if(F=F&&!k.independent,P>-1&&L<k.start)break;var K=k.loaded;!K&&(B||k.independent||F)&&k.fragment===D&&(P=U),B=K}return P},n.loadedEndOfParts=function(g,D){var L=g[g.length-1];return L&&D>L.start&&L.loaded},n.getInitialLiveFragment=function(g,D){var L=this.fragPrevious,P=null;if(L){if(g.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+L.programDateTime),P=Object(p.findFragmentByPDT)(D,L.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var B=L.sn+1;if(B>=g.startSN&&B<=g.endSN){var F=D[B-g.startSN];L.cc===F.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(P=F).sn)}P||(P=Object(p.findFragWithCC)(D,L.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn)}}else{var U=this.hls.liveSyncPosition;null!==U&&(P=this.getFragmentAtPosition(U,this.bitrateTest?g.fragmentEnd:g.edge,g))}return P},n.getFragmentAtPosition=function(g,D,L){var w,P=this.config,B=this.fragPrevious,F=L.fragments,U=L.endSN,N=L.fragmentHint,k=P.maxFragLookUpTolerance,K=!!(P.lowLatencyMode&&L.partList&&N);if(K&&N&&!this.bitrateTest&&(F=F.concat(N),U=N.sn),g<D){var W=g>D-k?0:k;w=Object(p.findFragmentByPTS)(B,F,g,W)}else w=F[F.length-1];if(w&&B&&w.sn===B.sn&&!K&&B&&w.level===B.level){var Y=F[w.sn-L.startSN+1];w.sn<U&&this.fragmentTracker.getState(Y)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+Y.sn),w=Y):w=null}return w},n.synchronizeToLiveEdge=function(g){var D=this.config,L=this.media;if(L){var P=this.hls.liveSyncPosition,B=L.currentTime,U=g.edge,N=B>=g.fragments[0].start-D.maxFragLookUpTolerance&&B<=U;null!==P&&L.duration>P&&(B<P||!N)&&(!N&&L.readyState<4||B<U-(void 0!==D.liveMaxLatencyDuration?D.liveMaxLatencyDuration:D.liveMaxLatencyDurationCount*g.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=P),L.readyState&&(this.warn("Playback: "+B.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+P.toFixed(3)),L.currentTime=P))}},n.alignPlaylists=function(g,D){var P=this.levelLastLoaded,B=this.fragPrevious,F=null!==P?this.levels[P]:null,U=g.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var N=g.fragments[0].start,k=!D,K=g.alignedSliding&&Object(C.isFiniteNumber)(N);if(k||!K&&!N){Object(x.alignStream)(B,F,g);var w=g.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(D?D.startSN:"na")+"->"+g.startSN+" prev-sn: "+(B?B.sn:"na")+" fragments: "+U),w}return N},n.waitForCdnTuneIn=function(g){return g.live&&g.canBlockReload&&g.partTarget&&g.tuneInGoal>Math.max(g.partHoldBack,3*g.partTarget)},n.setStartPosition=function(g,D){var L=this.startPosition;if(L<D&&(L=-1),-1===L||-1===this.lastCurrentTime){var P=g.startTimeOffset;Object(C.isFiniteNumber)(P)?(L=D+P,P<0&&(L+=g.totalduration),L=Math.min(Math.max(D,L),D+g.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+L),this.startPosition=L):g.live?L=this.hls.liveSyncPosition||D:this.startPosition=L=0,this.lastCurrentTime=L}this.nextLoadPosition=L},n.getLoadPosition=function(){var g=this.media,D=0;return this.loadedmetadata&&g?D=g.currentTime:this.nextLoadPosition&&(D=this.nextLoadPosition),D},n.handleFragLoadAborted=function(g,D){this.transmuxer&&"initSegment"!==g.sn&&g.stats.aborted&&(this.warn("Fragment "+g.sn+(D?" part"+D.index:"")+" of level "+g.level+" was aborted"),this.resetFragmentLoading(g))},n.resetFragmentLoading=function(g){(!this.fragCurrent||!this.fragContextChanged(g)&&this.state!==c.FRAG_LOADING_WAITING_RETRY)&&(this.state=c.IDLE)},n.onFragmentOrKeyLoadError=function(g,D){if(!D.fatal){var L=D.frag;if(L&&L.type===g){var P=this.fragCurrent;console.assert(P&&L.sn===P.sn&&L.level===P.level&&L.urlId===P.urlId,"Frag load error must match current frag to retry");var B=this.config;if(this.fragLoadError+1<=B.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var F=Math.min(Math.pow(2,this.fragLoadError)*B.fragLoadingRetryDelay,B.fragLoadingMaxRetryTimeout);this.warn("Fragment "+L.sn+" of "+g+" "+L.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else D.levelRetry?(g===a.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(R.logger.error(D.details+" reaches max retry, redispatch as fatal ..."),D.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}}},n.afterBufferFlushed=function(g,D,L){if(g){var P=b.BufferHelper.getBuffered(g);this.fragmentTracker.detectEvictedFragments(D,P,L),this.state===c.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},n.resetStartWhenNotLoaded=function(g){if(!this.loadedmetadata){this.startFragRequested=!1;var D=this.levels?this.levels[g].details:null;null!=D&&D.live?(this.startPosition=-1,this.setStartPosition(D,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.updateLevelTiming=function(g,D,L,P){var B=this,F=L.details;console.assert(!!F,"level.details must be defined"),Object.keys(g.elementaryStreams).reduce(function(N,k){var K=g.elementaryStreams[k];if(K){var w=K.endPTS-K.startPTS;if(w<=0)return B.warn("Could not parse fragment "+g.sn+" "+k+" duration reliably ("+w+")"),N||!1;var W=P?0:Object(T.updateFragPTSDTS)(F,g,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return B.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:F,level:L,drift:W,type:k,frag:g,start:K.startPTS,end:K.endPTS}),!0}return N},!1)||(this.warn("Found no media in fragment "+g.sn+" of level "+L.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=c.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:g,part:D})},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function m(s,u,n){return u&&h(s.prototype,u),n&&h(s,n),Object.defineProperty(s,"prototype",{writable:!1}),s}(u,[{key:"state",get:function(){return this._state},set:function(g){var D=this._state;D!==g&&(this._state=g,this.log(D+"->"+g))}}]),u}(O.default)},"./src/controller/buffer-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return p});var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts"),b=S("./src/errors.ts"),R=S("./src/utils/buffer-helper.ts"),I=S("./src/utils/mediasource-helper.ts"),v=S("./src/loader/fragment.ts"),E=S("./src/controller/buffer-operation-queue.ts"),o=Object(I.getMediaSource)(),x=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function T(d){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=e.hls,h=e.media,m=e.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),h&&(e.updateMediaElementDuration(),a.trigger(O.Events.MEDIA_ATTACHED,{media:h})),m&&m.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=d,this._initSourceBuffer(),this.registerListeners()}var y=T.prototype;return y.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},y.destroy=function(){this.unregisterListeners(),this.details=null},y.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.Events.BUFFER_RESET,this.onBufferReset,this),e.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.Events.BUFFER_EOS,this.onBufferEos,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.Events.FRAG_PARSED,this.onFragParsed,this),e.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},y.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.Events.BUFFER_RESET,this.onBufferReset,this),e.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.Events.BUFFER_EOS,this.onBufferEos,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.Events.FRAG_PARSED,this.onFragParsed,this),e.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},y._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new E.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},y.onManifestParsed=function(e,a){var h=2;(a.audio&&!a.video||!a.altAudio)&&(h=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=h,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},y.onMediaAttaching=function(e,a){var h=this.media=a.media;if(h&&o){var m=this.mediaSource=new o;m.addEventListener("sourceopen",this._onMediaSourceOpen),m.addEventListener("sourceended",this._onMediaSourceEnded),m.addEventListener("sourceclose",this._onMediaSourceClose),h.src=self.URL.createObjectURL(m),this._objectUrl=h.src}},y.onMediaDetaching=function(){var e=this.media,a=this.mediaSource,h=this._objectUrl;if(a){if(A.logger.log("[buffer-controller]: media source detaching"),"open"===a.readyState)try{a.endOfStream()}catch(m){A.logger.warn("[buffer-controller]: onMediaDetaching: "+m.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(h&&self.URL.revokeObjectURL(h),e.src===h?(e.removeAttribute("src"),e.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},y.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(a){var h=e.sourceBuffer[a];try{h&&(e.removeBufferListeners(a),e.mediaSource&&e.mediaSource.removeSourceBuffer(h),e.sourceBuffer[a]=void 0)}catch(m){A.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",m)}}),this._initSourceBuffer()},y.onBufferCodecs=function(e,a){var h=this,m=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(i){if(m){var r=h.tracks[i];if(r&&"function"==typeof r.buffer.changeType){var l=a[i],c=l.id,t=l.codec,s=l.levelCodec,u=l.container,n=l.metadata,f=(r.levelCodec||r.codec).replace(x,"$1"),g=(s||t).replace(x,"$1");f!==g&&(h.appendChangeType(i,u+";codecs="+(s||t)),A.logger.log("[buffer-controller]: switching codec "+f+" to "+g),h.tracks[i]={buffer:r.buffer,codec:t,container:u,levelCodec:s,metadata:n,id:c})}}else h.pendingTracks[i]=a[i]}),!m&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},y.appendChangeType=function(e,a){var h=this,m=this.operationQueue,i={execute:function(){var l=h.sourceBuffer[e];l&&(A.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+a),l.changeType(a)),m.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(l){A.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",l)}};m.append(i,e)},y.onBufferAppending=function(e,a){var h=this,m=this.hls,i=this.operationQueue,r=this.tracks,l=a.data,c=a.type,t=a.frag,s=a.part,u=a.chunkMeta,n=u.buffering[c],f=self.performance.now();n.start=f;var g=t.stats.buffering,D=s?s.stats.buffering:null;0===g.start&&(g.start=f),D&&0===D.start&&(D.start=f);var L=r.audio,P="audio"===c&&1===u.id&&"audio/mpeg"===(null==L?void 0:L.container);i.append({execute:function(){if(n.executeStart=self.performance.now(),P){var U=h.sourceBuffer[c];if(U){var N=t.start-U.timestampOffset;Math.abs(N)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+t.start+" (delta: "+N+") sn: "+t.sn+")"),U.timestampOffset=t.start)}}h.appendExecutor(l,c)},onStart:function(){},onComplete:function(){var U=self.performance.now();n.executeEnd=n.end=U,0===g.first&&(g.first=U),D&&0===D.first&&(D.first=U);var N=h.sourceBuffer,k={};for(var K in N)k[K]=R.BufferHelper.getBuffered(N[K]);h.appendError=0,h.hls.trigger(O.Events.BUFFER_APPENDED,{type:c,frag:t,part:s,chunkMeta:u,parent:t.type,timeRanges:k})},onError:function(U){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",U);var N={type:b.ErrorTypes.MEDIA_ERROR,parent:t.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?N.details=b.ErrorDetails.BUFFER_FULL_ERROR:(h.appendError++,N.details=b.ErrorDetails.BUFFER_APPEND_ERROR,h.appendError>m.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+m.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),N.fatal=!0,m.stopLoad())),m.trigger(O.Events.ERROR,N)}},c)},y.onBufferFlushing=function(e,a){var h=this,m=this.operationQueue,i=function(l){return{execute:h.removeExecutor.bind(h,l,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){h.hls.trigger(O.Events.BUFFER_FLUSHED,{type:l})},onError:function(t){A.logger.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",t)}}};a.type?m.append(i(a.type),a.type):this.getSourceBufferTypes().forEach(function(r){m.append(i(r),r)})},y.onFragParsed=function(e,a){var h=this,m=a.frag,i=a.part,r=[],l=i?i.elementaryStreams:m.elementaryStreams;l[v.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(l[v.ElementaryStreamTypes.AUDIO]&&r.push("audio"),l[v.ElementaryStreamTypes.VIDEO]&&r.push("video"));0===r.length&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+m.type+" level: "+m.level+" sn: "+m.sn),this.blockBuffers(function(){var s=self.performance.now();m.stats.buffering.end=s,i&&(i.stats.buffering.end=s),h.hls.trigger(O.Events.FRAG_BUFFERED,{frag:m,part:i,stats:i?i.stats:m.stats,id:m.type})},r)},y.onFragChanged=function(e,a){this.flushBackBuffer()},y.onBufferEos=function(e,a){var h=this;this.getSourceBufferTypes().reduce(function(i,r){var l=h.sourceBuffer[r];return(!a.type||a.type===r)&&l&&!l.ended&&(l.ended=!0,A.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),i&&!(l&&!l.ended)},!0)&&this.blockBuffers(function(){var i=h.mediaSource;!i||"open"!==i.readyState||i.endOfStream()})},y.onLevelUpdated=function(e,a){var h=a.details;!h.fragments.length||(this.details=h,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},y.flushBackBuffer=function(){var e=this.hls,a=this.details,h=this.media,m=this.sourceBuffer;if(h&&null!==a){var i=this.getSourceBufferTypes();if(i.length){var r=a.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(C.isFiniteNumber)(r)&&!(r<0)){var l=h.currentTime,c=a.levelTargetDuration,t=Math.max(r,c),s=Math.floor(l/c)*c-t;i.forEach(function(u){var n=m[u];if(n){var f=R.BufferHelper.getBuffered(n);f.length>0&&s>f.start(0)&&(e.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),a.live&&e.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),e.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:u}))}})}}}},y.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,a=this.hls,m=this.mediaSource,i=e.fragments[0].start+e.totalduration,r=this.media.duration,l=Object(C.isFiniteNumber)(m.duration)?m.duration:0;e.live&&a.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),m.duration=1/0,this.updateSeekableRange(e)):(i>l&&i>r||!Object(C.isFiniteNumber)(r))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),m.duration=i)}},y.updateSeekableRange=function(e){var a=this.mediaSource,h=e.fragments;if(h.length&&e.live&&null!=a&&a.setLiveSeekableRange){var i=Math.max(0,h[0].start),r=Math.max(i,i+e.totalduration);a.setLiveSeekableRange(i,r)}},y.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,a=this.operationQueue,h=this.pendingTracks,m=Object.keys(h).length;if(m&&!e||2===m){this.createSourceBuffers(h),this.pendingTracks={};var i=this.getSourceBufferTypes();if(0===i.length)return void this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});i.forEach(function(r){a.executeNext(r)})}},y.createSourceBuffers=function(e){var a=this.sourceBuffer,h=this.mediaSource;if(!h)throw Error("createSourceBuffers called when mediaSource was null");var m=0;for(var i in e)if(!a[i]){var r=e[i];if(!r)throw Error("source buffer exists for track "+i+", however track does not");var l=r.levelCodec||r.codec,c=r.container+";codecs="+l;A.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var t=a[i]=h.addSourceBuffer(c),s=i;this.addBufferListener(s,"updatestart",this._onSBUpdateStart),this.addBufferListener(s,"updateend",this._onSBUpdateEnd),this.addBufferListener(s,"error",this._onSBUpdateError),this.tracks[i]={buffer:t,codec:l,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},m++}catch(u){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+u.message),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,mimeType:c})}}m&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},y._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},y._onSBUpdateEnd=function(e){var a=this.operationQueue;a.current(e).onComplete(),a.shiftAndExecuteNext(e)},y._onSBUpdateError=function(e,a){A.logger.error("[buffer-controller]: "+e+" SourceBuffer error",a),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var h=this.operationQueue.current(e);h&&h.onError(a)},y.removeExecutor=function(e,a,h){var m=this.media,i=this.mediaSource,r=this.operationQueue,c=this.sourceBuffer[e];if(!m||!i||!c)return A.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var t=Object(C.isFiniteNumber)(m.duration)?m.duration:1/0,s=Object(C.isFiniteNumber)(i.duration)?i.duration:1/0,u=Math.max(0,a),n=Math.min(h,t,s);n>u?(A.logger.log("[buffer-controller]: Removing ["+u+","+n+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(u,n)):r.shiftAndExecuteNext(e)},y.appendExecutor=function(e,a){var h=this.operationQueue,i=this.sourceBuffer[a];if(!i)return A.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),void h.shiftAndExecuteNext(a);i.ended=!1,console.assert(!i.updating,a+" sourceBuffer must not be updating"),i.appendBuffer(e)},y.blockBuffers=function(e,a){var h=this;if(void 0===a&&(a=this.getSourceBufferTypes()),!a.length)return A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var m=this.operationQueue,i=a.map(function(r){return m.appendBlocker(r)});Promise.all(i).then(function(){e(),a.forEach(function(r){var l=h.sourceBuffer[r];(!l||!l.updating)&&m.shiftAndExecuteNext(r)})})},y.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},y.addBufferListener=function(e,a,h){var m=this.sourceBuffer[e];if(m){var i=h.bind(this,e);this.listeners[e].push({event:a,listener:i}),m.addEventListener(a,i)}},y.removeBufferListeners=function(e){var a=this.sourceBuffer[e];!a||this.listeners[e].forEach(function(h){a.removeEventListener(h.event,h.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return O});var C=S("./src/utils/logger.ts"),O=function(){function A(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var b=A.prototype;return b.append=function(I,v){var E=this.queues[v];E.push(I),1===E.length&&this.buffers[v]&&this.executeNext(v)},b.insertAbort=function(I,v){this.queues[v].unshift(I),this.executeNext(v)},b.appendBlocker=function(I){var v,E=new Promise(function(x){v=x});return this.append({execute:v,onStart:function(){},onComplete:function(){},onError:function(){}},I),E},b.executeNext=function(I){var o=this.buffers[I],x=this.queues[I];if(x.length){var p=x[0];try{p.execute()}catch(T){C.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),p.onError(T),(!o||!o.updating)&&(x.shift(),this.executeNext(I))}}},b.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},b.current=function(I){return this.queues[I][0]},A}()},"./src/controller/cap-level-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/events.ts");function O(R,I){for(var v=0;v<I.length;v++){var E=I[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(R,E.key,E)}}M.default=function(){function R(v){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=v,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=R.prototype;return I.setStreamController=function(E){this.streamController=E},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var E=this.hls;E.on(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),E.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var E=this.hls;E.off(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),E.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(E,o){R.isLevelAllowed(o.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(o.droppedLevel)},I.onMediaAttaching=function(E,o){this.media=o.media instanceof HTMLVideoElement?o.media:null},I.onManifestParsed=function(E,o){var x=this.hls;this.restrictedLevels=[],this.firstLevel=o.firstLevel,x.config.capLevelToPlayerSize&&o.video&&this.startCapping()},I.onBufferCodecs=function(E,o){this.hls.config.capLevelToPlayerSize&&o.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var E=this.hls.levels;if(E.length){var o=this.hls;o.autoLevelCapping=this.getMaxLevel(E.length-1),o.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=o.autoLevelCapping}}},I.getMaxLevel=function(E){var o=this,x=this.hls.levels;if(!x.length)return-1;var p=x.filter(function(T,y){return R.isLevelAllowed(y,o.restrictedLevels)&&y<=E});return this.clientRect=null,R.getMaxLevelByMediaSize(p,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var E=this.media,o={width:0,height:0};if(E){var x=E.getBoundingClientRect();o.width=x.width,o.height=x.height,!o.width&&!o.height&&(o.width=x.right-x.left||E.width||0,o.height=x.bottom-x.top||E.height||0)}return this.clientRect=o,o},R.isLevelAllowed=function(E,o){return void 0===o&&(o=[]),-1===o.indexOf(E)},R.getMaxLevelByMediaSize=function(E,o,x){if(!E||!E.length)return-1;for(var T=E.length-1,y=0;y<E.length;y+=1){var d=E[y];if((d.width>=o||d.height>=x)&&(a=d,!(h=E[y+1])||a.width!==h.width||a.height!==h.height)){T=y;break}}var a,h;return T},function A(R,I,v){return I&&O(R.prototype,I),v&&O(R,v),Object.defineProperty(R,"prototype",{writable:!1}),R}(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var E=1;if(!this.hls.config.ignoreDevicePixelRatio)try{E=self.devicePixelRatio}catch(o){}return E}}]),R}()},"./src/controller/cmcd-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return p});var C=S("./src/events.ts"),O=S("./src/types/cmcd.ts"),A=S("./src/utils/buffer-helper.ts"),b=S("./src/utils/logger.ts");function R(T,y){for(var d=0;d<y.length;d++){var e=y[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(T,e.key,e)}}function I(T,y,d){return y&&R(T.prototype,y),d&&R(T,d),Object.defineProperty(T,"prototype",{writable:!1}),T}function v(T,y){var d="undefined"!=typeof Symbol&&T[Symbol.iterator]||T["@@iterator"];if(d)return(d=d.call(T)).next.bind(d);if(Array.isArray(T)||(d=function E(T,y){if(T){if("string"==typeof T)return o(T,y);var d=Object.prototype.toString.call(T).slice(8,-1);if("Object"===d&&T.constructor&&(d=T.constructor.name),"Map"===d||"Set"===d)return Array.from(T);if("Arguments"===d||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(T,y)}}(T))||y&&T&&"number"==typeof T.length){d&&(T=d);var e=0;return function(){return e>=T.length?{done:!0}:{done:!1,value:T[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(T,y){(null==y||y>T.length)&&(y=T.length);for(var d=0,e=new Array(y);d<y;d++)e[d]=T[d];return e}function x(){return x=Object.assign?Object.assign.bind():function(T){for(var y=1;y<arguments.length;y++){var d=arguments[y];for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(T[e]=d[e])}return T},x.apply(this,arguments)}var p=function(){function T(d){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(m){try{e.apply(m,{ot:O.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(i){b.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(m){try{var i=m.frag,r=e.hls.levels[i.level],l=e.getObjectType(i),c={d:1e3*i.duration,ot:l};(l===O.CMCDObjectType.VIDEO||l===O.CMCDObjectType.AUDIO||l==O.CMCDObjectType.MUXED)&&(c.br=r.bitrate/1e3,c.tb=e.getTopBandwidth(l)/1e3,c.bl=e.getBufferLength(l)),e.apply(m,c)}catch(t){b.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=d;var a=this.config=d.config,h=a.cmcd;null!=h&&(a.pLoader=this.createPlaylistLoader(),a.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||T.uuid(),this.cid=h.contentId,this.useHeaders=!0===h.useHeaders,this.registerListeners())}var y=T.prototype;return y.registerListeners=function(){var e=this.hls;e.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this)},y.unregisterListeners=function(){var e=this.hls;e.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},y.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},y.onMediaAttached=function(e,a){this.media=a.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},y.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},y.onBufferCreated=function(e,a){var h,m;this.audioBuffer=null===(h=a.tracks.audio)||void 0===h?void 0:h.buffer,this.videoBuffer=null===(m=a.tracks.video)||void 0===m?void 0:m.buffer},y.createData=function(){var e;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},y.apply=function(e,a){if(void 0===a&&(a={}),x(a,this.createData()),this.starved&&(a.ot===O.CMCDObjectType.INIT||a.ot===O.CMCDObjectType.VIDEO||a.ot===O.CMCDObjectType.MUXED)&&(a.bs=!0,a.su=!0,this.starved=!1),null==a.su&&(a.su=this.buffering),this.useHeaders){var m=T.toHeaders(a);if(!Object.keys(m).length)return;e.headers||(e.headers={}),x(e.headers,m)}else{var i=T.toQuery(a);if(!i)return;e.url=T.appendQueryToUri(e.url,i)}},y.getObjectType=function(e){var a=e.type;return"subtitle"===a?O.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?O.CMCDObjectType.INIT:"audio"===a?O.CMCDObjectType.AUDIO:"main"===a?this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED:void 0},y.getTopBandwidth=function(e){var h,a=0,m=this.hls;if(e===O.CMCDObjectType.AUDIO)h=m.audioTracks;else{var i=m.maxAutoLevel;h=m.levels.slice(0,i>-1?i+1:m.levels.length)}for(var c,l=v(h);!(c=l()).done;){var t=c.value;t.bitrate>a&&(a=t.bitrate)}return a>0?a:NaN},y.getBufferLength=function(e){var a=this.hls.media,h=e===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return h&&a?1e3*A.BufferHelper.bufferInfo(h,a.currentTime,this.config.maxBufferHole).len:NaN},y.createPlaylistLoader=function(){var a=this.applyPlaylistData,h=this.config.pLoader||this.config.loader;return function(){function m(r){this.loader=void 0,this.loader=new h(r)}var i=m.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(l,c,t){a(l),this.loader.load(l,c,t)},I(m,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),m}()},y.createFragmentLoader=function(){var a=this.applyFragmentData,h=this.config.fLoader||this.config.loader;return function(){function m(r){this.loader=void 0,this.loader=new h(r)}var i=m.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(l,c,t){a(l),this.loader.load(l,c,t)},I(m,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),m}()},T.uuid=function(){var e=URL.createObjectURL(new Blob),a=e.toString();return URL.revokeObjectURL(e),a.slice(a.lastIndexOf("/")+1)},T.serialize=function(e){for(var s,a=[],m=function(P){return Math.round(P)},i=function(P){return 100*m(P/100)},l={br:m,d:m,bl:i,dl:i,mtp:i,nor:function(P){return encodeURIComponent(P)},rtp:i,tb:m},t=v(Object.keys(e||{}).sort());!(s=t()).done;){var u=s.value,n=e[u];if(!(P=n,Number.isNaN(P)||null==P||""===P||!1===P||"v"===u&&1===n||"pr"==u&&1===n)){var f=l[u];f&&(n=f(n));var D,g=typeof n;D="ot"===u||"sf"===u||"st"===u?u+"="+n:"boolean"===g?u:"number"===g?u+"="+n:u+"="+JSON.stringify(n),a.push(D)}}var P;return a.join(",")},T.toHeaders=function(e){for(var h={},m=["Object","Request","Session","Status"],i=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},l=0,c=Object.keys(e);l<c.length;l++){var t=c[l];i[null!=r[t]?r[t]:1][t]=e[t]}for(var u=0;u<i.length;u++){var n=T.serialize(i[u]);n&&(h["CMCD-"+m[u]]=n)}return h},T.toQuery=function(e){return"CMCD="+encodeURIComponent(T.serialize(e))},T.appendQueryToUri=function(e,a){if(!a)return e;var h=e.includes("?")?"&":"?";return""+e+h+a},T}()},"./src/controller/eme-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/utils/logger.ts"),b=S("./src/utils/mediakeys-helper.ts");function R(p,T){for(var y=0;y<T.length;y++){var d=T[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(p,d.key,d)}}M.default=function(){function p(y){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=y,this._config=y.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var T=p.prototype;return T.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},T._registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T._unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T.getLicenseServerUrl=function(d){switch(d){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+d+'"')},T._attemptKeySystemAccess=function(d,e,a){var h=this,m=function(T,y,d,e){if(T===b.KeySystems.WIDEVINE)return function(T,y,d){var e={audioCapabilities:[],videoCapabilities:[]};return T.forEach(function(a){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:d.audioRobustness||""})}),y.forEach(function(a){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:d.videoRobustness||""})}),[e]}(y,d,e);throw new Error("Unknown key-system: "+T)}(d,e,a,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var i=this.requestMediaKeySystemAccess(d,m);this.mediaKeysPromise=i.then(function(r){return h._onMediaKeySystemAccessObtained(d,r)}),i.catch(function(r){A.logger.error('Failed to obtain key-system "'+d+'" access:',r)})},T._onMediaKeySystemAccessObtained=function(d,e){var a=this;A.logger.log('Access for key-system "'+d+'" obtained');var h={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:d};this._mediaKeysList.push(h);var m=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(i){return h.mediaKeys=i,A.logger.log('Media-keys created for key-system "'+d+'"'),a._onMediaKeysCreated(),i});return m.catch(function(i){A.logger.error("Failed to create media-keys:",i)}),m},T._onMediaKeysCreated=function(){var d=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),d._onNewMediaKeySession(e.mediaKeysSession))})},T._onNewMediaKeySession=function(d){var e=this;A.logger.log("New key-system session "+d.sessionId),d.addEventListener("message",function(a){e._onKeySessionMessage(d,a.message)},!1)},T._onKeySessionMessage=function(d,e){A.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(a){A.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),d.update(a).catch(function(h){A.logger.warn("Updating key-session failed: "+h)})})},T.onMediaEncrypted=function(d){var e=this;if(A.logger.log('Media is encrypted using "'+d.initDataType+'" init data type'),!this.mediaKeysPromise)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var a=function(m){!e._media||(e._attemptSetMediaKeys(m),e._generateRequestWithPreferredKeySession(d.initDataType,d.initData))};this.mediaKeysPromise.then(a).catch(a)},T._attemptSetMediaKeys=function(d){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},T._generateRequestWithPreferredKeySession=function(d,e){var a=this,h=this._mediaKeysList[0];if(!h)return A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(!h.mediaKeysSessionInitialized){var m=h.mediaKeysSession;return m?e?(A.logger.log('Generating key-session request for "'+d+'" init data type'),h.mediaKeysSessionInitialized=!0,void m.generateRequest(d,e).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(i){A.logger.error("Error generating key-session request:",i),a.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})):(A.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(A.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}A.logger.warn("Key-Session already initialized but requested again")},T._createLicenseXhr=function(d,e,a){var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,h,d,e,a);var m=this._licenseXhrSetup;if(m)try{m.call(this.hls,h,d),m=void 0}catch(i){A.logger.error(i)}try{h.readyState||h.open("POST",d,!0),m&&m.call(this.hls,h,d)}catch(i){throw new Error("issue setting up KeySystem license XHR "+i)}return h},T._onLicenseRequestReadyStageChange=function(d,e,a,h){if(4===d.readyState)if(200===d.status){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var m=d.response,i=this._licenseResponseCallback;if(i)try{m=i.call(this.hls,d,e)}catch(l){A.logger.error(l)}h(m)}else{if(A.logger.error("License Request XHR failed ("+e+"). Status: "+d.status+" ("+d.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});A.logger.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),this._requestLicense(a,h)}},T._generateLicenseRequestChallenge=function(d,e){if(d.mediaKeySystemDomain===b.KeySystems.WIDEVINE)return e;throw new Error("unsupported key-system: "+d.mediaKeySystemDomain)},T._requestLicense=function(d,e){A.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a)return A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var h=this.getLicenseServerUrl(a.mediaKeySystemDomain),m=this._createLicenseXhr(h,d,e);A.logger.log("Sending license request to URL: "+h);var i=this._generateLicenseRequestChallenge(a,d);m.send(i)}catch(r){A.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},T.onMediaAttached=function(d,e){if(this._emeEnabled){var a=e.media;this._media=a,a.addEventListener("encrypted",this._onMediaEncrypted)}},T.onMediaDetached=function(){var d=this._media,e=this._mediaKeysList;!d||(d.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return d.setMediaKeys(null)}).catch(function(){}))},T.onManifestParsed=function(d,e){if(this._emeEnabled){var a=e.levels.map(function(m){return m.audioCodec}).filter(function(m){return!!m}),h=e.levels.map(function(m){return m.videoCodec}).filter(function(m){return!!m});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,a,h)}},function I(p,T,y){return T&&R(p.prototype,T),y&&R(p,y),Object.defineProperty(p,"prototype",{writable:!1}),p}(p,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),p}()},"./src/controller/fps-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/events.ts"),O=S("./src/utils/logger.ts");M.default=function(){function b(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var R=b.prototype;return R.setStreamController=function(v){this.streamController=v},R.registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(v,E){var o=this.hls.config;if(o.capLevelOnFPSDrop){var x=E.media instanceof self.HTMLVideoElement?E.media:null;this.media=x,x&&"function"==typeof x.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),o.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(v,E,o){var x=performance.now();if(E){if(this.lastTime){var T=o-this.lastDroppedFrames,y=E-this.lastDecodedFrames,d=1e3*T/(x-this.lastTime),e=this.hls;if(e.trigger(C.Events.FPS_DROP,{currentDropped:T,currentDecoded:y,totalDroppedFrames:o}),d>0&&T>e.config.fpsDroppedMonitoringThreshold*y){var a=e.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(-1===e.autoLevelCapping||e.autoLevelCapping>=a)&&(e.trigger(C.Events.FPS_DROP_LEVEL_CAPPING,{level:a-=1,droppedLevel:e.currentLevel}),e.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=x,this.lastDroppedFrames=o,this.lastDecodedFrames=E}},R.checkFPSInterval=function(){var v=this.media;if(v)if(this.isVideoPlaybackQualityAvailable){var E=v.getVideoPlaybackQuality();this.checkFPS(v,E.totalVideoFrames,E.droppedVideoFrames)}else this.checkFPS(v,v.webkitDecodedFrameCount,v.webkitDroppedFrameCount)},b}()},"./src/controller/fragment-finders.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"findFragmentByPDT",function(){return A}),S.d(M,"findFragmentByPTS",function(){return b}),S.d(M,"fragmentWithinToleranceTest",function(){return R}),S.d(M,"pdtWithinToleranceTest",function(){return I}),S.d(M,"findFragWithCC",function(){return v});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/binary-search.ts");function A(E,o,x){if(null===o||!Array.isArray(E)||!E.length||!Object(C.isFiniteNumber)(o))return null;if(o<(E[0].programDateTime||0))return null;if(o>=(E[E.length-1].endProgramDateTime||0))return null;x=x||0;for(var y=0;y<E.length;++y){var d=E[y];if(I(o,x,d))return d}return null}function b(E,o,x,p){void 0===x&&(x=0),void 0===p&&(p=0);var T=null;return E?T=o[E.sn-o[0].sn+1]||null:0===x&&0===o[0].start&&(T=o[0]),T&&0===R(x,p,T)?T:O.default.search(o,R.bind(null,x,p))||T}function R(E,o,x){void 0===E&&(E=0),void 0===o&&(o=0);var p=Math.min(o,x.duration+(x.deltaPTS?x.deltaPTS:0));return x.start+x.duration-p<=E?1:x.start-p>E&&x.start?-1:0}function I(E,o,x){var p=1e3*Math.min(o,x.duration+(x.deltaPTS?x.deltaPTS:0));return(x.endProgramDateTime||0)-p>E}function v(E,o){return O.default.search(E,function(x){return x.cc<o?1:x.cc>o?-1:0})}},"./src/controller/fragment-tracker.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"FragmentState",function(){return A}),S.d(M,"FragmentTracker",function(){return b});var C=S("./src/events.ts"),O=S("./src/types/loader.ts"),A=(()=>{return(v=A||(A={})).NOT_LOADED="NOT_LOADED",v.APPENDING="APPENDING",v.PARTIAL="PARTIAL",v.OK="OK",A;var v})(),b=function(){function v(o){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=o,this._registerListeners()}var E=v.prototype;return E._registerListeners=function(){var x=this.hls;x.on(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),x.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),x.on(C.Events.FRAG_LOADED,this.onFragLoaded,this)},E._unregisterListeners=function(){var x=this.hls;x.off(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),x.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),x.off(C.Events.FRAG_LOADED,this.onFragLoaded,this)},E.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},E.getAppendedFrag=function(x,p){if(p===O.PlaylistLevelType.MAIN){var T=this.activeFragment,y=this.activeParts;if(!T)return null;if(y)for(var d=y.length;d--;){var e=y[d],a=e?e.end:T.appendedPTS;if(e.start<=x&&void 0!==a&&x<=a)return d>9&&(this.activeParts=y.slice(d-9)),e}else if(T.start<=x&&void 0!==T.appendedPTS&&x<=T.appendedPTS)return T}return this.getBufferedFrag(x,p)},E.getBufferedFrag=function(x,p){for(var T=this.fragments,y=Object.keys(T),d=y.length;d--;){var e=T[y[d]];if((null==e?void 0:e.body.type)===p&&e.buffered){var a=e.body;if(a.start<=x&&x<=a.end)return a}}return null},E.detectEvictedFragments=function(x,p,T){var y=this;Object.keys(this.fragments).forEach(function(d){var e=y.fragments[d];if(e){if(!e.buffered)return void(e.body.type===T&&y.removeFragment(e.body));var a=e.range[x];!a||a.time.some(function(h){var m=!y.isTimeBuffered(h.startPTS,h.endPTS,p);return m&&y.removeFragment(e.body),m})}})},E.detectPartialFragments=function(x){var p=this,T=this.timeRanges,y=x.frag,d=x.part;if(T&&"initSegment"!==y.sn){var e=I(y),a=this.fragments[e];!a||(Object.keys(T).forEach(function(h){var m=y.elementaryStreams[h];m&&(a.range[h]=p.getBufferedTimes(y,d,null!==d||!0===m.partial,T[h]))}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},E.fragBuffered=function(x){var p=I(x),T=this.fragments[p];T&&(T.loaded=null,T.buffered=!0)},E.getBufferedTimes=function(x,p,T,y){for(var d={time:[],partial:T},e=p?p.start:x.start,a=p?p.end:x.end,h=x.minEndPTS||a,m=x.maxStartPTS||e,i=0;i<y.length;i++){var r=y.start(i)-this.bufferPadding,l=y.end(i)+this.bufferPadding;if(m>=r&&h<=l){d.time.push({startPTS:Math.max(e,y.start(i)),endPTS:Math.min(a,y.end(i))});break}if(e<l&&a>r)d.partial=!0,d.time.push({startPTS:Math.max(e,y.start(i)),endPTS:Math.min(a,y.end(i))});else if(a<=r)break}return d},E.getPartialFragment=function(x){var T,y,d,p=null,e=0,a=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(m){var i=h[m];!i||R(i)&&(d=i.body.end+a,x>=(y=i.body.start-a)&&x<=d&&(T=Math.min(x-y,d-x),e<=T&&(p=i.body,e=T)))}),p},E.getState=function(x){var p=I(x),T=this.fragments[p];return T?T.buffered?R(T)?A.PARTIAL:A.OK:A.APPENDING:A.NOT_LOADED},E.isTimeBuffered=function(x,p,T){for(var y,d,e=0;e<T.length;e++){if(y=T.start(e)-this.bufferPadding,d=T.end(e)+this.bufferPadding,x>=y&&p<=d)return!0;if(p<=y)return!1}return!1},E.onFragLoaded=function(x,p){var T=p.frag;if("initSegment"!==T.sn&&!T.bitrateTest&&!p.part){var d=I(T);this.fragments[d]={body:T,loaded:p,buffered:!1,range:Object.create(null)}}},E.onBufferAppended=function(x,p){var T=this,y=p.frag,d=p.part,e=p.timeRanges;if(y.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=y,d){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(d)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(h){var m=e[h];if(T.detectEvictedFragments(h,m),!d)for(var i=0;i<m.length;i++)y.appendedPTS=Math.max(m.end(i),y.appendedPTS||0)})},E.onFragBuffered=function(x,p){this.detectPartialFragments(p)},E.hasFragment=function(x){var p=I(x);return!!this.fragments[p]},E.removeFragmentsInRange=function(x,p,T){var y=this;Object.keys(this.fragments).forEach(function(d){var e=y.fragments[d];if(e&&e.buffered){var a=e.body;a.type===T&&a.start<p&&a.end>x&&y.removeFragment(a)}})},E.removeFragment=function(x){var p=I(x);x.stats.loaded=0,x.clearElementaryStreamInfo(),delete this.fragments[p]},E.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},v}();function R(v){var E,o;return v.buffered&&((null===(E=v.range.video)||void 0===E?void 0:E.partial)||(null===(o=v.range.audio)||void 0===o?void 0:o.partial))}function I(v){return v.type+"_"+v.level+"_"+v.urlId+"_"+v.sn}},"./src/controller/gap-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"STALL_MINIMUM_DURATION_MS",function(){return R}),S.d(M,"MAX_START_GAP_JUMP",function(){return I}),S.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return v}),S.d(M,"SKIP_BUFFER_RANGE_START",function(){return E}),S.d(M,"default",function(){return o});var C=S("./src/utils/buffer-helper.ts"),O=S("./src/errors.ts"),A=S("./src/events.ts"),b=S("./src/utils/logger.ts"),R=250,I=2,v=.1,E=.05,o=function(){function x(T,y,d,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=y,this.fragmentTracker=d,this.hls=e}var p=x.prototype;return p.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},p.poll=function(y,d){var e=this.config,a=this.media,h=this.stalled;if(null!==a){var m=a.currentTime,i=a.seeking,r=this.seeking&&!i,l=!this.seeking&&i;if(this.seeking=i,m!==y){if(this.moved=!0,null!==h){if(this.stallReported){var c=self.performance.now()-h;b.logger.warn("playback not stuck anymore @"+m+", after "+Math.round(c)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((l||r)&&(this.stalled=null),!(a.paused&&!i||a.ended||0===a.playbackRate)&&C.BufferHelper.getBuffered(a).length){var t=C.BufferHelper.bufferInfo(a,m,0),u=t.nextStart||0;if(t.len>0||u){if(i){var n=t.len>I,f=!u||d&&d.start<=m||u-m>I&&!this.fragmentTracker.getPartialFragment(m);if(n||f)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var g,D=Math.max(u,t.start||0)-m,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=null==L||null===(g=L.details)||void 0===g?void 0:g.live;if(D>0&&D<=(P?2*L.details.targetduration:I))return void this._trySkipBufferHole(null)}var F=self.performance.now();if(null===h)return void(this.stalled=F);var U=F-h;if(i||!(U>=R)||(this._reportStall(t),this.media)){var N=C.BufferHelper.bufferInfo(a,m,e.maxBufferHole);this._tryFixBufferStall(N,U)}}}}},p._tryFixBufferStall=function(y,d){var e=this.config,h=this.media;if(null!==h){var i=this.fragmentTracker.getPartialFragment(h.currentTime);if(i&&(this._trySkipBufferHole(i)||!this.media))return;y.len>e.maxBufferHole&&d>1e3*e.highBufferWatchdogPeriod&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},p._reportStall=function(y){var d=this.hls,e=this.media;!this.stallReported&&e&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(y)+")"),d.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y.len}))},p._trySkipBufferHole=function(y){var d=this.config,e=this.hls,a=this.media;if(null===a)return 0;for(var h=a.currentTime,m=0,i=C.BufferHelper.getBuffered(a),r=0;r<i.length;r++){var l=i.start(r);if(h+d.maxBufferHole>=m&&h<l){var c=Math.max(l+E,a.currentTime+v);return b.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+c),this.moved=!0,this.stalled=null,a.currentTime=c,y&&e.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+c,frag:y}),c}m=i.end(r)}return 0},p._tryNudgeBuffer=function(){var y=this.config,d=this.hls,e=this.media,a=this.nudgeRetry;if(null!==e){var h=e.currentTime;if(this.nudgeRetry++,a<y.nudgeMaxRetry){var m=h+(a+1)*y.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+h+" to "+m),e.currentTime=m,d.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+h+" after "+y.nudgeMaxRetry+" nudges"),d.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},x}()},"./src/controller/id3-track-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/texttrack-utils.ts"),b=S("./src/demux/id3.ts"),R=S("./src/loader/date-range.ts"),I=S("./src/types/demuxer.ts");function E(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function o(T,y){return T.getTime()/1e3-y}function x(T){return Uint8Array.from(T.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}M.default=function(){function T(d){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=d,this._registerListeners()}var y=T.prototype;return y.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},y._registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},y._unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},y.onMediaAttached=function(e,a){this.media=a.media},y.onMediaDetaching=function(){!this.id3Track||(Object(A.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},y.onManifestLoading=function(){this.dateRangeCuesAppended={}},y.createTrack=function(e){var a=this.getID3Track(e.textTracks);return a.mode="hidden",a},y.getID3Track=function(e){if(this.media){for(var a=0;a<e.length;a++){var h=e[a];if("metadata"===h.kind&&"id3"===h.label)return Object(A.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},y.onFragParsingMetadata=function(e,a){if(this.media){var h=this.hls.config,m=h.enableEmsgMetadataCues,i=h.enableID3MetadataCues;if(m||i){var r=a.frag,l=a.samples,c=a.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var t=c.edge||r.end,s=E(),u=!1,n={},f=0;f<l.length;f++){var g=l[f].type;if((g!==I.MetadataSchema.emsg||m)&&i){var D=b.getID3Frames(l[f].data);if(D){var L=l[f].pts,P=t;P-L<=0&&(P=L+.25);for(var F=0;F<D.length;F++){var U=D[F];if(!b.isTimeStampFrame(U)){var N=new s(L,P,"");N.value=U,g&&(N.type=g),this.id3Track.addCue(N),n[U.key]=null,u=!0}}}}}u&&this.updateId3CueEnds(n)}}},y.updateId3CueEnds=function(e){var a,h=null===(a=this.id3Track)||void 0===a?void 0:a.cues;if(h)for(var m=h.length;m--;){var i,r=h[m],l=null===(i=r.value)||void 0===i?void 0:i.key;if(l&&l in e){var c=e[l];c&&r.endTime!==c&&(r.endTime=c),e[l]=r.startTime}}},y.onBufferFlushing=function(e,a){var h=a.startOffset,m=a.endOffset,i=a.type,r=this.id3Track,l=this.hls;if(l){var u,c=l.config,t=c.enableEmsgMetadataCues,s=c.enableID3MetadataCues;r&&(t||s)&&(u="audio"===i?function(f){return f.type===I.MetadataSchema.audioId3&&s}:"video"===i?function(f){return f.type===I.MetadataSchema.emsg&&t}:function(f){return f.type===I.MetadataSchema.audioId3&&s||f.type===I.MetadataSchema.emsg&&t},Object(A.removeCuesInRange)(r,h,m,u))}},y.onLevelUpdated=function(e,a){var h=this,m=a.details;if(this.media&&m.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var i=this.dateRangeCuesAppended,r=this.id3Track,l=m.dateRanges,c=Object.keys(l);if(r)for(var t=Object.keys(i).filter(function(B){return!c.includes(B)}),s=function(F){var U=t[F];Object.keys(i[U].cues).forEach(function(N){r.removeCue(i[U].cues[N])}),delete i[U]},u=t.length;u--;)s(u);var n=m.fragments[m.fragments.length-1];if(0!==c.length&&Object(C.isFiniteNumber)(null==n?void 0:n.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=n.programDateTime/1e3-n.start,g=m.edge||n.end,D=E(),L=function(F){var U=c[F],N=l[U],k=i[U],K=(null==k?void 0:k.cues)||{},w=(null==k?void 0:k.durationKnown)||!1,W=o(N.startDate,f),j=g,_=N.endDate;if(_)j=o(_,f),w=!0;else if(N.endOnNext&&!w){var Y=c.reduce(function(V,J){var Z=l[J];return Z.class===N.class&&Z.id!==J&&Z.startDate>N.startDate&&V.push(Z),V},[]).sort(function(V,J){return V.startDate.getTime()-J.startDate.getTime()})[0];Y&&(j=o(Y.startDate,f),w=!0)}for(var z=Object.keys(N.attr),X=0;X<z.length;X++){var H=z[X];if(H!==R.DateRangeAttribute.ID&&H!==R.DateRangeAttribute.CLASS&&H!==R.DateRangeAttribute.START_DATE&&H!==R.DateRangeAttribute.DURATION&&H!==R.DateRangeAttribute.END_DATE&&H!==R.DateRangeAttribute.END_ON_NEXT){var $=K[H];if($)w&&!k.durationKnown&&($.endTime=j);else{var Q=N.attr[H];$=new D(W,j,""),(H===R.DateRangeAttribute.SCTE35_OUT||H===R.DateRangeAttribute.SCTE35_IN)&&(Q=x(Q)),$.value={key:H,data:Q},$.type=I.MetadataSchema.dateRange,h.id3Track.addCue($),K[H]=$}}}i[U]={cues:K,dateRange:N,durationKnown:w}},P=0;P<c.length;P++)L(P)}}},T}()},"./src/controller/latency-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return I});var C=S("./src/errors.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts");function b(v,E){for(var o=0;o<E.length;o++){var x=E[o];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(v,x.key,x)}}var I=function(){function v(o){var x=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return x.timeupdate()},this.hls=o,this.config=o.config,this.registerListeners()}var E=v.prototype;return E.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},E.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},E.onMediaAttached=function(x,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},E.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},E.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},E.onLevelUpdated=function(x,p){var T=p.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},E.onError=function(x,p){p.details===C.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},E.timeupdate=function(){var x=this.media,p=this.levelDetails;if(x&&p){this.currentTime=x.currentTime;var T=this.computeLatency();if(null!==T){this._latency=T;var y=this.config,e=y.maxLiveSyncPlaybackRate;if(y.lowLatencyMode&&1!==e){var a=this.targetLatency;if(null!==a){var h=T-a,m=Math.min(this.maxLatency,a+p.targetduration);if(p.live&&h<m&&h>.05&&this.forwardBufferLength>1){var r=Math.min(2,Math.max(1,e)),l=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;x.playbackRate=Math.min(r,Math.max(1,l))}else 1!==x.playbackRate&&0!==x.playbackRate&&(x.playbackRate=1)}}}}},E.estimateLiveEdge=function(){var x=this.levelDetails;return null===x?null:x.edge+x.age},E.computeLatency=function(){var x=this.estimateLiveEdge();return null===x?null:x-this.currentTime},function R(v,E,o){return E&&b(v.prototype,E),o&&b(v,o),Object.defineProperty(v,"prototype",{writable:!1}),v}(v,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var x=this.config,p=this.levelDetails;return void 0!==x.liveMaxLatencyDuration?x.liveMaxLatencyDuration:p?x.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var x=this.levelDetails;if(null===x)return null;var y=x.targetduration,d=this.config,e=d.liveSyncDuration,m=this.hls.userConfig,i=d.lowLatencyMode&&x.partHoldBack||x.holdBack;return(m.liveSyncDuration||m.liveSyncDurationCount||0===i)&&(i=void 0!==e?e:d.liveSyncDurationCount*y),i+Math.min(1*this.stallCount,y)}},{key:"liveSyncPosition",get:function(){var x=this.estimateLiveEdge(),p=this.targetLatency,T=this.levelDetails;if(null===x||null===p||null===T)return null;var y=T.edge,a=y-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(y-T.totalduration,x-p-this.edgeStalled),a)}},{key:"drift",get:function(){var x=this.levelDetails;return null===x?1:x.drift}},{key:"edgeStalled",get:function(){var x=this.levelDetails;return null===x?0:Math.max(x.age-3*(this.config.lowLatencyMode&&x.partTarget||x.targetduration),0)}},{key:"forwardBufferLength",get:function(){var x=this.media,p=this.levelDetails;if(!x||!p)return 0;var T=x.buffered.length;return(T?x.buffered.end(T-1):p.edge)-this.currentTime}}]),v}()},"./src/controller/level-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return d});var C=S("./src/types/level.ts"),O=S("./src/events.ts"),A=S("./src/errors.ts"),b=S("./src/utils/codecs.ts"),R=S("./src/controller/level-helper.ts"),I=S("./src/controller/base-playlist-controller.ts"),v=S("./src/types/loader.ts");function E(){return E=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(e[m]=h[m])}return e},E.apply(this,arguments)}function o(e,a){for(var h=0;h<a.length;h++){var m=a[h];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(e,m.key,m)}}function p(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,T(e,a)}function T(e,a){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,i){return m.__proto__=i,m})(e,a)}var y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(e){function a(m){var i;return(i=e.call(this,m,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}p(a,e);var h=a.prototype;return h._registerListeners=function(){var i=this.hls;i.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(O.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var i=this.hls;i.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(O.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},h.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),e.prototype.startLoad.call(this)},h.onManifestLoaded=function(i,r){var s,n,l=[],c=[],t=[],u={},f=!1,g=!1,D=!1;if(r.levels.forEach(function(F){var U=F.attrs;f=f||!(!F.width||!F.height),g=g||!!F.videoCodec,D=D||!!F.audioCodec,y&&F.audioCodec&&-1!==F.audioCodec.indexOf("mp4a.40.34")&&(F.audioCodec=void 0);var N=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;(n=u[N])?n.url.push(F.url):(n=new C.Level(F),u[N]=n,l.push(n)),U&&(U.AUDIO&&Object(R.addGroupId)(n,"audio",U.AUDIO),U.SUBTITLES&&Object(R.addGroupId)(n,"text",U.SUBTITLES))}),(f||g)&&D&&(l=l.filter(function(F){return!!F.videoCodec||!(!F.width||!F.height)})),l=l.filter(function(F){var U=F.audioCodec,N=F.videoCodec;return(!U||Object(b.isCodecSupportedInMp4)(U,"audio"))&&(!N||Object(b.isCodecSupportedInMp4)(N,"video"))}),r.audioTracks&&(c=r.audioTracks.filter(function(F){return!F.audioCodec||Object(b.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(R.assignTrackIdsByGroup)(c)),r.subtitles&&(t=r.subtitles,Object(R.assignTrackIdsByGroup)(t)),l.length>0){s=l[0].bitrate,l.sort(function(F,U){return F.bitrate-U.bitrate}),this._levels=l;for(var L=0;L<l.length;L++)if(l[L].bitrate===s){this._firstLevel=L,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+s);break}var B={levels:l,audioTracks:c,subtitleTracks:t,firstLevel:this._firstLevel,stats:r.stats,audio:D,video:g,altAudio:!(D&&!g)&&c.some(function(F){return!!F.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,B),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(i,r){var l;if(e.prototype.onError.call(this,i,r),!r.fatal){var c=r.context,t=this._levels[this.currentLevelIndex];if(c&&(c.type===v.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&c.groupId===t.audioGroupIds[t.urlId]||c.type===v.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&c.groupId===t.textGroupIds[t.urlId]))return void this.redundantFailover(this.currentLevelIndex);var n,s=!1,u=!0;switch(r.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var f=r.frag.type===v.PlaylistLevelType.MAIN?r.frag.level:this.currentLevelIndex,g=this._levels[f];g?(g.fragmentError++,g.fragmentError>this.hls.config.fragLoadingMaxRetry&&(n=f)):n=f}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:c&&(c.deliveryDirectives&&(u=!1),n=c.level),s=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:n=null!=(l=r.level)?l:this.currentLevelIndex,s=!0}void 0!==n&&this.recoverLevel(r,n,s,u)}},h.recoverLevel=function(i,r,l,c){var t=i.details,s=this._levels[r];if(s.loadError++,l){if(!this.retryLoadingOrFail(i))return void(this.currentLevelIndex=-1);i.levelRetry=!0}if(c){var n=s.url.length;if(n>1&&s.loadError<n)i.levelRetry=!0,this.redundantFailover(r);else if(-1===this.manualLevelIndex){for(var f=-1,g=this._levels,D=g.length;D--;){var L=(D+this.currentLevelIndex)%g.length;if(L!==this.currentLevelIndex&&0===g[L].loadError){f=L;break}}f>-1&&this.currentLevelIndex!==f&&(this.warn(t+": switch to "+f),i.levelRetry=!0,this.hls.nextAutoLevel=f)}}},h.redundantFailover=function(i){var r=this._levels[i],l=r.url.length;if(l>1){var c=(r.urlId+1)%l;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(t){t.urlId=c}),this.level=i}},h.onFragLoaded=function(i,r){var l=r.frag;if(void 0!==l&&l.type===v.PlaylistLevelType.MAIN){var c=this._levels[l.level];void 0!==c&&(c.fragmentError=0,c.loadError=0)}},h.onLevelLoaded=function(i,r){var l,u,c=r.level,t=r.details,s=this._levels[c];if(!s)return this.warn("Invalid level index "+c),void(null!==(u=r.deliveryDirectives)&&void 0!==u&&u.skip&&(t.deltaUpdateFailed=!0));c===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(c,r,s.details)):null!==(l=r.deliveryDirectives)&&void 0!==l&&l.skip&&(t.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(i,r){var l=this.hls.levels[this.currentLevelIndex];if(l&&l.audioGroupIds){for(var c=-1,t=this.hls.audioTracks[r.id].groupId,s=0;s<l.audioGroupIds.length;s++)if(l.audioGroupIds[s]===t){c=s;break}c!==l.urlId&&(l.urlId=c,this.startLoad())}},h.loadPlaylist=function(i){var r=this.currentLevelIndex,l=this._levels[r];if(this.canLoad&&l&&l.url.length>0){var c=l.urlId,t=l.url[c];if(i)try{t=i.addDirectives(t)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+r+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+c+" "+t),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:t,level:r,id:c,deliveryDirectives:i||null})}},h.removeLevel=function(i,r){var l=function(s,u){return u!==r},c=this._levels.filter(function(t,s){return s!==i||t.url.length>1&&void 0!==r&&(t.url=t.url.filter(l),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(l)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(l)),t.urlId=0,!0)}).map(function(t,s){var u=t.details;return null!=u&&u.fragments&&u.fragments.forEach(function(n){n.level=s}),t});this._levels=c,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:c})},function x(e,a,h){return a&&o(e.prototype,a),h&&o(e,h),Object.defineProperty(e,"prototype",{writable:!1}),e}(a,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var r,l=this._levels;if(0!==l.length&&(this.currentLevelIndex!==i||null===(r=l[i])||void 0===r||!r.details)){if(i<0||i>=l.length){var c=i<0;if(this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:c,reason:"invalid level idx"}),c)return;i=Math.min(i,l.length-1)}this.clearTimer();var t=this.currentLevelIndex,s=l[t],u=l[i];this.log("switching to level "+i+" from "+t),this.currentLevelIndex=i;var n=E({},u,{level:i,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete n._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,n);var f=u.details;if(!f||f.live){var g=this.switchParams(u.uri,null==s?void 0:s.details);this.loadPlaylist(g)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,void 0===this._startLevel&&(this._startLevel=i),-1!==i&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var i=this.hls.config.startLevel;return void 0!==i?i:this._firstLevel}return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=i)}}]),a}(I.default)},"./src/controller/level-helper.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"addGroupId",function(){return R}),S.d(M,"assignTrackIdsByGroup",function(){return I}),S.d(M,"updatePTS",function(){return v}),S.d(M,"updateFragPTSDTS",function(){return o}),S.d(M,"mergeDetails",function(){return x}),S.d(M,"mapPartIntersection",function(){return T}),S.d(M,"mapFragmentIntersection",function(){return y}),S.d(M,"adjustSliding",function(){return d}),S.d(M,"addSliding",function(){return e}),S.d(M,"computeReloadInterval",function(){return a}),S.d(M,"getFragmentWithSN",function(){return h}),S.d(M,"getPartWith",function(){return m});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/logger.ts"),A=S("./src/loader/date-range.ts");function b(){return b=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(i[c]=l[c])}return i},b.apply(this,arguments)}function R(i,r,l){switch(r){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(l);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(l)}}function I(i){var r={};i.forEach(function(l){var c=l.groupId||"";l.id=r[c]=r[c]||0,r[c]++})}function v(i,r,l){E(i[r],i[l])}function E(i,r){var l=r.startPTS;if(Object(C.isFiniteNumber)(l)){var t,c=0;r.sn>i.sn?(c=l-i.start,t=i):(c=i.start-l,t=r),t.duration!==c&&(t.duration=c)}else r.start=r.sn>i.sn?i.cc===r.cc&&i.minEndPTS?i.start+(i.minEndPTS-i.start):i.start+i.duration:Math.max(i.start-r.duration,0)}function o(i,r,l,c,t,s){c-l<=0&&(O.logger.warn("Fragment should have a positive duration",r),c=l+r.duration,s=t+r.duration);var n=l,f=c,g=r.startPTS,D=r.endPTS;if(Object(C.isFiniteNumber)(g)){var L=Math.abs(g-l);r.deltaPTS=Object(C.isFiniteNumber)(r.deltaPTS)?Math.max(L,r.deltaPTS):L,n=Math.max(l,g),l=Math.min(l,g),t=Math.min(t,r.startDTS),f=Math.min(c,D),c=Math.max(c,D),s=Math.max(s,r.endDTS)}r.duration=c-l;var P=l-r.start;r.appendedPTS=c,r.start=r.startPTS=l,r.maxStartPTS=n,r.startDTS=t,r.endPTS=c,r.minEndPTS=f,r.endDTS=s;var B=r.sn;if(!i||B<i.startSN||B>i.endSN)return 0;var F,U=B-i.startSN,N=i.fragments;for(N[U]=r,F=U;F>0;F--)E(N[F],N[F-1]);for(F=U;F<N.length-1;F++)E(N[F],N[F+1]);return i.fragmentHint&&E(N[N.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,P}function x(i,r){for(var l=null,c=i.fragments,t=c.length-1;t>=0;t--){var s=c[t].initSegment;if(s){l=s;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var n,u=0;if(y(i,r,function(F,U){F.relurl&&(u=F.cc-U.cc),Object(C.isFiniteNumber)(F.startPTS)&&Object(C.isFiniteNumber)(F.endPTS)&&(U.start=U.startPTS=F.startPTS,U.startDTS=F.startDTS,U.appendedPTS=F.appendedPTS,U.maxStartPTS=F.maxStartPTS,U.endPTS=F.endPTS,U.endDTS=F.endDTS,U.minEndPTS=F.minEndPTS,U.duration=F.endPTS-F.startPTS,U.duration&&(n=U),r.PTSKnown=r.alignedSliding=!0),U.elementaryStreams=F.elementaryStreams,U.loader=F.loader,U.stats=F.stats,U.urlId=F.urlId,F.initSegment&&(U.initSegment=F.initSegment,l=F.initSegment)}),l&&(r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments).forEach(function(F){var U;(!F.initSegment||F.initSegment.relurl===(null===(U=l)||void 0===U?void 0:U.relurl))&&(F.initSegment=l)}),r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(F){return!F}),r.deltaUpdateFailed){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var g=r.skippedSegments;g--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=function p(i,r,l){var c=b({},i);return l&&l.forEach(function(t){delete c[t]}),Object.keys(r).forEach(function(t){var s=new A.DateRange(r[t].attr,c[t]);s.isValid?c[t]=s:O.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[t].attr)+'"')}),c}(i.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var D=r.fragments;if(u){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<D.length;L++)D[L].cc+=u}r.skippedSegments&&(r.startCC=r.fragments[0].cc),T(i.partList,r.partList,function(F,U){U.elementaryStreams=F.elementaryStreams,U.stats=F.stats}),n?o(r,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):d(i,r),D.length&&(r.totalduration=r.edge-D[0].start),r.driftStartTime=i.driftStartTime,r.driftStart=i.driftStart;var P=r.advancedDateTime;if(r.advanced&&P){var B=r.edge;r.driftStart||(r.driftStartTime=P,r.driftStart=B),r.driftEndTime=P,r.driftEnd=B}else r.driftEndTime=i.driftEndTime,r.driftEnd=i.driftEnd,r.advancedDateTime=i.advancedDateTime}function T(i,r,l){if(i&&r)for(var c=0,t=0,s=i.length;t<=s;t++){var u=i[t],n=r[t+c];u&&n&&u.index===n.index&&u.fragment.sn===n.fragment.sn?l(u,n):c--}}function y(i,r,l){for(var c=r.skippedSegments,t=Math.max(i.startSN,r.startSN)-r.startSN,s=(i.fragmentHint?1:0)+(c?r.endSN:Math.min(i.endSN,r.endSN))-r.startSN,u=r.startSN-i.startSN,n=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,g=t;g<=s;g++){var D=f[u+g],L=n[g];c&&!L&&g<c&&(L=r.fragments[g]=D),D&&L&&l(D,L)}}function d(i,r){var l=r.startSN+r.skippedSegments-i.startSN,c=i.fragments;l<0||l>=c.length||e(r,c[l].start)}function e(i,r){if(r){for(var l=i.fragments,c=i.skippedSegments;c<l.length;c++)l[c].start+=r;i.fragmentHint&&(i.fragmentHint.start+=r)}}function a(i,r){var n,l=1e3*i.levelTargetDuration,c=l/2,t=i.age,s=t>0&&t<3*l,u=r.loading.end-r.loading.start,f=i.availabilityDelay;if(!1===i.updated)if(s){var g=333*i.misses;n=Math.max(Math.min(c,2*u),g),i.availabilityDelay=(i.availabilityDelay||0)+n}else n=c;else s?(f=Math.min(f||l/2,t),i.availabilityDelay=f,n=f+l-t):n=l-u;return Math.round(n)}function h(i,r,l){if(!i||!i.details)return null;var c=i.details,t=c.fragments[r-c.startSN];return t||(t=c.fragmentHint)&&t.sn===r?t:r<c.startSN&&l&&l.sn===r?l:null}function m(i,r,l){if(!i||!i.details)return null;var c=i.details.partList;if(c)for(var t=c.length;t--;){var s=c[t];if(s.index===l&&s.fragment.sn===r)return s}return null}},"./src/controller/stream-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return m});var C=S("./src/polyfills/number.ts"),O=S("./src/controller/base-stream-controller.ts"),A=S("./src/is-supported.ts"),b=S("./src/events.ts"),R=S("./src/utils/buffer-helper.ts"),I=S("./src/controller/fragment-tracker.ts"),v=S("./src/types/loader.ts"),E=S("./src/loader/fragment.ts"),o=S("./src/demux/transmuxer-interface.ts"),x=S("./src/types/transmuxer.ts"),p=S("./src/controller/gap-controller.ts"),T=S("./src/errors.ts");function y(i,r){for(var l=0;l<r.length;l++){var c=r[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(i,c.key,c)}}function e(i,r){i.prototype=Object.create(r.prototype),i.prototype.constructor=i,a(i,r)}function a(i,r){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,t){return c.__proto__=t,c})(i,r)}var m=function(i){function r(c,t){var s;return(s=i.call(this,c,t,"[stream-controller]")||this).audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}e(r,i);var l=r.prototype;return l._registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(b.Events.ERROR,this.onError,this),t.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(b.Events.ERROR,this.onError,this),t.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},l.startLoad=function(t){if(this.levels){var s=this.lastCurrentTime,u=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=u.startLevel;-1===n&&(u.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=u.nextAutoLevel),this.level=u.nextLoadLevel=n,this.loadedmetadata=!1}s>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),t=s),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},l.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},l.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:var t,s=this.levels,n=null==s||null===(t=s[this.level])||void 0===t?void 0:t.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=O.State.IDLE;break}break;case O.State.FRAG_LOADING_WAITING_RETRY:var f,g=self.performance.now(),D=this.retryDate;(!D||g>=D||null!==(f=this.media)&&void 0!==f&&f.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=O.State.IDLE)}this.onTickEnd()},l.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},l.doTickIdle=function(){var t,s,u=this.hls,f=this.levels,g=this.media,L=u.nextLoadLevel;if(null!==this.levelLastLoaded&&(g||!this.startFragRequested&&u.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&f&&f[L]){var P=f[L];this.level=u.nextLoadLevel=L;var B=P.details;if(!B||this.state===O.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==L)return void(this.state=O.State.WAITING_LEVEL);var F=this.getMainFwdBufferInfo();if(null!==F&&!(F.len>=this.getMaxBufferLength(P.maxBitrate))){if(this._streamEnded(F,B)){var k={};return this.altAudio&&(k.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,k),void(this.state=O.State.ENDED)}this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var K=this.backtrackFragment?this.backtrackFragment.start:F.end,w=this.getNextFragment(K,B);if(this.couldBacktrack&&!this.fragPrevious&&w&&"initSegment"!==w.sn&&this.fragmentTracker.getState(w)!==I.FragmentState.OK){var W,j=(null!=(W=this.backtrackFragment)?W:w).sn,Y=B.fragments[j-B.startSN-1];Y&&w.cc===Y.cc&&(w=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);w&&this.fragmentTracker.getState(w)===I.FragmentState.OK&&this.nextLoadPosition>K&&(g&&this.afterBufferFlushed(g,this.audioOnly&&!this.altAudio?E.ElementaryStreamTypes.AUDIO:E.ElementaryStreamTypes.VIDEO,v.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,B)),!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),"identity"!==(null===(t=w.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(s=w.decryptdata)&&void 0!==s&&s.key?this.loadFragment(w,B,K):this.loadKey(w,B))}}},l.loadFragment=function(t,s,u){var n,f=this.fragmentTracker.getState(t);this.fragCurrent=t,f===I.FragmentState.NOT_LOADED?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,t,s,u)):f===I.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},l.getAppendedFrag=function(t){var s=this.fragmentTracker.getAppendedFrag(t,v.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},l.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,v.PlaylistLevelType.MAIN)},l.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},l.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},l.nextLevelSwitch=function(){var t=this.levels,s=this.media;if(null!=s&&s.readyState){var u,n=this.getAppendedFrag(s.currentTime);if(n&&n.start>1&&this.flushMainBuffer(0,n.start-1),!s.paused&&t){var D=this.fragLastKbps;u=D&&this.fragCurrent?this.fragCurrent.duration*t[this.hls.nextLoadLevel].maxBitrate/(1e3*D)+1:0}else u=0;var L=this.getBufferedFrag(s.currentTime+u);if(L){var P=this.followingBufferedFrag(L);if(P){this.abortCurrentFrag();var F=P.duration,U=Math.max(L.end,(P.maxStartPTS?P.maxStartPTS:P.start)+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},l.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,null!=t&&t.loader&&t.loader.abort(),this.state){case O.State.KEY_LOADING:case O.State.FRAG_LOADING:case O.State.FRAG_LOADING_WAITING_RETRY:case O.State.PARSING:case O.State.PARSED:this.state=O.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},l.flushMainBuffer=function(t,s){i.prototype.flushMainBuffer.call(this,t,s,this.altAudio?"video":null)},l.onMediaAttached=function(t,s){i.prototype.onMediaAttached.call(this,t,s);var u=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),u.addEventListener("playing",this.onvplaying),u.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,u,this.fragmentTracker,this.hls)},l.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},l.onMediaPlaying=function(){this.tick()},l.onMediaSeeked=function(){var t=this.media,s=t?t.currentTime:null;Object(C.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},l.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},l.onManifestParsed=function(t,s){var f,u=!1,n=!1;s.levels.forEach(function(g){(f=g.audioCodec)&&(-1!==f.indexOf("mp4a.40.2")&&(u=!0),-1!==f.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=u&&n&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},l.onLevelLoading=function(t,s){var u=this.levels;if(u&&this.state===O.State.IDLE){var n=u[s.level];(!n.details||n.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(n.details))&&(this.state=O.State.WAITING_LEVEL)}},l.onLevelLoaded=function(t,s){var u,n=this.levels,f=s.level,g=s.details;if(n){this.log("Level "+f+" loaded ["+g.startSN+","+g.endSN+"], cc ["+g.startCC+", "+g.endCC+"] duration:"+g.totalduration);var L=this.fragCurrent;L&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&L.level!==s.level&&L.loader&&(this.state=O.State.IDLE,this.backtrackFragment=null,L.loader.abort());var P=n[f],B=0;if(g.live||null!==(u=P.details)&&void 0!==u&&u.live){if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed)return;B=this.alignPlaylists(g,P.details)}if(P.details=g,this.levelLastLoaded=f,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:g,level:f}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(g))return;this.state=O.State.IDLE}this.startFragRequested?g.live&&this.synchronizeToLiveEdge(g):this.setStartPosition(g,B),this.tick()}else this.warn("Levels were reset while loading level "+f)},l._handleFragmentLoadProgress=function(t){var s,u=t.frag,n=t.part,f=t.payload,g=this.levels;if(g){var D=g[u.level],L=D.details;if(L){var P=D.videoCodec,B=L.PTSKnown||!L.live,F=null===(s=u.initSegment)||void 0===s?void 0:s.data,U=this._getAudioCodec(D),N=this.transmuxer=this.transmuxer||new o.default(this.hls,v.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=n?n.index:-1,w=new x.ChunkMetadata(u.level,u.sn,u.stats.chunkCount,f.byteLength,k,-1!==k);N.push(f,F,U,P,u,n,L.totalduration,B,w,this.initPTS[u.cc])}else this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered")},l.onAudioTrackSwitching=function(t,s){var u=this.altAudio,f=s.id;if(!s.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var g=this.fragCurrent;null!=g&&g.loader&&(this.log("Switching to main audio track, cancel main fragment load"),g.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;u&&D.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:f})}},l.onAudioTrackSwitched=function(t,s){var n=!!this.hls.audioTracks[s.id].url;if(n){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=n,this.tick()},l.onBufferCreated=function(t,s){var n,f,u=s.tracks,g=!1;for(var D in u){var L=u[D];if("main"===L.id){if(f=D,n=L,"video"===D){var P=u[D];P&&(this.videoBuffer=P.buffer)}}else g=!0}g&&n?(this.log("Alternate track found, use "+f+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},l.onFragBuffered=function(t,s){var u=s.frag,n=s.part;if(!u||u.type===v.PlaylistLevelType.MAIN){if(this.fragContextChanged(u))return this.warn("Fragment "+u.sn+(n?" p: "+n.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===O.State.PARSED&&(this.state=O.State.IDLE));var f=n?n.stats:u.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),"initSegment"!==u.sn&&(this.fragPrevious=u),this.fragBufferedComplete(u,n)}},l.onError=function(t,s){switch(s.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(v.PlaylistLevelType.MAIN,s);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=O.State.ERROR):!s.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if("main"===s.parent&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var u=!0,n=this.getFwdBufferInfo(this.media,v.PlaylistLevelType.MAIN);n&&n.len>.5&&(u=!this.reduceMaxBufferLength(n.len)),u&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},l.checkBuffer=function(){var t=this.media,s=this.gapController;t&&s&&t.readyState&&(!this.loadedmetadata&&R.BufferHelper.getBuffered(t).length||s.poll(this.lastCurrentTime,this.state!==O.State.IDLE?this.fragCurrent:null),this.lastCurrentTime=t.currentTime)},l.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},l.onBufferFlushed=function(t,s){var u=s.type;(u!==E.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((u===E.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,u,v.PlaylistLevelType.MAIN)},l.onLevelsUpdated=function(t,s){this.levels=s.levels},l.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},l.seekToStartPos=function(){var t=this.media;if(t){var s=t.currentTime,u=this.startPosition;if(u>=0&&s<u){if(t.seeking)return void this.log("could not seek to "+u+", already seeking at "+s);var n=R.BufferHelper.getBuffered(t),g=(n.length?n.start(0):0)-u;g>0&&(g<this.config.maxBufferHole||g<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+g+" to match buffer start"),this.startPosition=u+=g),this.log("seek to target start position "+u+" from current time "+s),t.currentTime=u}}},l._getAudioCodec=function(t){var s=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),s},l._loadBitrateTestFrag=function(t){var s=this;t.bitrateTest=!0,this._doFragLoad(t).then(function(u){var n=s.hls;if(u&&!n.nextLoadLevel&&!s.fragContextChanged(t)){s.fragLoadError=0,s.state=O.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var f=t.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),n.trigger(b.Events.FRAG_LOADED,u),t.bitrateTest=!1}})},l._handleTransmuxComplete=function(t){var s,u="main",n=this.hls,f=t.remuxResult,g=t.chunkMeta,D=this.getCurrentContext(g);if(!D)return this.warn("The loading context changed while buffering fragment "+g.sn+" of level "+g.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(g.level);var L=D.frag,P=D.part,B=D.level,F=f.video,U=f.text,N=f.id3,k=f.initSegment,K=B.details,w=this.altAudio?void 0:f.audio;if(!this.fragContextChanged(L)){if(this.state=O.State.PARSING,k){k.tracks&&(this._bufferInitSegment(B,k.tracks,L,g),n.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:u,tracks:k.tracks}));var W=k.initPTS,j=k.timescale;Object(C.isFiniteNumber)(W)&&(this.initPTS[L.cc]=W,n.trigger(b.Events.INIT_PTS_FOUND,{frag:L,id:u,initPTS:W,timescale:j}))}if(F&&!1!==f.independent){if(K){var _=F.startPTS,Y=F.endPTS,z=F.startDTS,X=F.endDTS;if(P)P.elementaryStreams[F.type]={startPTS:_,endPTS:Y,startDTS:z,endDTS:X};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var H=this.getMainFwdBufferInfo();if((H?H.end:this.getLoadPosition())+this.config.maxBufferHole<(F.firstKeyFramePTS?F.firstKeyFramePTS:_)-this.config.maxBufferHole)return void this.backtrack(L);L.setElementaryStreamInfo(F.type,L.start,Y,L.start,X,!0)}L.setElementaryStreamInfo(F.type,_,Y,z,X),this.backtrackFragment&&(this.backtrackFragment=L),this.bufferFragmentData(F,L,P,g)}}else if(!1===f.independent)return void this.backtrack(L);if(w){var V=w.startPTS,J=w.endPTS,Z=w.startDTS,q=w.endDTS;P&&(P.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:V,endPTS:J,startDTS:Z,endDTS:q}),L.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,V,J,Z,q),this.bufferFragmentData(w,L,P,g)}K&&null!=N&&null!==(s=N.samples)&&void 0!==s&&s.length&&n.trigger(b.Events.FRAG_PARSING_METADATA,{id:u,frag:L,details:K,samples:N.samples}),K&&U&&n.trigger(b.Events.FRAG_PARSING_USERDATA,{id:u,frag:L,details:K,samples:U.samples})}},l._bufferInitSegment=function(t,s,u,n){var f=this;if(this.state===O.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var g=s.audio,D=s.video,L=s.audiovideo;if(g){var P=t.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P=-1!==P.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==g.metadata.channelCount&&-1===B.indexOf("firefox")&&(P="mp4a.40.5")),-1!==B.indexOf("android")&&"audio/mpeg"!==g.container&&this.log("Android: force audio codec to "+(P="mp4a.40.2")),t.audioCodec&&t.audioCodec!==P&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+P+'"'),g.levelCodec=P,g.id="main",this.log("Init audio buffer, container:"+g.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(t.audioCodec||"")+"/"+g.codec+"]")}D&&(D.levelCodec=t.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+D.codec+"]")),L&&this.log("Init audiovideo buffer, container:"+L.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+L.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(F){var N=s[F].initSegment;null!=N&&N.byteLength&&f.hls.trigger(b.Events.BUFFER_APPENDING,{type:F,data:N,frag:u,part:null,chunkMeta:n,parent:u.type})}),this.tick()}},l.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,v.PlaylistLevelType.MAIN)},l.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=O.State.IDLE},l.checkFragmentChanged=function(){var t=this.media,s=null;if(t&&t.readyState>1&&!1===t.seeking){var u=t.currentTime;if(R.BufferHelper.isBuffered(t,u)?s=this.getAppendedFrag(u):R.BufferHelper.isBuffered(t,u+.1)&&(s=this.getAppendedFrag(u+.1)),s){this.backtrackFragment=null;var n=this.fragPlaying,f=s.level;(!n||s.sn!==n.sn||n.level!==f||s.urlId!==n.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:s}),(!n||n.level!==f)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:f}),this.fragPlaying=s)}}},function d(i,r,l){return r&&y(i.prototype,r),l&&y(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i}(r,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var s=t.currentTime,u=this.currentFrag;if(u&&Object(C.isFiniteNumber)(s)&&Object(C.isFiniteNumber)(u.programDateTime))return new Date(u.programDateTime+1e3*(s-u.start))}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"SubtitleStreamController",function(){return e});var C=S("./src/events.ts"),O=S("./src/utils/buffer-helper.ts"),A=S("./src/controller/fragment-finders.ts"),b=S("./src/utils/discontinuities.ts"),R=S("./src/controller/level-helper.ts"),I=S("./src/controller/fragment-tracker.ts"),v=S("./src/controller/base-stream-controller.ts"),E=S("./src/types/loader.ts"),o=S("./src/types/level.ts");function x(h,m){for(var i=0;i<m.length;i++){var r=m[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(h,r.key,r)}}function T(h,m){h.prototype=Object.create(m.prototype),h.prototype.constructor=h,y(h,m)}function y(h,m){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r})(h,m)}var e=function(h){function m(r,l){var c;return(c=h.call(this,r,l,"[subtitle-stream-controller]")||this).levels=[],c.currentTrackId=-1,c.tracksBuffered=[],c.mainDetails=null,c._registerListeners(),c}T(m,h);var i=m.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var l=this.hls;l.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(C.Events.ERROR,this.onError,this),l.on(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.on(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.on(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var l=this.hls;l.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(C.Events.ERROR,this.onError,this),l.off(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.off(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.off(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.startLoad=function(){this.stopLoad(),this.state=v.State.IDLE,this.setInterval(500),this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(l,c){this.mainDetails=c.details},i.onSubtitleFragProcessed=function(l,c){var t=c.frag,s=c.success;if(this.fragPrevious=t,this.state=v.State.IDLE,s){var u=this.tracksBuffered[this.currentTrackId];if(u){for(var n,f=t.start,g=0;g<u.length;g++)if(f>=u[g].start&&f<=u[g].end){n=u[g];break}var D=t.start+t.duration;n?n.end=D:u.push(n={start:f,end:D}),this.fragmentTracker.fragBuffered(t)}}},i.onBufferFlushing=function(l,c){var t=c.startOffset,s=c.endOffset;if(0===t&&s!==Number.POSITIVE_INFINITY){var u=this.currentTrackId,n=this.levels;if(!n.length||!n[u]||!n[u].details)return;var D=s-n[u].details.targetduration;if(D<=0)return;c.endOffsetSubtitles=Math.max(0,D),this.tracksBuffered.forEach(function(L){for(var P=0;P<L.length;)if(L[P].end<=D)L.shift();else{if(!(L[P].start<D))break;L[P].start=D,P++}}),this.fragmentTracker.removeFragmentsInRange(t,D,E.PlaylistLevelType.SUBTITLE)}},i.onError=function(l,c){var t,s=c.frag;!s||s.type!==E.PlaylistLevelType.SUBTITLE||(null!==(t=this.fragCurrent)&&void 0!==t&&t.loader&&this.fragCurrent.loader.abort(),this.state=v.State.IDLE)},i.onSubtitleTracksUpdated=function(l,c){var t=this,s=c.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(u){return new o.Level(u)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(u){t.tracksBuffered[u.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(l,c){if(this.currentTrackId=c.id,this.levels.length&&-1!==this.currentTrackId){var t=this.levels[this.currentTrackId];this.mediaBuffer=null!=t&&t.details?this.mediaBufferTimeRanges:null,t&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(l,c){var t,s=c.details,u=c.id,n=this.currentTrackId,f=this.levels;if(f.length){var g=f[n];if(!(u>=f.length||u!==n)&&g){if(this.mediaBuffer=this.mediaBufferTimeRanges,s.live||null!==(t=g.details)&&void 0!==t&&t.live){var D=this.mainDetails;if(s.deltaUpdateFailed||!D)return;var L=D.fragments[0];g.details?0===this.alignPlaylists(s,g.details)&&L&&Object(R.addSliding)(s,L.start):s.hasProgramDateTime&&D.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(s,D):L&&Object(R.addSliding)(s,L.start)}g.details=s,this.levelLastLoaded=u,this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===v.State.IDLE&&(Object(A.findFragmentByPTS)(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),g.details=void 0))}}},i._handleFragmentLoadComplete=function(l){var c=l.frag,t=l.payload,s=c.decryptdata,u=this.hls;if(!this.fragContextChanged(c)&&t&&t.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var n=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(t),s.key.buffer,s.iv.buffer).then(function(f){var g=performance.now();u.trigger(C.Events.FRAG_DECRYPTED,{frag:c,payload:f,stats:{tstart:n,tdecrypt:g}})})}},i.doTick=function(){if(this.media){if(this.state===v.State.IDLE){var l=this.currentTrackId,c=this.levels;if(!c.length||!c[l]||!c[l].details)return;var t=c[l].details,s=t.targetduration,u=this.config,f=O.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],this.media.currentTime-s,u.maxBufferHole),g=f.end;if(f.len>this.getMaxBufferLength()+s)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var U,P=t.fragments,B=P.length,N=this.fragPrevious;if(g<t.edge){var k=u.maxFragLookUpTolerance;!(U=Object(A.findFragmentByPTS)(N,P,Math.max(P[0].start,g),k))&&N&&N.start<P[0].start&&(U=P[0])}else U=P[B-1];if(!(U=this.mapToInitFragWhenRequired(U))||this.fragmentTracker.getState(U)!==I.FragmentState.NOT_LOADED)return;U.encrypted?this.loadKey(U,t):this.loadFragment(U,t,g)}}else this.state=v.State.IDLE},i.loadFragment=function(l,c,t){this.fragCurrent=l,"initSegment"===l.sn?this._loadInitSegment(l):h.prototype.loadFragment.call(this,l,c,t)},function p(h,m,i){return m&&x(h.prototype,m),i&&x(h,i),Object.defineProperty(h,"prototype",{writable:!1}),h}(m,[{key:"mediaBufferTimeRanges",get:function(){return new a(this.tracksBuffered[this.currentTrackId]||[])}}]),m}(v.default),a=function(m){this.buffered=void 0;var i=function(l,c,t){if((c>>>=0)>t-1)throw new DOMException("Failed to execute '"+l+"' on 'TimeRanges': The index provided ("+c+") is greater than the maximum bound ("+t+")");return m[c][l]};this.buffered={get length(){return m.length},end:function(l){return i("end",l,m.length)},start:function(l){return i("start",l,m.length)}}}},"./src/controller/subtitle-track-controller.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/events.ts"),O=S("./src/utils/texttrack-utils.ts"),A=S("./src/controller/base-playlist-controller.ts"),b=S("./src/types/loader.ts");function R(p,T){for(var y=0;y<T.length;y++){var d=T[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(p,d.key,d)}}function v(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,E(p,T)}function E(p,T){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,e){return d.__proto__=e,d})(p,T)}function x(p){for(var T=[],y=0;y<p.length;y++){var d=p[y];"subtitles"===d.kind&&d.label&&T.push(p[y])}return T}M.default=function(p){function T(d){var e;return(e=p.call(this,d,"[subtitle-track-controller]")||this).media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}v(T,p);var y=T.prototype;return y.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,p.prototype.destroy.call(this)},y.registerListeners=function(){var e=this.hls;e.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var e=this.hls;e.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.Events.ERROR,this.onError,this)},y.onMediaAttached=function(e,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},y.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},y.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),x(this.media.textTracks).forEach(function(a){Object(O.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null)},y.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},y.onManifestParsed=function(e,a){this.tracks=a.subtitleTracks},y.onSubtitleTrackLoaded=function(e,a){var h=a.id,m=a.details,r=this.tracksInGroup[this.trackId];if(r){var l=r.details;r.details=a.details,this.log("subtitle track "+h+" loaded ["+m.startSN+"-"+m.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,a,l))}else this.warn("Invalid subtitle track id "+h)},y.onLevelLoading=function(e,a){this.switchLevel(a.level)},y.onLevelSwitching=function(e,a){this.switchLevel(a.level)},y.switchLevel=function(e){var a=this.hls.levels[e];if(null!=a&&a.textGroupIds){var h=a.textGroupIds[a.urlId];if(this.groupId!==h){var m=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(c){return!h||c.groupId===h});this.tracksInGroup=i;var r=this.findTrackId(null==m?void 0:m.name)||this.findTrackId();this.groupId=h;var l={subtitleTracks:i};this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(C.Events.SUBTITLE_TRACKS_UPDATED,l),-1!==r&&this.setSubtitleTrack(r,m)}}},y.findTrackId=function(e){for(var a=this.tracksInGroup,h=0;h<a.length;h++){var m=a[h];if((!this.selectDefaultTrack||m.default)&&(!e||e===m.name))return m.id}return-1},y.onError=function(e,a){p.prototype.onError.call(this,e,a),!a.fatal&&a.context&&a.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},y.loadPlaylist=function(e){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var h=a.id,m=a.groupId,i=a.url;if(e)try{i=e.addDirectives(i)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+h),this.hls.trigger(C.Events.SUBTITLE_TRACK_LOADING,{url:i,id:h,groupId:m,deliveryDirectives:e||null})}},y.toggleTrackModes=function(e){var a=this,h=this.media,m=this.trackId;if(h){var i=x(h.textTracks),r=i.filter(function(t){return t.groupId===a.groupId});if(-1===e)[].slice.call(i).forEach(function(t){t.mode="disabled"});else{var l=r[m];l&&(l.mode="disabled")}var c=r[e];c&&(c.mode=this.subtitleDisplay?"showing":"hidden")}},y.setSubtitleTrack=function(e,a){var h,m=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(h=m[e])&&void 0!==h&&h.details)||e<-1||e>=m.length)){this.clearTimer();var i=m[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,i){var l=i.groupId;this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:i.id,groupId:void 0===l?"":l,name:i.name,type:i.type,url:i.url});var n=this.switchParams(i.url,null==a?void 0:a.details);this.loadPlaylist(n)}else this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},y.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,a=x(this.media.textTracks),h=0;h<a.length;h++)if("hidden"===a[h].mode)e=h;else if("showing"===a[h].mode){e=h;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},function I(p,T,y){return T&&R(p.prototype,T),y&&R(p,y),Object.defineProperty(p,"prototype",{writable:!1}),p}(T,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}]),T}(A.default)},"./src/controller/timeline-controller.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"TimelineController",function(){return p});var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/cea-608-parser.ts"),b=S("./src/utils/output-filter.ts"),R=S("./src/utils/webvtt-parser.ts"),I=S("./src/utils/texttrack-utils.ts"),v=S("./src/utils/imsc1-ttml-parser.ts"),E=S("./src/utils/mp4-tools.ts"),o=S("./src/types/loader.ts"),x=S("./src/utils/logger.ts"),p=function(){function e(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var m=new b.default(this,"textTrack1"),i=new b.default(this,"textTrack2"),r=new b.default(this,"textTrack3"),l=new b.default(this,"textTrack4");this.cea608Parser1=new A.default(1,m,i),this.cea608Parser2=new A.default(3,r,l)}h.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(O.Events.FRAG_LOADING,this.onFragLoading,this),h.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=e.prototype;return a.destroy=function(){var m=this.hls;m.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.off(O.Events.FRAG_LOADING,this.onFragLoading,this),m.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),m.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),m.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),m.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),m.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),m.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(m,i,r,l,c){for(var t=!1,s=c.length;s--;){var u=c[s],n=y(u[0],u[1],i,r);if(n>=0&&(u[0]=Math.min(u[0],i),u[1]=Math.max(u[1],r),t=!0,n/(r-i)>.5))return}if(t||c.push([i,r]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[m],i,r,l);else{var g=this.Cues.newCue(null,i,r,l);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:g,track:m})}},a.onInitPtsFound=function(m,i){var r=this,l=i.frag,s=i.timescale,u=this.unparsedVttFrags;"main"===i.id&&(this.initPTS[l.cc]=i.initPTS,this.timescale[l.cc]=s),u.length&&(this.unparsedVttFrags=[],u.forEach(function(n){r.onFragLoaded(O.Events.FRAG_LOADED,n)}))},a.getExistingTrack=function(m){var i=this.media;if(i)for(var r=0;r<i.textTracks.length;r++){var l=i.textTracks[r];if(l[m])return l}return null},a.createCaptionsTrack=function(m){this.config.renderTextTracksNatively?this.createNativeTrack(m):this.createNonNativeTrack(m)},a.createNativeTrack=function(m){if(!this.captionsTracks[m]){var r=this.captionsTracks,l=this.media,c=this.captionsProperties[m],t=c.label,s=c.languageCode,u=this.getExistingTrack(m);if(u)r[m]=u,Object(I.clearCurrentCues)(r[m]),Object(I.sendAddTrackEvent)(r[m],l);else{var n=this.createTextTrack("captions",t,s);n&&(n[m]=!0,r[m]=n)}}},a.createNonNativeTrack=function(m){if(!this.nonNativeCaptionsTracks[m]){var i=this.captionsProperties[m];if(i){var l={_id:m,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[m]=l,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[l]})}}},a.createTextTrack=function(m,i,r){var l=this.media;if(l)return l.addTextTrack(m,i,r)},a.onMediaAttaching=function(m,i){this.media=i.media,this._cleanTracks()},a.onMediaDetaching=function(){var m=this.captionsTracks;Object.keys(m).forEach(function(i){Object(I.clearCurrentCues)(m[i]),delete m[i]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var m=this.media;if(m){var i=m.textTracks;if(i)for(var r=0;r<i.length;r++)Object(I.clearCurrentCues)(i[r])}},a.onSubtitleTracksUpdated=function(m,i){var r=this;this.textTracks=[];var l=i.subtitleTracks||[],c=l.some(function(n){return n.textCodec===v.IMSC1_CODEC});if(this.config.enableWebVTT||c&&this.config.enableIMSC1){var t=this.tracks&&l&&this.tracks.length===l.length;if(this.tracks=l||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(n,f){var g;if(f<s.length){for(var D=null,L=0;L<s.length;L++)if(T(s[L],n)){D=s[L];break}D&&(g=D)}if(g)Object(I.clearCurrentCues)(g);else{var P=r._captionsOrSubtitlesFromCharacteristics(n);(g=r.createTextTrack(P,n.name,n.lang))&&(g.mode="disabled")}g&&(g.groupId=n.groupId,r.textTracks.push(g))})}else if(!t&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(n){return{label:n.name,kind:n.type.toLowerCase(),default:n.default,subtitleTrack:n}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},a._captionsOrSubtitlesFromCharacteristics=function(m){var i;if(null!==(i=m.attrs)&&void 0!==i&&i.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(m.attrs.CHARACTERISTICS),l=/describes-music-and-sound/gi.test(m.attrs.CHARACTERISTICS);if(r&&l)return"captions"}return"subtitles"},a.onManifestLoaded=function(m,i){var r=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(l){var c=/(?:CC|SERVICE)([1-4])/.exec(l.instreamId);if(c){var s=r.captionsProperties["textTrack"+c[1]];!s||(s.label=l.name,l.lang&&(s.languageCode=l.lang),s.media=l)}})},a.closedCaptionsForLevel=function(m){var i=this.hls.levels[m.level];return null==i?void 0:i.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(m,i){var r=this.cea608Parser1,l=this.cea608Parser2,c=this.lastSn;if(this.enabled&&r&&l&&i.frag.type===o.PlaylistLevelType.MAIN){var s,u,n=i.frag.sn,f=null!=(s=null==i||null===(u=i.part)||void 0===u?void 0:u.index)?s:-1;n===c+1||n===c&&f===this.lastPartIndex+1||(r.reset(),l.reset()),this.lastSn=n,this.lastPartIndex=f}},a.onFragLoaded=function(m,i){var r=i.frag,l=i.payload,c=this.initPTS,t=this.unparsedVttFrags;if(r.type===o.PlaylistLevelType.SUBTITLE)if(l.byteLength){if(!Object(C.isFiniteNumber)(c[r.cc]))return t.push(i),void(c.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var s=r.decryptdata;if(null==s||null==s.key||"AES-128"!==s.method||"stats"in i){var n=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),n&&n.textCodec===v.IMSC1_CODEC?this._parseIMSC1(r,l):this._parseVTTs(r,l,f)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(m,i){var r=this,l=this.hls;Object(v.parseIMSC1)(i,this.initPTS[m.cc],this.timescale[m.cc],function(c){r._appendCues(c,m.level),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(c){x.logger.log("Failed to parse IMSC1: "+c),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:c})})},a._parseVTTs=function(m,i,r){var l,c=this,t=this.hls,s=null!==(l=m.initSegment)&&void 0!==l&&l.data?Object(E.appendUint8Array)(m.initSegment.data,new Uint8Array(i)):i;Object(R.parseWebVTT)(s,this.initPTS[m.cc],this.timescale[m.cc],r,m.cc,m.start,function(u){c._appendCues(u,m.level),t.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(u){c._fallbackToIMSC1(m,i),x.logger.log("Failed to parse VTT cue: "+u),t.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:u})})},a._fallbackToIMSC1=function(m,i){var r=this,l=this.tracks[m.level];l.textCodec||Object(v.parseIMSC1)(i,this.initPTS[m.cc],this.timescale[m.cc],function(){l.textCodec=v.IMSC1_CODEC,r._parseIMSC1(m,i)},function(){l.textCodec="wvtt"})},a._appendCues=function(m,i){var r=this.hls;if(this.config.renderTextTracksNatively){var l=this.textTracks[i];if(!l||"disabled"===l.mode)return;m.forEach(function(s){return Object(I.addCueToTrack)(l,s)})}else{var c=this.tracks[i];if(!c)return;r.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:m,track:c.default?"default":"subtitles"+i})}},a.onFragDecrypted=function(m,i){var r=i.frag;if(r.type===o.PlaylistLevelType.SUBTITLE){if(!Object(C.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(O.Events.FRAG_LOADED,i)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(m,i){var r=this.cea608Parser1,l=this.cea608Parser2;if(this.enabled&&r&&l){var c=i.frag,t=i.samples;if(c.type!==o.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(c))for(var s=0;s<t.length;s++){var u=t[s].bytes;if(u){var n=this.extractCea608Data(u);r.addData(t[s].pts,n[0]),l.addData(t[s].pts,n[1])}}}},a.onBufferFlushing=function(m,i){var r=i.startOffset,l=i.endOffset,c=i.endOffsetSubtitles,t=i.type,s=this.media;if(s&&!(s.currentTime<l)){if(!t||"video"===t){var u=this.captionsTracks;Object.keys(u).forEach(function(f){return Object(I.removeCuesInRange)(u[f],r,l)})}if(this.config.renderTextTracksNatively&&0===r&&void 0!==c){var n=this.textTracks;Object.keys(n).forEach(function(f){return Object(I.removeCuesInRange)(n[f],r,c)})}}},a.extractCea608Data=function(m){for(var i=[[],[]],r=31&m[0],l=2,c=0;c<r;c++){var t=m[l++],s=127&m[l++],u=127&m[l++];if((0!==s||0!==u)&&0!=(4&t)){var f=3&t;(0===f||1===f)&&(i[f].push(s),i[f].push(u))}}return i},e}();function T(e,a){return e&&e.label===a.name&&!(e.textTrack1||e.textTrack2)}function y(e,a,h,m){return Math.min(a,m)-Math.max(e,h)}},"./src/crypt/aes-crypto.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=R}return O.prototype.decrypt=function(R,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,R)},O}()},"./src/crypt/aes-decryptor.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"removePadding",function(){return O}),S.d(M,"default",function(){return A});var C=S("./src/utils/typed-array.ts");function O(b){var R=b.byteLength,I=R&&new DataView(b.buffer).getUint8(R-1);return I?Object(C.sliceUint8)(b,0,R-I):b}var A=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=b.prototype;return R.uint8ArrayToUint32Array_=function(v){for(var E=new DataView(v),o=new Uint32Array(4),x=0;x<4;x++)o[x]=E.getUint32(4*x);return o},R.initTable=function(){var v=this.sBox,E=this.invSBox,o=this.subMix,x=o[0],p=o[1],T=o[2],y=o[3],d=this.invSubMix,e=d[0],a=d[1],h=d[2],m=d[3],i=new Uint32Array(256),r=0,l=0,c=0;for(c=0;c<256;c++)i[c]=c<128?c<<1:c<<1^283;for(c=0;c<256;c++){var t=l^l<<1^l<<2^l<<3^l<<4;v[r]=t=t>>>8^255&t^99,E[t]=r;var s=i[r],u=i[s],n=i[u],f=257*i[t]^16843008*t;x[r]=f<<24|f>>>8,p[r]=f<<16|f>>>16,T[r]=f<<8|f>>>24,y[r]=f,e[t]=(f=16843009*n^65537*u^257*s^16843008*r)<<24|f>>>8,a[t]=f<<16|f>>>16,h[t]=f<<8|f>>>24,m[t]=f,r?(r=s^i[i[i[n^s]]],l^=i[i[l]]):r=l=1}},R.expandKey=function(v){for(var E=this.uint8ArrayToUint32Array_(v),o=!0,x=0;x<E.length&&o;)o=E[x]===this.key[x],x++;if(!o){this.key=E;var p=this.keySize=E.length;if(4!==p&&6!==p&&8!==p)throw new Error("Invalid aes key size="+p);var y,d,s,u,T=this.ksRows=4*(p+6+1),e=this.keySchedule=new Uint32Array(T),a=this.invKeySchedule=new Uint32Array(T),h=this.sBox,m=this.rcon,i=this.invSubMix,r=i[0],l=i[1],c=i[2],t=i[3];for(y=0;y<T;y++)y<p?s=e[y]=E[y]:(u=s,y%p==0?(u=h[(u=u<<8|u>>>24)>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=m[y/p|0]<<24):p>6&&y%p==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),e[y]=s=(e[y-p]^u)>>>0);for(d=0;d<T;d++)y=T-d,u=3&d?e[y]:e[y-4],a[d]=d<4||y<=4?u:r[h[u>>>24]]^l[h[u>>>16&255]]^c[h[u>>>8&255]]^t[h[255&u]],a[d]=a[d]>>>0}},R.networkToHostOrderSwap=function(v){return v<<24|(65280&v)<<8|(16711680&v)>>8|v>>>24},R.decrypt=function(v,E,o){for(var n,f,g,D,L,P,B,F,U,N,k,K,w,x=this.keySize+6,p=this.invKeySchedule,T=this.invSBox,y=this.invSubMix,d=y[0],e=y[1],a=y[2],h=y[3],m=this.uint8ArrayToUint32Array_(o),i=m[0],r=m[1],l=m[2],c=m[3],t=new Int32Array(v),s=new Int32Array(t.length),W=this.networkToHostOrderSwap;E<t.length;){for(F=W(t[E]),U=W(t[E+1]),N=W(t[E+2]),k=W(t[E+3]),D=F^p[0],L=k^p[1],P=N^p[2],B=U^p[3],K=4,w=1;w<x;w++)n=d[L>>>24]^e[P>>16&255]^a[B>>8&255]^h[255&D]^p[K+1],f=d[P>>>24]^e[B>>16&255]^a[D>>8&255]^h[255&L]^p[K+2],g=d[B>>>24]^e[D>>16&255]^a[L>>8&255]^h[255&P]^p[K+3],D=d[D>>>24]^e[L>>16&255]^a[P>>8&255]^h[255&B]^p[K],L=n,P=f,B=g,K+=4;n=T[L>>>24]<<24^T[P>>16&255]<<16^T[B>>8&255]<<8^T[255&D]^p[K+1],f=T[P>>>24]<<24^T[B>>16&255]<<16^T[D>>8&255]<<8^T[255&L]^p[K+2],g=T[B>>>24]<<24^T[D>>16&255]<<16^T[L>>8&255]<<8^T[255&P]^p[K+3],s[E]=W(T[D>>>24]<<24^T[L>>16&255]<<16^T[P>>8&255]<<8^T[255&B]^p[K]^i),s[E+1]=W(g^r),s[E+2]=W(f^l),s[E+3]=W(n^c),i=F,r=U,l=N,c=k,E+=4}return s.buffer},b}()},"./src/crypt/decrypter.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return E});var C=S("./src/crypt/aes-crypto.ts"),O=S("./src/crypt/fast-aes-key.ts"),A=S("./src/crypt/aes-decryptor.ts"),b=S("./src/utils/logger.ts"),R=S("./src/utils/mp4-tools.ts"),I=S("./src/utils/typed-array.ts"),E=function(){function o(p,T,y){var e=(void 0===y?{}:y).removePKCS7Padding,a=void 0===e||e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=p,this.config=T,this.removePKCS7Padding=a,a)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch(m){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var x=o.prototype;return x.destroy=function(){this.observer=null},x.isSync=function(){return this.config.enableSoftwareAES},x.flush=function(){var T=this.currentResult;if(T){var y=new Uint8Array(T);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(y):y}this.reset()},x.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},x.decrypt=function(T,y,d,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(T),y,d);var a=this.flush();a&&e(a.buffer)}else this.webCryptoDecrypt(new Uint8Array(T),y,d).then(e)},x.softwareDecrypt=function(T,y,d){var e=this.currentIV,a=this.currentResult,h=this.remainderData;this.logOnce("JS AES decrypt"),h&&(T=Object(R.appendUint8Array)(h,T),this.remainderData=null);var m=this.getValidChunk(T);if(!m.length)return null;e&&(d=e);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new A.default),i.expandKey(y);var r=a;return this.currentResult=i.decrypt(m.buffer,0,d),this.currentIV=Object(I.sliceUint8)(m,-16).buffer,r||null},x.webCryptoDecrypt=function(T,y,d){var e=this,a=this.subtle;return(this.key!==y||!this.fastAesKey)&&(this.key=y,this.fastAesKey=new O.default(a,y)),this.fastAesKey.expandKey().then(function(h){return a?new C.default(a,d).decrypt(T.buffer,h):Promise.reject(new Error("web crypto not initialized"))}).catch(function(h){return e.onWebCryptoError(h,T,y,d)})},x.onWebCryptoError=function(T,y,d,e){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",T),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(y,d,e)},x.getValidChunk=function(T){var y=T,d=T.length-T.length%16;return d!==T.length&&(y=Object(I.sliceUint8)(T,0,d),this.remainderData=Object(I.sliceUint8)(T,d)),y},x.logOnce=function(T){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+T),this.logEnabled=!1)},o}()},"./src/crypt/fast-aes-key.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,R){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=R}return O.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/demux/base-audio-demuxer.ts"),O=S("./src/demux/adts.ts"),A=S("./src/utils/logger.ts"),b=S("./src/demux/id3.ts");function R(E,o){E.prototype=Object.create(o.prototype),E.prototype.constructor=E,I(E,o)}function I(E,o){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,T){return p.__proto__=T,p})(E,o)}M.default=function(E){function o(p,T){var y;return(y=E.call(this)||this).observer=void 0,y.config=void 0,y.observer=p,y.config=T,y}R(o,E);var x=o.prototype;return x.resetInitSegment=function(T,y,d,e){E.prototype.resetInitSegment.call(this,T,y,d,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},o.probe=function(T){if(!T)return!1;for(var d=(b.getID3Data(T,0)||[]).length,e=T.length;d<e;d++)if(O.probe(T,d))return A.logger.log("ADTS sync word found !"),!0;return!1},x.canParse=function(T,y){return O.canParse(T,y)},x.appendFrame=function(T,y,d){O.initTrackConfig(T,this.observer,y,d,T.manifestCodec);var e=O.appendFrame(T,y,d,this.basePTS,this.frameIndex);if(e&&0===e.missing)return e},o}(C.default)},"./src/demux/adts.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"getAudioConfig",function(){return b}),S.d(M,"isHeaderPattern",function(){return R}),S.d(M,"getHeaderLength",function(){return I}),S.d(M,"getFullFrameLength",function(){return v}),S.d(M,"canGetFrameLength",function(){return E}),S.d(M,"isHeader",function(){return o}),S.d(M,"canParse",function(){return x}),S.d(M,"probe",function(){return p}),S.d(M,"initTrackConfig",function(){return T}),S.d(M,"getFrameDuration",function(){return y}),S.d(M,"parseFrameHeader",function(){return d}),S.d(M,"appendFrame",function(){return e});var C=S("./src/utils/logger.ts"),O=S("./src/errors.ts"),A=S("./src/events.ts");function b(a,h,m,i){var r,l,c,t,s=navigator.userAgent.toLowerCase(),u=i,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&h[m+2])>>>6);var f=(60&h[m+2])>>>2;if(!(f>n.length-1))return c=(1&h[m+2])<<2,c|=(192&h[m+3])>>>6,C.logger.log("manifest codec:"+i+", ADTS type:"+r+", samplingIndex:"+f),/firefox/i.test(s)?f>=6?(r=5,t=new Array(4),l=f-3):(r=2,t=new Array(2),l=f):-1!==s.indexOf("android")?(r=2,t=new Array(2),l=f):(r=5,t=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&f>=6?l=f-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(f>=6&&1===c||/vivaldi/i.test(s))||!i&&1===c)&&(r=2,t=new Array(2)),l=f)),t[0]=r<<3,t[0]|=(14&f)>>1,t[1]|=(1&f)<<7,t[1]|=c<<3,5===r&&(t[1]|=(14&l)>>1,t[2]=(1&l)<<7,t[2]|=8,t[3]=0),{config:t,samplerate:n[f],channelCount:c,codec:"mp4a.40."+r,manifestCodec:u};a.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f})}function R(a,h){return 255===a[h]&&240==(246&a[h+1])}function I(a,h){return 1&a[h+1]?7:9}function v(a,h){return(3&a[h+3])<<11|a[h+4]<<3|(224&a[h+5])>>>5}function E(a,h){return h+5<a.length}function o(a,h){return h+1<a.length&&R(a,h)}function x(a,h){return E(a,h)&&R(a,h)&&v(a,h)<=a.length-h}function p(a,h){if(o(a,h)){var m=I(a,h);if(h+m>=a.length)return!1;var i=v(a,h);if(i<=m)return!1;var r=h+i;return r===a.length||o(a,r)}return!1}function T(a,h,m,i,r){if(!a.samplerate){var l=b(h,m,i,r);if(!l)return;a.config=l.config,a.samplerate=l.samplerate,a.channelCount=l.channelCount,a.codec=l.codec,a.manifestCodec=l.manifestCodec,C.logger.log("parsed codec:"+a.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function y(a){return 9216e4/a}function d(a,h){var m=I(a,h);if(h+m<=a.length){var i=v(a,h)-m;if(i>0)return{headerLength:m,frameLength:i}}}function e(a,h,m,i,r){var s,c=i+r*y(a.samplerate),t=d(h,m);if(t){var n=t.headerLength,f=n+t.frameLength,g=Math.max(0,m+f-h.length);g?(s=new Uint8Array(f-n)).set(h.subarray(m+n,h.length),0):s=h.subarray(m+n,m+f);var D={unit:s,pts:c};return g||a.samples.push(D),{sample:D,length:f,missing:g}}var L=h.length-m;return(s=new Uint8Array(L)).set(h.subarray(m,h.length),0),{sample:{unit:s,pts:c},length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"initPTSFn",function(){return E});var C=S("./src/polyfills/number.ts"),O=S("./src/demux/id3.ts"),A=S("./src/types/demuxer.ts"),b=S("./src/demux/dummy-demuxed-track.ts"),R=S("./src/utils/mp4-tools.ts"),I=S("./src/utils/typed-array.ts"),v=function(){function o(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var x=o.prototype;return x.resetInitSegment=function(T,y,d,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},x.resetTimeStamp=function(T){this.initPTS=T,this.resetContiguity()},x.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},x.canParse=function(T,y){return!1},x.appendFrame=function(T,y,d){},x.demux=function(T,y){this.cachedData&&(T=Object(R.appendUint8Array)(this.cachedData,T),this.cachedData=null);var a,h,d=O.getID3Data(T,0),e=d?d.length:0,m=this._audioTrack,i=this._id3Track,r=d?O.getTimeStamp(d):void 0,l=T.length;for((null===this.basePTS||0===this.frameIndex&&Object(C.isFiniteNumber)(r))&&(this.basePTS=E(r,y,this.initPTS)),d&&d.length>0&&i.samples.push({pts:this.basePTS,dts:this.basePTS,data:d,type:A.MetadataSchema.audioId3}),h=this.basePTS;e<l;){if(this.canParse(T,e)){var c=this.appendFrame(m,T,e);c?(this.frameIndex++,h=c.sample.pts,a=e+=c.length):e=l}else O.canParse(T,e)?(d=O.getID3Data(T,e),i.samples.push({pts:h,dts:h,data:d,type:A.MetadataSchema.audioId3}),a=e+=d.length):e++;if(e===l&&a!==l){var t=Object(I.sliceUint8)(T,a);this.cachedData=this.cachedData?Object(R.appendUint8Array)(this.cachedData,t):t}}return{audioTrack:m,videoTrack:Object(b.dummyTrack)(),id3Track:i,textTrack:Object(b.dummyTrack)()}},x.demuxSampleAes=function(T,y,d){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},x.flush=function(T){var y=this.cachedData;return y&&(this.cachedData=null,this.demux(y,0)),{audioTrack:this._audioTrack,videoTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},x.destroy=function(){},o}(),E=function(x,p,T){return Object(C.isFiniteNumber)(x)?90*x:9e4*p+(T||0)};M.default=v},"./src/demux/chunk-cache.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return C});var C=function(){function A(){this.chunks=[],this.dataLength=0}var b=A.prototype;return b.push=function(I){this.chunks.push(I),this.dataLength+=I.length},b.flush=function(){var E,I=this.chunks;return I.length?(E=1===I.length?I[0]:function O(A,b){for(var R=new Uint8Array(b),I=0,v=0;v<A.length;v++){var E=A[v];R.set(E,I),I+=E.length}return R}(I,this.dataLength),this.reset(),E):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},A}()},"./src/demux/dummy-demuxed-track.ts":function(G,M,S){"use strict";function C(O,A){return void 0===O&&(O=""),void 0===A&&(A=9e4),{type:O,id:-1,pid:-1,inputTimeScale:A,sequenceNumber:-1,samples:[],dropped:0}}S.r(M),S.d(M,"dummyTrack",function(){return C})},"./src/demux/exp-golomb.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/utils/logger.ts");M.default=function(){function A(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var b=A.prototype;return b.loadWord=function(){var I=this.data,v=this.bytesAvailable,E=I.byteLength-v,o=new Uint8Array(4),x=Math.min(4,v);if(0===x)throw new Error("no bytes available");o.set(I.subarray(E,E+x)),this.word=new DataView(o.buffer).getUint32(0),this.bitsAvailable=8*x,this.bytesAvailable-=x},b.skipBits=function(I){var v;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,I-=(v=I>>3)>>3,this.bytesAvailable-=v,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},b.readBits=function(I){var v=Math.min(this.bitsAvailable,I),E=this.word>>>32-v;return I>32&&C.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=v,this.bitsAvailable>0?this.word<<=v:this.bytesAvailable>0&&this.loadWord(),(v=I-v)>0&&this.bitsAvailable?E<<v|this.readBits(v):E},b.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if(0!=(this.word&2147483648>>>I))return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},b.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},b.readBoolean=function(){return 1===this.readBits(1)},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(I){for(var v=8,E=8,x=0;x<I;x++)0!==E&&(E=(v+this.readEG()+256)%256),v=0===E?v:E},b.readSPS=function(){var x,p,T,I=0,v=0,E=0,o=0,y=this.readUByte.bind(this),d=this.readBits.bind(this),e=this.readUEG.bind(this),a=this.readBoolean.bind(this),h=this.skipBits.bind(this),m=this.skipEG.bind(this),i=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);y();var l=y();if(d(5),h(3),y(),i(),100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l){var c=e();if(3===c&&h(1),i(),i(),h(1),a())for(p=3!==c?8:12,T=0;T<p;T++)a()&&r(T<6?16:64)}i();var t=e();if(0===t)e();else if(1===t)for(h(1),m(),m(),x=e(),T=0;T<x;T++)m();i(),h(1);var s=e(),u=e(),n=d(1);0===n&&h(1),h(1),a()&&(I=e(),v=e(),E=e(),o=e());var f=[1,1];if(a()&&a())switch(y()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[y()<<8|y(),y()<<8|y()]}return{width:Math.ceil(16*(s+1)-2*I-2*v),height:(2-n)*(u+1)*16-(n?2:4)*(E+o),pixelRatio:f}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}()},"./src/demux/id3.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"isHeader",function(){return C}),S.d(M,"isFooter",function(){return O}),S.d(M,"getID3Data",function(){return A}),S.d(M,"canParse",function(){return R}),S.d(M,"getTimeStamp",function(){return I}),S.d(M,"isTimeStampFrame",function(){return v}),S.d(M,"getID3Frames",function(){return o}),S.d(M,"decodeFrame",function(){return x}),S.d(M,"utf8ArrayToStr",function(){return e}),S.d(M,"testables",function(){return a});var h,C=function(r,l){return l+10<=r.length&&73===r[l]&&68===r[l+1]&&51===r[l+2]&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},O=function(r,l){return l+10<=r.length&&51===r[l]&&68===r[l+1]&&73===r[l+2]&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},A=function(r,l){for(var c=l,t=0;C(r,l);)t+=10,t+=b(r,l+6),O(r,l+10)&&(t+=10),l+=t;if(t>0)return r.subarray(c,c+t)},b=function(r,l){var c=0;return c=(127&r[l])<<21,c|=(127&r[l+1])<<14,(c|=(127&r[l+2])<<7)|127&r[l+3]},R=function(r,l){return C(r,l)&&b(r,l+6)+10<=r.length-l},I=function(r){for(var l=o(r),c=0;c<l.length;c++){var t=l[c];if(v(t))return d(t)}},v=function(r){return r&&"PRIV"===r.key&&"com.apple.streaming.transportStreamTimestamp"===r.info},E=function(r){var l=String.fromCharCode(r[0],r[1],r[2],r[3]),c=b(r,4);return{type:l,size:c,data:r.subarray(10,10+c)}},o=function(r){for(var l=0,c=[];C(r,l);){for(var t=b(r,l+6),s=(l+=10)+t;l+8<s;){var u=E(r.subarray(l)),n=x(u);n&&c.push(n),l+=u.size+10}O(r,l)&&(l+=10)}return c},x=function(r){return"PRIV"===r.type?p(r):"W"===r.type[0]?y(r):T(r)},p=function(r){if(!(r.size<2)){var l=e(r.data,!0),c=new Uint8Array(r.data.subarray(l.length+1));return{key:r.type,info:l,data:c.buffer}}},T=function(r){if(!(r.size<2)){if("TXXX"===r.type){var l=1,c=e(r.data.subarray(l),!0),t=e(r.data.subarray(l+=c.length+1));return{key:r.type,info:c,data:t}}var s=e(r.data.subarray(1));return{key:r.type,data:s}}},y=function(r){if("WXXX"===r.type){if(r.size<2)return;var l=1,c=e(r.data.subarray(l),!0),t=e(r.data.subarray(l+=c.length+1));return{key:r.type,info:c,data:t}}var s=e(r.data);return{key:r.type,data:s}},d=function(r){if(8===r.data.byteLength){var l=new Uint8Array(r.data),t=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return t/=45,1&l[3]&&(t+=47721858.84),Math.round(t)}},e=function(r,l){void 0===l&&(l=!1);var c=function m(){return!h&&void 0!==self.TextDecoder&&(h=new self.TextDecoder("utf-8")),h}();if(c){var t=c.decode(r);if(l){var s=t.indexOf("\0");return-1!==s?t.substring(0,s):t}return t.replace(/\0/g,"")}for(var n,f,g,u=r.length,D="",L=0;L<u;){if(0===(n=r[L++])&&l)return D;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:D+=String.fromCharCode(n);break;case 12:case 13:f=r[L++],D+=String.fromCharCode((31&n)<<6|63&f);break;case 14:f=r[L++],g=r[L++],D+=String.fromCharCode((15&n)<<12|(63&f)<<6|(63&g)<<0)}}return D},a={decodeTextFrame:T}},"./src/demux/mp3demuxer.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/demux/base-audio-demuxer.ts"),O=S("./src/demux/id3.ts"),A=S("./src/utils/logger.ts"),b=S("./src/demux/mpegaudio.ts");function R(E,o){E.prototype=Object.create(o.prototype),E.prototype.constructor=E,I(E,o)}function I(E,o){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,T){return p.__proto__=T,p})(E,o)}var v=function(E){function o(){return E.apply(this,arguments)||this}R(o,E);var x=o.prototype;return x.resetInitSegment=function(T,y,d,e){E.prototype.resetInitSegment.call(this,T,y,d,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},o.probe=function(T){if(!T)return!1;for(var d=(O.getID3Data(T,0)||[]).length,e=T.length;d<e;d++)if(b.probe(T,d))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},x.canParse=function(T,y){return b.canParse(T,y)},x.appendFrame=function(T,y,d){if(null!==this.basePTS)return b.appendFrame(T,y,d,this.basePTS,this.frameIndex)},o}(C.default);M.default=v},"./src/demux/mp4demuxer.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/types/demuxer.ts"),A=S("./src/utils/mp4-tools.ts"),b=S("./src/demux/dummy-demuxed-track.ts"),R=/\/emsg[-/]ID3/i;M.default=function(){function v(o,x){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=x}var E=v.prototype;return E.resetTimeStamp=function(){},E.resetInitSegment=function(x,p,T,y){var d=Object(A.parseInitSegment)(x),e=this.videoTrack=Object(b.dummyTrack)("video",1),a=this.audioTrack=Object(b.dummyTrack)("audio",1),h=this.txtTrack=Object(b.dummyTrack)("text",1);if(this.id3Track=Object(b.dummyTrack)("id3",1),this.timeOffset=0,d.video){var m=d.video,r=m.timescale,l=m.codec;e.id=m.id,e.timescale=h.timescale=r,e.codec=l}if(d.audio){var c=d.audio,s=c.timescale,u=c.codec;a.id=c.id,a.timescale=s,a.codec=u}h.id=A.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=a.duration=y},E.resetContiguity=function(){},v.probe=function(x){return x=x.length>16384?x.subarray(0,16384):x,Object(A.findBox)(x,["moof"]).length>0},E.demux=function(x,p){this.timeOffset=p;var T=x,y=this.videoTrack,d=this.txtTrack;if(this.config.progressive){this.remainderData&&(T=Object(A.appendUint8Array)(this.remainderData,x));var e=Object(A.segmentValidRange)(T);this.remainderData=e.remainder,y.samples=e.valid||new Uint8Array}else y.samples=T;var a=this.extractID3Track(y,p);return d.samples=Object(A.parseSamples)(p,y),{videoTrack:y,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},E.flush=function(){var x=this.timeOffset,p=this.videoTrack,T=this.txtTrack;p.samples=this.remainderData||new Uint8Array,this.remainderData=null;var y=this.extractID3Track(p,this.timeOffset);return T.samples=Object(A.parseSamples)(x,p),{videoTrack:p,audioTrack:Object(b.dummyTrack)(),id3Track:y,textTrack:Object(b.dummyTrack)()}},E.extractID3Track=function(x,p){var T=this.id3Track;if(x.samples.length){var y=Object(A.findBox)(x.samples,["emsg"]);y&&y.forEach(function(d){var e=Object(A.parseEmsg)(d);if(R.test(e.schemeIdUri)){var a=Object(C.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:p+e.presentationTimeDelta/e.timeScale,h=e.payload;T.samples.push({data:h,len:h.byteLength,dts:a,pts:a,type:O.MetadataSchema.emsg})}})}return T},E.demuxSampleAes=function(x,p,T){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},E.destroy=function(){},v}()},"./src/demux/mpegaudio.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"appendFrame",function(){return I}),S.d(M,"parseHeader",function(){return v}),S.d(M,"isHeaderPattern",function(){return E}),S.d(M,"isHeader",function(){return o}),S.d(M,"canParse",function(){return x}),S.d(M,"probe",function(){return p});var C=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function I(T,y,d,e,a){if(!(d+24>y.length)){var h=v(y,d);if(h&&d+h.frameLength<=y.length){var i=e+a*(9e4*h.samplesPerFrame/h.sampleRate),r={unit:y.subarray(d,d+h.frameLength),pts:i,dts:i};return T.config=[],T.channelCount=h.channelCount,T.samplerate=h.sampleRate,T.samples.push(r),{sample:r,length:h.frameLength,missing:0}}}}function v(T,y){var d=T[y+1]>>3&3,e=T[y+1]>>1&3,a=T[y+2]>>4&15,h=T[y+2]>>2&3;if(1!==d&&0!==a&&15!==a&&3!==h){var i=T[y+3]>>6,l=1e3*O[14*(3===d?3-e:3===e?3:4)+a-1],t=A[3*(3===d?0:2===d?1:2)+h],s=3===i?1:2,u=b[d][e],n=R[e],f=8*u*n,g=Math.floor(u*l/t+(T[y+2]>>1&1))*n;if(null===C){var L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);C=L?parseInt(L[1]):0}return!!C&&C<=87&&2===e&&l>=224e3&&0===i&&(T[y+3]=128|T[y+3]),{sampleRate:t,channelCount:s,frameLength:g,samplesPerFrame:f}}}function E(T,y){return 255===T[y]&&224==(224&T[y+1])&&0!=(6&T[y+1])}function o(T,y){return y+1<T.length&&E(T,y)}function x(T,y){return E(T,y)&&4<=T.length-y}function p(T,y){if(y+1<T.length&&E(T,y)){var e=v(T,y),a=4;null!=e&&e.frameLength&&(a=e.frameLength);var h=y+a;return h===T.length||o(T,h)}return!1}},"./src/demux/sample-aes.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/crypt/decrypter.ts"),O=S("./src/demux/tsdemuxer.ts");M.default=function(){function b(I,v,E){this.keyData=void 0,this.decrypter=void 0,this.keyData=E,this.decrypter=new C.default(I,v,{removePKCS7Padding:!1})}var R=b.prototype;return R.decryptBuffer=function(v,E){this.decrypter.decrypt(v,this.keyData.key.buffer,this.keyData.iv.buffer,E)},R.decryptAacSample=function(v,E,o,x){var p=v[E].unit;if(!(p.length<=16)){var T=p.subarray(16,p.length-p.length%16),y=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),d=this;this.decryptBuffer(y,function(e){var a=new Uint8Array(e);p.set(a,16),x||d.decryptAacSamples(v,E+1,o)})}},R.decryptAacSamples=function(v,E,o){for(;;E++){if(E>=v.length)return void o();if(!(v[E].unit.length<32)){var x=this.decrypter.isSync();if(this.decryptAacSample(v,E,o,x),!x)return}}},R.getAvcEncryptedData=function(v){for(var E=16*Math.floor((v.length-48)/160)+16,o=new Int8Array(E),x=0,p=32;p<v.length-16;p+=160,x+=16)o.set(v.subarray(p,p+16),x);return o},R.getAvcDecryptedUnit=function(v,E){for(var o=new Uint8Array(E),x=0,p=32;p<v.length-16;p+=160,x+=16)v.set(o.subarray(x,x+16),p);return v},R.decryptAvcSample=function(v,E,o,x,p,T){var y=Object(O.discardEPB)(p.data),d=this.getAvcEncryptedData(y),e=this;this.decryptBuffer(d.buffer,function(a){p.data=e.getAvcDecryptedUnit(y,a),T||e.decryptAvcSamples(v,E,o+1,x)})},R.decryptAvcSamples=function(v,E,o,x){if(v instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;E++,o=0){if(E>=v.length)return void x();for(var p=v[E].units;!(o>=p.length);o++){var T=p[o];if(!(T.data.length<=48||1!==T.type&&5!==T.type)){var y=this.decrypter.isSync();if(this.decryptAvcSample(v,E,o,x,T,y),!y)return}}}},b}()},"./src/demux/transmuxer-interface.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return p});var C=S("./node_modules/webworkify-webpack/index.js"),A=S("./src/events.ts"),b=S("./src/demux/transmuxer.ts"),R=S("./src/utils/logger.ts"),I=S("./src/errors.ts"),v=S("./src/utils/mediasource-helper.ts"),E=S("./node_modules/eventemitter3/index.js"),x=Object(v.getMediaSource)()||{isTypeSupported:function(){return!1}},p=function(){function T(d,e,a,h){var m=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=d,this.id=e,this.onTransmuxComplete=a,this.onFlush=h;var i=d.config,r=function(u,n){(n=n||{}).frag=m.frag,n.id=m.id,d.trigger(u,n)};this.observer=new E.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,r),this.observer.on(A.Events.ERROR,r);var l={mp4:x.isTypeSupported("video/mp4"),mpeg:x.isTypeSupported("audio/mpeg"),mp3:x.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var t;R.logger.log("demuxing in webworker");try{t=this.worker=C("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),t.addEventListener("message",this.onwmsg),t.onerror=function(s){d.trigger(A.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(s.message+"  ("+s.filename+":"+s.lineno+")")})},t.postMessage({cmd:"init",typeSupported:l,vendor:c,id:e,config:JSON.stringify(i)})}catch(s){R.logger.warn("Error in worker:",s),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),t&&self.URL.revokeObjectURL(t.objectURL),this.transmuxer=new b.default(this.observer,l,i,c,e),this.worker=null}}else this.transmuxer=new b.default(this.observer,l,i,c,e)}var y=T.prototype;return y.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var a=this.transmuxer;a&&(a.destroy(),this.transmuxer=null)}var h=this.observer;h&&h.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},y.push=function(e,a,h,m,i,r,l,c,t,s){var u,n,f=this;t.transmuxing.start=self.performance.now();var g=this.transmuxer,D=this.worker,L=r?r.start:i.start,P=i.decryptdata,B=this.frag,F=!(B&&i.cc===B.cc),U=!(B&&t.level===B.level),N=B?t.sn-B.sn:-1,k=this.part?t.part-this.part.index:-1,w=!U&&(1===N||0===N&&(1===k||0===N&&t.id>1&&t.id===(null==B?void 0:B.stats.chunkCount)&&k<=0)),W=self.performance.now();(U||N||0===i.stats.parsing.start)&&(i.stats.parsing.start=W),r&&(k||!w)&&(r.stats.parsing.start=W);var j=!(B&&(null===(u=i.initSegment)||void 0===u?void 0:u.url)===(null===(n=B.initSegment)||void 0===n?void 0:n.url)),_=new b.TransmuxState(F,w,c,U,L,j);if(!w||F||j){R.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+t.sn+" p: "+t.part+" level: "+t.level+" id: "+t.id+"\n        discontinuity: "+F+"\n        trackSwitch: "+U+"\n        contiguous: "+w+"\n        accurateTimeOffset: "+c+"\n        timeOffset: "+L+"\n        initSegmentChange: "+j);var Y=new b.TransmuxConfig(h,m,a,l,s);this.configureTransmuxer(Y)}if(this.frag=i,this.part=r,D)D.postMessage({cmd:"demux",data:e,decryptdata:P,chunkMeta:t,state:_},e instanceof ArrayBuffer?[e]:[]);else if(g){var z=g.push(e,P,t,_);Object(b.isPromise)(z)?z.then(function(X){f.handleTransmuxComplete(X)}):this.handleTransmuxComplete(z)}},y.flush=function(e){var a=this;e.transmuxing.start=self.performance.now();var h=this.transmuxer,m=this.worker;if(m)m.postMessage({cmd:"flush",chunkMeta:e});else if(h){var i=h.flush(e);Object(b.isPromise)(i)?i.then(function(r){a.handleFlushResult(r,e)}):this.handleFlushResult(i,e)}},y.handleFlushResult=function(e,a){var h=this;e.forEach(function(m){h.handleTransmuxComplete(m)}),this.onFlush(a)},y.onWorkerMessage=function(e){var a=e.data,h=this.hls;switch(a.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(a.data);break;case"flush":this.onFlush(a.data);break;case"workerLog":R.logger[a.data.logType]&&R.logger[a.data.logType](a.data.message);break;default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,h.trigger(a.event,a.data)}},y.configureTransmuxer=function(e){var a=this.worker,h=this.transmuxer;a?a.postMessage({cmd:"configure",config:e}):h&&h.configure(e)},y.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},T}()},"./src/demux/transmuxer-worker.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return I});var C=S("./src/demux/transmuxer.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts"),b=S("./node_modules/eventemitter3/index.js");function I(p){var T=new b.EventEmitter,y=function(a,h){p.postMessage({event:a,data:h})};T.on(O.Events.FRAG_DECRYPTED,y),T.on(O.Events.ERROR,y);p.addEventListener("message",function(e){var a=e.data;switch(a.cmd){case"init":var h=JSON.parse(a.config);p.transmuxer=new C.default(T,a.typeSupported,h,a.vendor,a.id),Object(A.enableLogs)(h.debug),function(){var a=function(i){A.logger[i]=function(c){y("workerLog",{logType:i,message:c})}};for(var h in A.logger)a(h)}(),y("init",null);break;case"configure":p.transmuxer.configure(a.config);break;case"demux":var m=p.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(C.isPromise)(m)?m.then(function(l){v(p,l)}):v(p,m);break;case"flush":var i=a.chunkMeta,r=p.transmuxer.flush(i);Object(C.isPromise)(r)?r.then(function(l){o(p,l,i)}):o(p,r,i)}})}function v(p,T){if(function x(p){return!(p.audio||p.video||p.text||p.id3||p.initSegment)}(T.remuxResult))return!1;var y=[],d=T.remuxResult,e=d.audio,a=d.video;return e&&E(y,e),a&&E(y,a),p.postMessage({event:"transmuxComplete",data:T},y),!0}function E(p,T){T.data1&&p.push(T.data1.buffer),T.data2&&p.push(T.data2.buffer)}function o(p,T,y){T.reduce(function(e,a){return v(p,a)||e},!1)||p.postMessage({event:"transmuxComplete",data:T[0]}),p.postMessage({event:"flush",data:y})}},"./src/demux/transmuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return y}),S.d(M,"isPromise",function(){return a}),S.d(M,"TransmuxConfig",function(){return h}),S.d(M,"TransmuxState",function(){return m});var p,C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/crypt/decrypter.ts"),b=S("./src/demux/aacdemuxer.ts"),R=S("./src/demux/mp4demuxer.ts"),I=S("./src/demux/tsdemuxer.ts"),v=S("./src/demux/mp3demuxer.ts"),E=S("./src/remux/mp4-remuxer.ts"),o=S("./src/remux/passthrough-remuxer.ts"),x=S("./src/utils/logger.ts");try{p=self.performance.now.bind(self.performance)}catch(i){x.logger.debug("Unable to use Performance API on this environment"),p=self.Date.now}var T=[{demux:I.default,remux:E.default},{demux:R.default,remux:o.default},{demux:b.default,remux:E.default},{demux:v.default,remux:E.default}],y=function(){function i(l,c,t,s,u){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=l,this.typeSupported=c,this.config=t,this.vendor=s,this.id=u}var r=i.prototype;return r.configure=function(c){this.transmuxConfig=c,this.decrypter&&this.decrypter.reset()},r.push=function(c,t,s,u){var n=this,f=s.transmuxing;f.executeStart=p();var g=new Uint8Array(c),D=this.config,L=this.currentTransmuxState,P=this.transmuxConfig;u&&(this.currentTransmuxState=u);var B=u||L,F=B.contiguous,U=B.discontinuity,N=B.trackSwitch,k=B.accurateTimeOffset,K=B.timeOffset,w=B.initSegmentChange,_=P.defaultInitPts;(U||N||w)&&this.resetInitSegment(P.initSegmentData,P.audioCodec,P.videoCodec,P.duration),(U||w)&&this.resetInitialTimestamp(_),F||this.resetContiguity();var X=function d(i,r){var l=null;return i.byteLength>0&&null!=r&&null!=r.key&&null!==r.iv&&null!=r.method&&(l=r),l}(g,t);if(X&&"AES-128"===X.method){var H=this.getDecrypter();if(!D.enableSoftwareAES)return this.decryptionPromise=H.webCryptoDecrypt(g,X.key.buffer,X.iv.buffer).then(function(J){var Z=n.push(J,null,s);return n.decryptionPromise=null,Z}),this.decryptionPromise;var $=H.softwareDecrypt(g,X.key.buffer,X.iv.buffer);if(!$)return f.executeEnd=p(),e(s);g=new Uint8Array($)}this.needsProbing(g,U,N)&&this.configureTransmuxer(g,P);var Q=this.transmux(g,X,K,k,s),V=this.currentTransmuxState;return V.contiguous=!0,V.discontinuity=!1,V.trackSwitch=!1,f.executeEnd=p(),Q},r.flush=function(c){var t=this,s=c.transmuxing;s.executeStart=p();var u=this.decrypter,n=this.currentTransmuxState,f=this.decryptionPromise;if(f)return f.then(function(){return t.flush(c)});var g=[],D=n.timeOffset;if(u){var L=u.flush();L&&g.push(this.push(L,null,c))}var P=this.demuxer;if(!P||!this.remuxer)return this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=p(),[e(c)];var F=P.flush(D);return a(F)?F.then(function(U){return t.flushRemux(g,U,c),g}):(this.flushRemux(g,F,c),g)},r.flushRemux=function(c,t,s){var u=t.audioTrack,n=t.videoTrack,f=t.id3Track,g=t.textTrack,D=this.currentTransmuxState,L=D.accurateTimeOffset,P=D.timeOffset;x.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var B=this.remuxer.remux(u,n,f,g,P,L,!0,this.id);c.push({remuxResult:B,chunkMeta:s}),s.transmuxing.executeEnd=p()},r.resetInitialTimestamp=function(c){var t=this.demuxer,s=this.remuxer;!t||!s||(t.resetTimeStamp(c),s.resetTimeStamp(c))},r.resetContiguity=function(){var c=this.demuxer,t=this.remuxer;!c||!t||(c.resetContiguity(),t.resetNextTimestamp())},r.resetInitSegment=function(c,t,s,u){var n=this.demuxer,f=this.remuxer;!n||!f||(n.resetInitSegment(c,t,s,u),f.resetInitSegment(c,t,s))},r.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},r.transmux=function(c,t,s,u,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(c,t,s,u,n):this.transmuxUnencrypted(c,s,u,n)},r.transmuxUnencrypted=function(c,t,s,u){var n=this.demuxer.demux(c,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,t,s,!1,this.id),chunkMeta:u}},r.transmuxSampleAes=function(c,t,s,u,n){var f=this;return this.demuxer.demuxSampleAes(c,t,s).then(function(g){return{remuxResult:f.remuxer.remux(g.audioTrack,g.videoTrack,g.id3Track,g.textTrack,s,u,!1,f.id),chunkMeta:n}})},r.configureTransmuxer=function(c,t){for(var F,s=this.config,u=this.observer,n=this.typeSupported,f=this.vendor,g=t.audioCodec,D=t.defaultInitPts,L=t.duration,P=t.initSegmentData,B=t.videoCodec,U=0,N=T.length;U<N;U++)if(T[U].demux.probe(c)){F=T[U];break}F||(x.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),F={demux:R.default,remux:o.default});var k=this.demuxer,K=this.remuxer,w=F.remux,W=F.demux;(!K||!(K instanceof w))&&(this.remuxer=new w(u,s,n,f)),(!k||!(k instanceof W))&&(this.demuxer=new W(u,s,n),this.probe=W.probe),this.resetInitSegment(P,g,B,L),this.resetInitialTimestamp(D)},r.needsProbing=function(c,t,s){return!this.demuxer||!this.remuxer||t||s},r.getDecrypter=function(){var c=this.decrypter;return c||(c=this.decrypter=new A.default(this.observer,this.config)),c},i}();var e=function(r){return{remuxResult:{},chunkMeta:r}};function a(i){return"then"in i&&i.then instanceof Function}var h=function(r,l,c,t,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=l,this.initSegmentData=c,this.duration=t,this.defaultInitPts=s},m=function(r,l,c,t,s,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=l,this.accurateTimeOffset=c,this.trackSwitch=t,this.timeOffset=s,this.initSegmentChange=u}},"./src/demux/tsdemuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"discardEPB",function(){return h});var C=S("./src/demux/adts.ts"),O=S("./src/demux/mpegaudio.ts"),A=S("./src/demux/exp-golomb.ts"),b=S("./src/demux/sample-aes.ts"),R=S("./src/events.ts"),I=S("./src/utils/mp4-tools.ts"),v=S("./src/utils/logger.ts"),E=S("./src/errors.ts"),o=S("./src/types/demuxer.ts");function x(){return x=Object.assign?Object.assign.bind():function(m){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(m[l]=r[l])}return m},x.apply(this,arguments)}function T(m,i,r,l){return{key:m,frame:!1,pts:i,dts:r,units:[],debug:l,length:0}}function y(m,i){return(31&m[i+10])<<8|m[i+11]}function d(m,i,r,l){var c={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=i+3+((15&m[i+1])<<8|m[i+2])-4;for(i+=12+((15&m[i+10])<<8|m[i+11]);i<s;){var n=(31&m[i+1])<<8|m[i+2];switch(m[i]){case 207:if(!l){v.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===c.audio&&(c.audio=n);break;case 21:-1===c.id3&&(c.id3=n);break;case 219:if(!l){v.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===c.avc&&(c.avc=n);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?v.logger.log("MPEG audio found, not supported in this browser"):-1===c.audio&&(c.audio=n,c.segmentCodec="mp3");break;case 36:v.logger.warn("Unsupported HEVC stream type found")}i+=5+((15&m[i+3])<<8|m[i+4])}return c}function e(m){var r,l,c,t,s,i=0,u=m.data;if(!m||0===m.size)return null;for(;u[0].length<19&&u.length>1;){var n=new Uint8Array(u[0].length+u[1].length);n.set(u[0]),n.set(u[1],u[0].length),u[0]=n,u.splice(1,1)}if(1===((r=u[0])[0]<<16)+(r[1]<<8)+r[2]){if((l=(r[4]<<8)+r[5])&&l>m.size-6)return null;var g=r[7];192&g&&(t=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&g?t-(s=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>54e5&&(v.logger.warn(Math.round((t-s)/9e4)+"s delta between PTS and DTS, align them"),t=s):s=t);var D=(c=r[8])+9;if(m.size<=D)return null;m.size-=D;for(var L=new Uint8Array(m.size),P=0,B=u.length;P<B;P++){var F=(r=u[P]).byteLength;if(D){if(D>F){D-=F;continue}r=r.subarray(D),F-=D,D=0}L.set(r,i),i+=F}return l&&(l-=c+3),{data:L,pts:t,dts:s,len:l}}return null}function a(m,i){if(m.units.length&&m.frame){if(void 0===m.pts){var r=i.samples,l=r.length;if(!l)return void i.dropped++;var c=r[l-1];m.pts=c.pts,m.dts=c.dts}i.samples.push(m)}m.debug.length&&v.logger.log(m.pts+"/"+m.dts+":"+m.debug)}function h(m){for(var i=m.byteLength,r=[],l=1;l<i-2;)0===m[l]&&0===m[l+1]&&3===m[l+2]?(r.push(l+2),l+=2):l++;if(0===r.length)return m;var c=i-r.length,t=new Uint8Array(c),s=0;for(l=0;l<c;s++,l++)s===r[0]&&(s++,r.shift()),t[l]=m[s];return t}M.default=function(){function m(r,l,c){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=l,this.typeSupported=c}m.probe=function(l){return 71===l[0]&&71===l[188]},m.createTrack=function(l,c){return{container:"video"===l||"audio"===l?"video/mp2t":void 0,type:l,id:I.RemuxerTrackIdConfig[l],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===l?c:void 0}};var i=m.prototype;return i.resetInitSegment=function(l,c,t,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=m.createTrack("video"),this._audioTrack=m.createTrack("audio",s),this._id3Track=m.createTrack("id3"),this._txtTrack=m.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=c,this.videoCodec=t,this._duration=s},i.resetTimeStamp=function(){},i.resetContiguity=function(){var l=this._audioTrack,c=this._avcTrack,t=this._id3Track;l&&(l.pesData=null),c&&(c.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null},i.demux=function(l,c,t,s){void 0===t&&(t=!1),void 0===s&&(s=!1),t||(this.sampleAes=null);var u,n=this._avcTrack,f=this._audioTrack,g=this._id3Track,D=this._txtTrack,L=n.pid,P=n.pesData,B=f.pid,F=g.pid,U=f.pesData,N=g.pesData,k=null,K=this.pmtParsed,w=this._pmtId,W=l.length;if(this.remainderData&&(W=(l=Object(I.appendUint8Array)(this.remainderData,l)).length,this.remainderData=null),W<188&&!s)return this.remainderData=l,{audioTrack:f,videoTrack:n,id3Track:g,textTrack:D};(W-=W%188)<l.byteLength&&!s&&(this.remainderData=new Uint8Array(l.buffer,W,l.buffer.byteLength-W));for(var j=0,_=0;_<W;_+=188)if(71===l[_]){var Y=!!(64&l[_+1]),z=((31&l[_+1])<<8)+l[_+2],H=void 0;if((48&l[_+3])>>4>1){if((H=_+5+l[_+4])===_+188)continue}else H=_+4;switch(z){case L:Y&&(P&&(u=e(P))&&this.parseAVCPES(n,D,u,!1),P={data:[],size:0}),P&&(P.data.push(l.subarray(H,_+188)),P.size+=_+188-H);break;case B:if(Y){if(U&&(u=e(U)))switch(f.segmentCodec){case"aac":this.parseAACPES(f,u);break;case"mp3":this.parseMPEGPES(f,u)}U={data:[],size:0}}U&&(U.data.push(l.subarray(H,_+188)),U.size+=_+188-H);break;case F:Y&&(N&&(u=e(N))&&this.parseID3PES(g,u),N={data:[],size:0}),N&&(N.data.push(l.subarray(H,_+188)),N.size+=_+188-H);break;case 0:Y&&(H+=l[H]+1),w=this._pmtId=y(l,H);break;case w:Y&&(H+=l[H]+1);var $=d(l,H,this.typeSupported,t);(L=$.avc)>0&&(n.pid=L),(B=$.audio)>0&&(f.pid=B,f.segmentCodec=$.segmentCodec),(F=$.id3)>0&&(g.pid=F),null!==k&&!K&&(v.logger.log("unknown PID '"+k+"' in TS found"),k=null),K=this.pmtParsed=!0;break;case 17:case 8191:break;default:k=z}}else j++;j>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+j+" TS packet/s that do not start with 0x47"}),n.pesData=P,f.pesData=U,g.pesData=N;var Q={audioTrack:f,videoTrack:n,id3Track:g,textTrack:D};return s&&this.extractRemainingSamples(Q),Q},i.flush=function(){var c,l=this.remainderData;return this.remainderData=null,c=l?this.demux(l,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(c),this.sampleAes?this.decrypt(c,this.sampleAes):c},i.extractRemainingSamples=function(l){var D,c=l.audioTrack,t=l.videoTrack,s=l.id3Track,u=l.textTrack,n=t.pesData,f=c.pesData,g=s.pesData;if(n&&(D=e(n))?(this.parseAVCPES(t,u,D,!0),t.pesData=null):t.pesData=n,f&&(D=e(f))){switch(c.segmentCodec){case"aac":this.parseAACPES(c,D);break;case"mp3":this.parseMPEGPES(c,D)}c.pesData=null}else null!=f&&f.size&&v.logger.log("last AAC PES packet truncated,might overlap between fragments"),c.pesData=f;g&&(D=e(g))?(this.parseID3PES(s,D),s.pesData=null):s.pesData=g},i.demuxSampleAes=function(l,c,t){var s=this.demux(l,t,!0,!this.config.progressive),u=this.sampleAes=new b.default(this.observer,this.config,c);return this.decrypt(s,u)},i.decrypt=function(l,c){return new Promise(function(t){var s=l.audioTrack,u=l.videoTrack;s.samples&&"aac"===s.segmentCodec?c.decryptAacSamples(s.samples,0,function(){u.samples?c.decryptAvcSamples(u.samples,0,0,function(){t(l)}):t(l)}):u.samples&&c.decryptAvcSamples(u.samples,0,0,function(){t(l)})})},i.destroy=function(){this._duration=0},i.parseAVCPES=function(l,c,t,s){var D,u=this,n=this.parseAVCNALu(l,t.data),g=this.avcSample,L=!1;t.data=null,g&&n.length&&!l.audFound&&(a(g,l),g=this.avcSample=T(!1,t.pts,t.dts,"")),n.forEach(function(P){switch(P.type){case 1:D=!0,g||(g=u.avcSample=T(!0,t.pts,t.dts,"")),g.frame=!0;var B=P.data;if(L&&B.length>4){var F=new A.default(B).readSliceType();(2===F||4===F||7===F||9===F)&&(g.key=!0)}break;case 5:D=!0,g||(g=u.avcSample=T(!0,t.pts,t.dts,"")),g.key=!0,g.frame=!0;break;case 6:D=!0,Object(I.parseSEIMessageFromNALu)(h(P.data),t.pts,c.samples);break;case 7:if(D=!0,L=!0,!l.sps){var N=new A.default(P.data).readSPS();l.width=N.width,l.height=N.height,l.pixelRatio=N.pixelRatio,l.sps=[P.data],l.duration=u._duration;for(var k=P.data.subarray(1,4),K="avc1.",w=0;w<3;w++){var W=k[w].toString(16);W.length<2&&(W="0"+W),K+=W}l.codec=K}break;case 8:D=!0,l.pps||(l.pps=[P.data]);break;case 9:D=!1,l.audFound=!0,g&&a(g,l),g=u.avcSample=T(!1,t.pts,t.dts,"");break;case 12:D=!0;break;default:D=!1,g&&(g.debug+="unknown NAL "+P.type+" ")}g&&D&&g.units.push(P)}),s&&g&&(a(g,l),this.avcSample=null)},i.getLastNalUnit=function(l){var c,s,t=this.avcSample;if((!t||0===t.units.length)&&(t=l[l.length-1]),null!==(c=t)&&void 0!==c&&c.units){var u=t.units;s=u[u.length-1]}return s},i.parseAVCNALu=function(l,c){var g,D,t=c.byteLength,s=l.naluState||0,u=s,n=[],f=0,P=-1,B=0;for(-1===s&&(P=0,B=31&c[0],s=0,f=1);f<t;)if(g=c[f++],s)if(1!==s)if(g)if(1===g){if(P>=0){var F={data:c.subarray(P,f-s-1),type:B};n.push(F)}else{var U=this.getLastNalUnit(l.samples);if(U&&(u&&f<=4-u&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-u)),(D=f-s-1)>0)){var N=new Uint8Array(U.data.byteLength+D);N.set(U.data,0),N.set(c.subarray(0,D),U.data.byteLength),U.data=N,U.state=0}}f<t?(P=f,B=31&c[f],s=0):s=-1}else s=0;else s=3;else s=g?0:2;else s=g?0:1;if(P>=0&&s>=0){var k={data:c.subarray(P,t),type:B,state:s};n.push(k)}if(0===n.length){var K=this.getLastNalUnit(l.samples);if(K){var w=new Uint8Array(K.data.byteLength+c.byteLength);w.set(K.data,0),w.set(c,K.data.byteLength),K.data=w}}return l.naluState=s,n},i.parseAACPES=function(l,c){var L,P,B,F,U,t=0,s=this.aacOverFlow,u=c.data;if(s){this.aacOverFlow=null;var n=s.missing,f=s.sample.unit.byteLength;if(-1===n){var g=new Uint8Array(f+u.byteLength);g.set(s.sample.unit,0),g.set(u,f),u=g}else{var D=f-n;s.sample.unit.set(u.subarray(0,n),D),l.samples.push(s.sample),t=s.missing}}for(L=t,P=u.length;L<P-1&&!C.isHeader(u,L);L++);if(L===t||(L<P-1?(B="AAC PES did not start with ADTS header,offset:"+L,F=!1):(B="no ADTS header found in AAC PES",F=!0),v.logger.warn("parsing error:"+B),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:B}),!F)){if(C.initTrackConfig(l,this.observer,u,L,this.audioCodec),void 0!==c.pts)U=c.pts;else{if(!s)return void v.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var N=C.getFrameDuration(l.samplerate);U=s.sample.pts+N}for(var K,k=0;L<P;){if(L+=(K=C.appendFrame(l,u,L,U,k)).length,K.missing){this.aacOverFlow=K;break}for(k++;L<P-1&&!C.isHeader(u,L);L++);}}},i.parseMPEGPES=function(l,c){var t=c.data,s=t.length,u=0,n=0,f=c.pts;if(void 0!==f)for(;n<s;)if(O.isHeader(t,n)){var g=O.appendFrame(l,t,n,f,u);if(!g)break;n+=g.length,u++}else n++;else v.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},i.parseID3PES=function(l,c){if(void 0!==c.pts){var t=x({},c,{type:this._avcTrack?o.MetadataSchema.emsg:o.MetadataSchema.audioId3});l.samples.push(t)}else v.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},m}()},"./src/errors.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"ErrorTypes",function(){return C}),S.d(M,"ErrorDetails",function(){return O});var C=(()=>{return(A=C||(C={})).NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError",C;var A})(),O=(()=>{return(A=O||(O={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",A.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException",A.INTERNAL_ABORTED="aborted",A.UNKNOWN="unknown",O;var A})()},"./src/events.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"Events",function(){return C});var C=(()=>{return(O=C||(C={})).MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached",C;var O})()},"./src/hls.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return i});var C=S("./node_modules/url-toolkit/src/url-toolkit.js"),A=S("./src/loader/playlist-loader.ts"),b=S("./src/loader/key-loader.ts"),R=S("./src/controller/id3-track-controller.ts"),I=S("./src/controller/latency-controller.ts"),v=S("./src/controller/level-controller.ts"),E=S("./src/controller/fragment-tracker.ts"),o=S("./src/controller/stream-controller.ts"),x=S("./src/is-supported.ts"),p=S("./src/utils/logger.ts"),T=S("./src/config.ts"),y=S("./node_modules/eventemitter3/index.js"),e=S("./src/events.ts"),a=S("./src/errors.ts");function h(r,l){for(var c=0;c<l.length;c++){var t=l[c];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}var i=function(){function r(c){void 0===c&&(c={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var t=this.config=Object(T.mergeConfig)(r.DefaultConfig,c);this.userConfig=c,Object(p.enableLogs)(t.debug),this._autoLevelCapping=-1,t.progressive&&Object(T.enableStreamingMode)(t);var u=t.bufferController,n=t.capLevelController,f=t.fpsController,g=this.abrController=new(0,t.abrController)(this),D=this.bufferController=new u(this),L=this.capLevelController=new n(this),P=new f(this),B=new A.default(this),F=new b.default(this),U=new R.default(this),N=this.levelController=new v.default(this),k=new E.FragmentTracker(this),K=this.streamController=new o.default(this,k);L.setStreamController(K),P.setStreamController(K);var w=[B,F,N,K];this.networkControllers=w;var W=[g,D,L,P,U,k];this.audioTrackController=this.createController(t.audioTrackController,null,w),this.createController(t.audioStreamController,k,w),this.subtitleTrackController=this.createController(t.subtitleTrackController,null,w),this.createController(t.subtitleStreamController,k,w),this.createController(t.timelineController,null,W),this.emeController=this.createController(t.emeController,null,W),this.cmcdController=this.createController(t.cmcdController,null,W),this.latencyController=this.createController(I.default,null,W),this.coreComponents=W}r.isSupported=function(){return Object(x.isSupported)()};var l=r.prototype;return l.createController=function(t,s,u){if(t){var n=s?new t(this,s):new t(this);return u&&u.push(n),n}return null},l.on=function(t,s,u){void 0===u&&(u=this),this._emitter.on(t,s,u)},l.once=function(t,s,u){void 0===u&&(u=this),this._emitter.once(t,s,u)},l.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},l.off=function(t,s,u,n){void 0===u&&(u=this),this._emitter.off(t,s,u,n)},l.listeners=function(t){return this._emitter.listeners(t)},l.emit=function(t,s,u){return this._emitter.emit(t,s,u)},l.trigger=function(t,s){if(this.config.debug)return this.emit(t,t,s);try{return this.emit(t,t,s)}catch(u){p.logger.error("An internal error happened while handling event "+t+'. Error message: "'+u.message+'". Here is a stacktrace:',u),this.trigger(e.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:u})}return!1},l.listenerCount=function(t){return this._emitter.listenerCount(t)},l.destroy=function(){p.logger.log("destroy"),this.trigger(e.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},l.attachMedia=function(t){p.logger.log("attachMedia"),this._media=t,this.trigger(e.Events.MEDIA_ATTACHING,{media:t})},l.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(e.Events.MEDIA_DETACHING,void 0),this._media=null},l.loadSource=function(t){this.stopLoad();var s=this.media,u=this.url,n=this.url=C.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});p.logger.log("loadSource:"+n),s&&u&&u!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(e.Events.MANIFEST_LOADING,{url:t})},l.startLoad=function(t){void 0===t&&(t=-1),p.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(s){s.startLoad(t)})},l.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},l.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},l.recoverMediaError=function(){p.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},l.removeLevel=function(t,s){void 0===s&&(s=0),this.levelController.removeLevel(t,s)},function m(r,l,c){return l&&h(r.prototype,l),c&&h(r,c),Object.defineProperty(r,"prototype",{writable:!1}),r}(r,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){p.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){p.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){p.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){p.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){p.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var s=!!t;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(p.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,s=this.config.minAutoBitrate;if(!t)return 0;for(var u=t.length,n=0;n<u;n++)if(t[n].maxBitrate>=s)return n;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,s=this.autoLevelCapping;return-1===s&&t&&t.length?t.length-1:s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var s=this.audioTrackController;s&&(s.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var s=this.subtitleTrackController;s&&(s.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.4"}},{key:"Events",get:function(){return e.Events}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:T.hlsDefaultConfig},set:function(t){r.defaultConfig=t}}]),r}();i.defaultConfig=void 0},"./src/is-supported.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"isSupported",function(){return A}),S.d(M,"changeTypeSupported",function(){return b});var C=S("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var R=Object(C.getMediaSource)();if(!R)return!1;var I=O();return!(!R||"function"!=typeof R.isTypeSupported||!R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||I&&(!I.prototype||"function"!=typeof I.prototype.appendBuffer||"function"!=typeof I.prototype.remove))}function b(){var R,I=O();return"function"==typeof(null==I||null===(R=I.prototype)||void 0===R?void 0:R.changeType)}},"./src/loader/date-range.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"DateRangeAttribute",function(){return v}),S.d(M,"DateRange",function(){return E});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/attr-list.ts"),A=S("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(o){for(var x=1;x<arguments.length;x++){var p=arguments[x];for(var T in p)Object.prototype.hasOwnProperty.call(p,T)&&(o[T]=p[T])}return o},b.apply(this,arguments)}function R(o,x){for(var p=0;p<x.length;p++){var T=x[p];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(o,T.key,T)}}var v=(()=>{return(o=v||(v={})).ID="ID",o.CLASS="CLASS",o.START_DATE="START-DATE",o.DURATION="DURATION",o.END_DATE="END-DATE",o.END_ON_NEXT="END-ON-NEXT",o.PLANNED_DURATION="PLANNED-DURATION",o.SCTE35_OUT="SCTE35-OUT",o.SCTE35_IN="SCTE35-IN",v;var o})(),E=function(){function o(x,p){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,p){var T=p.attr;for(var y in T)if(Object.prototype.hasOwnProperty.call(x,y)&&x[y]!==T[y]){A.logger.warn('DATERANGE tag attribute: "'+y+'" does not match for tags with ID: "'+x.ID+'"'),this._badValueForSameId=y;break}x=b(new O.AttrList({}),T,x)}if(this.attr=x,this._startDate=new Date(x[v.START_DATE]),v.END_DATE in this.attr){var d=new Date(this.attr[v.END_DATE]);Object(C.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}return function I(o,x,p){return x&&R(o.prototype,x),p&&R(o,p),Object.defineProperty(o,"prototype",{writable:!1}),o}(o,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var p=this.duration;return null!==p?new Date(this._startDate.getTime()+1e3*p):null}},{key:"duration",get:function(){if(v.DURATION in this.attr){var p=this.attr.decimalFloatingPoint(v.DURATION);if(Object(C.isFiniteNumber)(p))return p}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return v.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(v.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(v.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(C.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),o}()},"./src/loader/fragment-loader.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return p}),S.d(M,"LoadError",function(){return y});var C=S("./src/polyfills/number.ts"),O=S("./src/errors.ts");function b(d){var e="function"==typeof Map?new Map:void 0;return b=function(h){if(null===h||!function v(d){return-1!==Function.toString.call(d).indexOf("[native code]")}(h))return h;if("function"!=typeof h)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(h))return e.get(h);e.set(h,m)}function m(){return R(h,arguments,o(this).constructor)}return m.prototype=Object.create(h.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),E(m,h)},b(d)}function R(d,e,a){return(R=I()?Reflect.construct.bind():function(m,i,r){var l=[null];l.push.apply(l,i);var t=new(Function.bind.apply(m,l));return r&&E(t,r.prototype),t}).apply(null,arguments)}function I(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}function E(d,e){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,m){return h.__proto__=m,h})(d,e)}function o(d){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)})(d)}var x=Math.pow(2,17),p=function(){function d(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var e=d.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(h,m){var i=this,r=h.url;if(!r)return Promise.reject(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var l=this.config,c=l.fLoader,t=l.loader;return new Promise(function(s,u){i.loader&&i.loader.destroy();var n=i.loader=h.loader=c?new c(l):new t(l),f=T(h),g={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===h.sn?1/0:x};h.stats=n.stats,n.load(f,g,{onSuccess:function(L,P,B,F){i.resetLoader(h,n),s({frag:h,part:null,payload:L.data,networkDetails:F})},onError:function(L,P,B){i.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:L,networkDetails:B}))},onAbort:function(L,P,B){i.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:B}))},onTimeout:function(L,P,B){i.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:B}))},onProgress:function(L,P,B,F){m&&m({frag:h,part:null,payload:B,networkDetails:F})}})})},e.loadPart=function(h,m,i){var r=this;this.abort();var l=this.config,c=l.fLoader,t=l.loader;return new Promise(function(s,u){r.loader&&r.loader.destroy();var n=r.loader=h.loader=c?new c(l):new t(l),f=T(h,m),g={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:x};m.stats=n.stats,n.load(f,g,{onSuccess:function(L,P,B,F){r.resetLoader(h,n),r.updateStatsFromPart(h,m);var U={frag:h,part:m,payload:L.data,networkDetails:F};i(U),s(U)},onError:function(L,P,B){r.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:m,response:L,networkDetails:B}))},onAbort:function(L,P,B){h.stats.aborted=m.stats.aborted,r.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:m,networkDetails:B}))},onTimeout:function(L,P,B){r.resetLoader(h,n),u(new y({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:m,networkDetails:B}))}})})},e.updateStatsFromPart=function(h,m){var i=h.stats,r=m.stats,l=r.total;if(i.loaded+=r.loaded,l){var c=Math.round(h.duration/m.duration),t=Math.min(Math.round(i.loaded/l),c),u=(c-t)*Math.round(i.loaded/t);i.total=i.loaded+u}else i.total=Math.max(i.loaded,i.total);var n=i.loading,f=r.loading;n.start?n.first+=f.first-f.start:(n.start=f.start,n.first=f.first),n.end=f.end},e.resetLoader=function(h,m){h.loader=null,this.loader===m&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),m.destroy()},d}();function T(d,e){void 0===e&&(e=null);var a=e||d,h={frag:d,part:e,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},m=a.byteRangeStartOffset,i=a.byteRangeEndOffset;return Object(C.isFiniteNumber)(m)&&Object(C.isFiniteNumber)(i)&&(h.rangeStart=m,h.rangeEnd=i),h}var y=function(d){function e(a){for(var h,m=arguments.length,i=new Array(m>1?m-1:0),r=1;r<m;r++)i[r-1]=arguments[r];return(h=d.call.apply(d,[this].concat(i))||this).data=void 0,h.data=a,h}return function A(d,e){d.prototype=Object.create(e.prototype),d.prototype.constructor=d,E(d,e)}(e,d),e}(b(Error))},"./src/loader/fragment.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"ElementaryStreamTypes",function(){return p}),S.d(M,"BaseSegment",function(){return T}),S.d(M,"Fragment",function(){return y}),S.d(M,"Part",function(){return d});var C=S("./src/polyfills/number.ts"),O=S("./node_modules/url-toolkit/src/url-toolkit.js"),b=S("./src/utils/logger.ts"),R=S("./src/loader/level-key.ts"),I=S("./src/loader/load-stats.ts");function v(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,E(e,a)}function E(e,a){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,i){return m.__proto__=i,m})(e,a)}function o(e,a){for(var h=0;h<a.length;h++){var m=a[h];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(e,m.key,m)}}function x(e,a,h){return a&&o(e.prototype,a),h&&o(e,h),Object.defineProperty(e,"prototype",{writable:!1}),e}var p=(()=>{return(e=p||(p={})).AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo",p;var e})(),T=function(){function e(h){var m;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((m={})[p.AUDIO]=null,m[p.VIDEO]=null,m[p.AUDIOVIDEO]=null,m),this.baseurl=h}return e.prototype.setByteRange=function(m,i){var r=m.split("@",2),l=[];l[0]=1===r.length?i?i.byteRangeEndOffset:0:parseInt(r[1]),l[1]=parseInt(r[0])+l[0],this._byteRange=l},x(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(m){this._url=m}}]),e}(),y=function(e){function a(m,i){var r;return(r=e.call(this,i)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new I.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=m,r}v(a,e);var h=a.prototype;return h.createInitializationVector=function(i){for(var r=new Uint8Array(16),l=12;l<16;l++)r[l]=i>>8*(15-l)&255;return r},h.setDecryptDataFromLevelKey=function(i,r){var l=i;return"AES-128"===(null==i?void 0:i.method)&&i.uri&&!i.iv&&((l=R.LevelKey.fromURI(i.uri)).method=i.method,l.iv=this.createInitializationVector(r),l.keyFormat="identity"),l},h.setElementaryStreamInfo=function(i,r,l,c,t,s){void 0===s&&(s=!1);var u=this.elementaryStreams,n=u[i];n?(n.startPTS=Math.min(n.startPTS,r),n.endPTS=Math.max(n.endPTS,l),n.startDTS=Math.min(n.startDTS,c),n.endDTS=Math.max(n.endDTS,t)):u[i]={startPTS:r,endPTS:l,startDTS:c,endDTS:t,partial:s}},h.clearElementaryStreamInfo=function(){var i=this.elementaryStreams;i[p.AUDIO]=null,i[p.VIDEO]=null,i[p.AUDIOVIDEO]=null},x(a,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var i=this.sn;"number"!=typeof i&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&b.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),i=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,i)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(C.isFiniteNumber)(this.programDateTime))return null;var i=Object(C.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*i}},{key:"encrypted",get:function(){var i;return!(null===(i=this.decryptdata)||void 0===i||!i.keyFormat||!this.decryptdata.uri)}}]),a}(T),d=function(e){function a(h,m,i,r,l){var c;(c=e.call(this,i)||this).fragOffset=0,c.duration=0,c.gap=!1,c.independent=!1,c.relurl=void 0,c.fragment=void 0,c.index=void 0,c.stats=new I.LoadStats,c.duration=h.decimalFloatingPoint("DURATION"),c.gap=h.bool("GAP"),c.independent=h.bool("INDEPENDENT"),c.relurl=h.enumeratedString("URI"),c.fragment=m,c.index=r;var t=h.enumeratedString("BYTERANGE");return t&&c.setByteRange(t,l),l&&(c.fragOffset=l.fragOffset+l.duration),c}return v(a,e),x(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var m=this.elementaryStreams;return!!(m.audio||m.video||m.audiovideo)}}]),a}(T)},"./src/loader/key-loader.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return b});var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/utils/logger.ts"),b=function(){function R(v){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=v,this.registerListeners()}var I=R.prototype;return I.startLoad=function(E){},I.stopLoad=function(){this.destroyInternalLoaders()},I.registerListeners=function(){this.hls.on(C.Events.KEY_LOADING,this.onKeyLoading,this)},I.unregisterListeners=function(){this.hls.off(C.Events.KEY_LOADING,this.onKeyLoading)},I.destroyInternalLoaders=function(){for(var E in this.loaders){var o=this.loaders[E];o&&o.destroy()}this.loaders={}},I.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},I.onKeyLoading=function(E,o){var x=o.frag,p=x.type,T=this.loaders[p];if(x.decryptdata){var y=x.decryptdata.uri;if(y!==this.decrypturl||null===this.decryptkey){var d=this.hls.config;if(T&&(A.logger.warn("abort previous key loader for type:"+p),T.abort()),!y)return void A.logger.warn("key uri is falsy");var a=x.loader=this.loaders[p]=new(0,d.loader)(d);this.decrypturl=y,this.decryptkey=null;var h={url:y,frag:x,responseType:"arraybuffer"},m={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(h,m,i)}else this.decryptkey&&(x.decryptdata.key=this.decryptkey,this.hls.trigger(C.Events.KEY_LOADED,{frag:x}))}else A.logger.warn("Missing decryption data on fragment in onKeyLoading")},I.loadsuccess=function(E,o,x){var p=x.frag;p.decryptdata?(this.decryptkey=p.decryptdata.key=new Uint8Array(E.data),p.loader=null,delete this.loaders[p.type],this.hls.trigger(C.Events.KEY_LOADED,{frag:p})):A.logger.error("after key load, decryptdata unset")},I.loaderror=function(E,o){var x=o.frag,p=x.loader;p&&p.abort(),delete this.loaders[x.type],this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:x,response:E})},I.loadtimeout=function(E,o){var x=o.frag,p=x.loader;p&&p.abort(),delete this.loaders[x.type],this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:x})},R}()},"./src/loader/level-details.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"LevelDetails",function(){return R});var C=S("./src/polyfills/number.ts");function O(I,v){for(var E=0;E<v.length;E++){var o=v[E];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(I,o.key,o)}}var R=function(){function I(E){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=E}return I.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var x=this.lastPartSn-o.lastPartSn,p=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!p||!!x,this.advanced=this.endSN>o.endSN||x>0||0===x&&p>0,this.misses=this.updated||this.advanced?Math.floor(.6*o.misses):o.misses+1,this.availabilityDelay=o.availabilityDelay},function A(I,v,E){return v&&O(I.prototype,v),E&&O(I,E),Object.defineProperty(I,"prototype",{writable:!1}),I}(I,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(C.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return null!==(o=this.partList)&&void 0!==o&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return null!==(o=this.fragments)&&void 0!==o&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return null!==(o=this.partList)&&void 0!==o&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return null!==(o=this.partList)&&void 0!==o&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"LevelKey",function(){return R});var C=S("./node_modules/url-toolkit/src/url-toolkit.js");function A(I,v){for(var E=0;E<v.length;E++){var o=v[E];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(I,o.key,o)}}var R=function(){function I(v,E){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=E?Object(C.buildAbsoluteURL)(v,E,{alwaysNormalize:!0}):v}return I.fromURL=function(E,o){return new I(E,o)},I.fromURI=function(E){return new I(E)},function b(I,v,E){return v&&A(I.prototype,v),E&&A(I,E),Object.defineProperty(I,"prototype",{writable:!1}),I}(I,[{key:"uri",get:function(){return this._uri}}]),I}()},"./src/loader/load-stats.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"LoadStats",function(){return C});var C=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return h});var C=S("./src/polyfills/number.ts"),O=S("./node_modules/url-toolkit/src/url-toolkit.js"),b=S("./src/loader/date-range.ts"),R=S("./src/loader/fragment.ts"),I=S("./src/loader/level-details.ts"),v=S("./src/loader/level-key.ts"),E=S("./src/utils/attr-list.ts"),o=S("./src/utils/logger.ts"),x=S("./src/utils/codecs.ts"),p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),d=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),e=/\.(mp4|m4s|m4v|m4a)$/i;var h=function(){function t(){}return t.findGroup=function(u,n){for(var f=0;f<u.length;f++){var g=u[f];if(g.id===n)return g}},t.convertAVC1ToAVCOTI=function(u){var n=u.split(".");if(n.length>2){var f=n.shift()+".";return(f+=parseInt(n.shift()).toString(16))+("000"+parseInt(n.shift()).toString(16)).slice(-4)}return u},t.resolve=function(u,n){return O.buildAbsoluteURL(n,u,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(u,n){var P,f=[],g=[],D={},L=!1;for(p.lastIndex=0;null!=(P=p.exec(u));)if(P[1]){var B,F=new E.AttrList(P[1]),U={attrs:F,bitrate:F.decimalInteger("AVERAGE-BANDWIDTH")||F.decimalInteger("BANDWIDTH"),name:F.NAME,url:t.resolve(P[2],n)},N=F.decimalResolution("RESOLUTION");N&&(U.width=N.width,U.height=N.height),m((F.CODECS||"").split(/[ ,]+/).filter(function(w){return w}),U),U.videoCodec&&-1!==U.videoCodec.indexOf("avc1")&&(U.videoCodec=t.convertAVC1ToAVCOTI(U.videoCodec)),null!==(B=U.unknownCodecs)&&void 0!==B&&B.length||g.push(U),f.push(U)}else if(P[3]){var k=new E.AttrList(P[3]);k["DATA-ID"]&&(L=!0,D[k["DATA-ID"]]=k)}return{levels:g.length>0&&g.length<f.length?g:f,sessionData:L?D:null}},t.parseMasterPlaylistMedia=function(u,n,f,g){void 0===g&&(g=[]);var D,L=[],P=0;for(T.lastIndex=0;null!==(D=T.exec(u));){var B=new E.AttrList(D[1]);if(B.TYPE===f){var F={attrs:B,bitrate:0,id:P++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:f,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?t.resolve(B.URI,n):""};if(g.length){var U=t.findGroup(g,F.groupId)||g[0];i(F,U,"audioCodec"),i(F,U,"textCodec")}L.push(F)}}return L},t.parseLevelPlaylist=function(u,n,f,g,D){var W,j,_,L=new I.LevelDetails(n),P=L.fragments,B=null,F=0,U=0,N=0,k=0,K=null,w=new R.Fragment(g,n),Y=-1,z=!1;for(y.lastIndex=0,L.m3u8=u;null!==(W=y.exec(u));){z&&(z=!1,(w=new R.Fragment(g,n)).start=N,w.sn=F,w.cc=k,w.level=f,B&&(w.initSegment=B,w.rawProgramDateTime=B.rawProgramDateTime,B.rawProgramDateTime=null));var X=W[1];if(X){w.duration=parseFloat(X);var H=(" "+W[2]).slice(1);w.title=H||null,w.tagList.push(H?["INF",X,H]:["INF",X])}else if(W[3])Object(C.isFiniteNumber)(w.duration)&&(w.start=N,_&&(w.levelkey=_),w.sn=F,w.level=f,w.cc=k,w.urlId=D,P.push(w),w.relurl=(" "+W[3]).slice(1),l(w,K),K=w,N+=w.duration,F++,U=0,z=!0);else if(W[4]){var $=(" "+W[4]).slice(1);K?w.setByteRange($,K):w.setByteRange($)}else if(W[5])w.rawProgramDateTime=(" "+W[5]).slice(1),w.tagList.push(["PROGRAM-DATE-TIME",w.rawProgramDateTime]),-1===Y&&(Y=P.length);else{if(!(W=W[0].match(d))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(j=1;j<W.length&&void 0===W[j];j++);var Q=(" "+W[j]).slice(1),V=(" "+W[j+1]).slice(1),J=W[j+2]?(" "+W[j+2]).slice(1):"";switch(Q){case"PLAYLIST-TYPE":L.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":F=L.startSN=parseInt(V);break;case"SKIP":var Z=new E.AttrList(V),q=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(C.isFiniteNumber)(q)){L.skippedSegments=q;for(var oe=q;oe--;)P.unshift(null);F+=q}var ee=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(L.recentlyRemovedDateranges=ee.split("\t"));break;case"TARGETDURATION":L.targetduration=parseFloat(V);break;case"VERSION":L.version=parseInt(V);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(V||J)&&w.tagList.push(J?[V,J]:[V]);break;case"DISCONTINUITY":k++,w.tagList.push(["DIS"]);break;case"GAP":w.tagList.push([Q]);break;case"BITRATE":w.tagList.push([Q,V]);break;case"DATERANGE":var ue=new E.AttrList(V),ne=new b.DateRange(ue,L.dateRanges[ue.ID]);ne.isValid||L.skippedSegments?L.dateRanges[ne.id]=ne:o.logger.warn('Ignoring invalid DATERANGE tag: "'+V+'"'),w.tagList.push(["EXT-X-DATERANGE",V]);break;case"DISCONTINUITY-SEQUENCE":k=parseInt(V);break;case"KEY":var fe,re=new E.AttrList(V),de=re.enumeratedString("METHOD"),ce=re.URI,ge=re.hexadecimalInteger("IV"),he=re.enumeratedString("KEYFORMATVERSIONS"),ye=re.enumeratedString("KEYID"),le=null!=(fe=re.enumeratedString("KEYFORMAT"))?fe:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(le)>-1){o.logger.warn("Keyformat "+le+" is not supported from the manifest");continue}if("identity"!==le)continue;de&&(_=v.LevelKey.fromURL(n,ce),ce&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(de)>=0&&(_.method=de,_.keyFormat=le,ye&&(_.keyID=ye),he&&(_.keyFormatVersions=he),_.iv=ge));break;case"START":var se=new E.AttrList(V).decimalFloatingPoint("TIME-OFFSET");Object(C.isFiniteNumber)(se)&&(L.startTimeOffset=se);break;case"MAP":var me=new E.AttrList(V);if(w.duration){var ae=new R.Fragment(g,n);c(ae,me,f,_),w.initSegment=B=ae,B.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=B.rawProgramDateTime)}else c(w,me,f,_),B=w,z=!0;break;case"SERVER-CONTROL":var te=new E.AttrList(V);L.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),L.holdBack=te.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var xe=new E.AttrList(V);L.partTarget=xe.decimalFloatingPoint("PART-TARGET");break;case"PART":var ve=L.partList;ve||(ve=L.partList=[]);var De=U>0?ve[ve.length-1]:void 0,Ie=U++,Ee=new R.Part(new E.AttrList(V),w,n,Ie,De);ve.push(Ee),w.duration+=Ee.duration;break;case"PRELOAD-HINT":var Ce=new E.AttrList(V);L.preloadHint=Ce;break;case"RENDITION-REPORT":var Pe=new E.AttrList(V);L.renditionReports=L.renditionReports||[],L.renditionReports.push(Pe);break;default:o.logger.warn("line parsed but not handled: "+W)}}}K&&!K.relurl?(P.pop(),N-=K.duration,L.partList&&(L.fragmentHint=K)):L.partList&&(l(w,K),w.cc=k,L.fragmentHint=w);var Se=P.length,Ae=P[0],Le=P[Se-1];if((N+=L.skippedSegments*L.targetduration)>0&&Se&&Le){L.averagetargetduration=N/Se;var Re=Le.sn;L.endSN="initSegment"!==Re?Re:0,Ae&&(L.startCC=Ae.cc,Ae.initSegment||L.fragments.every(function(Oe){return Oe.relurl&&function a(t){var s,u;return e.test(null!=(s=null===(u=O.parseURL(t))||void 0===u?void 0:u.path)?s:"")}(Oe.relurl)})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(w=new R.Fragment(g,n)).relurl=Le.relurl,w.level=f,w.sn="initSegment",Ae.initSegment=w,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(N+=L.fragmentHint.duration),L.totalduration=N,L.endCC=k,Y>0&&function r(t,s){for(var u=t[s],n=s;n--;){var f=t[n];if(!f)return;f.programDateTime=u.programDateTime-1e3*f.duration,u=f}}(P,Y),L},t}();function m(t,s){["video","audio","text"].forEach(function(u){var n=t.filter(function(g){return Object(x.isCodecType)(g,u)});if(n.length){var f=n.filter(function(g){return 0===g.lastIndexOf("avc1",0)||0===g.lastIndexOf("mp4a",0)});s[u+"Codec"]=f.length>0?f[0]:n[0],t=t.filter(function(g){return-1===n.indexOf(g)})}}),s.unknownCodecs=t}function i(t,s,u){var n=s[u];n&&(t[u]=n)}function l(t,s){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=s&&s.programDateTime&&(t.programDateTime=s.endProgramDateTime),Object(C.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function c(t,s,u,n){t.relurl=s.URI,s.BYTERANGE&&t.setByteRange(s.BYTERANGE),t.level=u,t.sn="initSegment",n&&(t.levelkey=n),t.initSegment=null}},"./src/loader/playlist-loader.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/errors.ts"),b=S("./src/utils/logger.ts"),R=S("./src/utils/mp4-tools.ts"),I=S("./src/loader/m3u8-parser.ts"),v=S("./src/types/loader.ts"),E=S("./src/utils/attr-list.ts");function x(T,y){var d=T.url;return(void 0===d||0===d.indexOf("data:"))&&(d=y.url),d}M.default=function(){function T(d){this.hls=void 0,this.loaders=Object.create(null),this.hls=d,this.registerListeners()}var y=T.prototype;return y.startLoad=function(e){},y.stopLoad=function(){this.destroyInternalLoaders()},y.registerListeners=function(){var e=this.hls;e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(e){var a=this.hls.config,r=new(a.pLoader||a.loader)(a);return e.loader=r,this.loaders[e.type]=r,r},y.getInternalLoader=function(e){return this.loaders[e.type]},y.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},y.destroyInternalLoaders=function(){for(var e in this.loaders){var a=this.loaders[e];a&&a.destroy(),this.resetInternalLoader(e)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(e,a){this.load({id:null,groupId:null,level:0,responseType:"text",type:v.PlaylistContextType.MANIFEST,url:a.url,deliveryDirectives:null})},y.onLevelLoading=function(e,a){this.load({id:a.id,groupId:null,level:a.level,responseType:"text",type:v.PlaylistContextType.LEVEL,url:a.url,deliveryDirectives:a.deliveryDirectives})},y.onAudioTrackLoading=function(e,a){this.load({id:a.id,groupId:a.groupId,level:null,responseType:"text",type:v.PlaylistContextType.AUDIO_TRACK,url:a.url,deliveryDirectives:a.deliveryDirectives})},y.onSubtitleTrackLoading=function(e,a){this.load({id:a.id,groupId:a.groupId,level:null,responseType:"text",type:v.PlaylistContextType.SUBTITLE_TRACK,url:a.url,deliveryDirectives:a.deliveryDirectives})},y.load=function(e){var a,r,l,c,t,s,h=this.hls.config,m=this.getInternalLoader(e);if(m){var i=m.context;if(i&&i.url===e.url)return void b.logger.trace("[playlist-loader]: playlist request ongoing");b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),m.abort()}switch(e.type){case v.PlaylistContextType.MANIFEST:r=h.manifestLoadingMaxRetry,l=h.manifestLoadingTimeOut,c=h.manifestLoadingRetryDelay,t=h.manifestLoadingMaxRetryTimeout;break;case v.PlaylistContextType.LEVEL:case v.PlaylistContextType.AUDIO_TRACK:case v.PlaylistContextType.SUBTITLE_TRACK:r=0,l=h.levelLoadingTimeOut;break;default:r=h.levelLoadingMaxRetry,l=h.levelLoadingTimeOut,c=h.levelLoadingRetryDelay,t=h.levelLoadingMaxRetryTimeout}if(m=this.createInternalLoader(e),null!==(a=e.deliveryDirectives)&&void 0!==a&&a.part&&(e.type===v.PlaylistContextType.LEVEL&&null!==e.level?s=this.hls.levels[e.level].details:e.type===v.PlaylistContextType.AUDIO_TRACK&&null!==e.id?s=this.hls.audioTracks[e.id].details:e.type===v.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(s=this.hls.subtitleTracks[e.id].details),s)){var u=s.partTarget,n=s.targetduration;u&&n&&(l=Math.min(1e3*Math.max(3*u,.8*n),l))}var f={timeout:l,maxRetry:r,retryDelay:c,maxRetryDelay:t,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(e,f,g)},y.loadsuccess=function(e,a,h,m){if(void 0===m&&(m=null),h.isSidxRequest)return this.handleSidxRequest(e,h),void this.handlePlaylistLoaded(e,a,h,m);this.resetInternalLoader(h.type);var i=e.data;0===i.indexOf("#EXTM3U")?(a.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,a,h,m):this.handleMasterPlaylist(e,a,h,m)):this.handleManifestParsingError(e,h,"no EXTM3U delimiter",m)},y.loaderror=function(e,a,h){void 0===h&&(h=null),this.handleNetworkError(a,h,!1,e)},y.loadtimeout=function(e,a,h){void 0===h&&(h=null),this.handleNetworkError(a,h,!0)},y.handleMasterPlaylist=function(e,a,h,m){var i=this.hls,r=e.data,l=x(e,h),c=I.default.parseMasterPlaylist(r,l),t=c.levels,s=c.sessionData;if(t.length){var u=t.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),n=t.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),f=I.default.parseMasterPlaylistMedia(r,l,"AUDIO",u),g=I.default.parseMasterPlaylistMedia(r,l,"SUBTITLES",n),D=I.default.parseMasterPlaylistMedia(r,l,"CLOSED-CAPTIONS");f.length&&!f.some(function(P){return!P.url})&&t[0].audioCodec&&!t[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""})),i.trigger(O.Events.MANIFEST_LOADED,{levels:t,audioTracks:f,subtitles:g,captions:D,url:l,stats:a,networkDetails:m,sessionData:s})}else this.handleManifestParsingError(e,h,"no level found in manifest",m)},y.handleTrackOrLevelPlaylist=function(e,a,h,m){var i=this.hls,r=h.id,l=h.level,c=h.type,t=x(e,h),s=Object(C.isFiniteNumber)(r)?r:0,u=Object(C.isFiniteNumber)(l)?l:s,n=function o(T){switch(T.type){case v.PlaylistContextType.AUDIO_TRACK:return v.PlaylistLevelType.AUDIO;case v.PlaylistContextType.SUBTITLE_TRACK:return v.PlaylistLevelType.SUBTITLE;default:return v.PlaylistLevelType.MAIN}}(h),f=I.default.parseLevelPlaylist(e.data,t,u,n,s);if(f.fragments.length){if(c===v.PlaylistContextType.MANIFEST){var g={attrs:new E.AttrList({}),bitrate:0,details:f,name:"",url:t};i.trigger(O.Events.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:t,stats:a,networkDetails:m,sessionData:null})}if(a.parsing.end=performance.now(),f.needSidxRanges){var D,L=null===(D=f.fragments[0].initSegment)||void 0===D?void 0:D.url;this.load({url:L,isSidxRequest:!0,type:c,level:l,levelDetails:f,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else h.levelDetails=f,this.handlePlaylistLoaded(e,a,h,m)}else i.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:t,reason:"no fragments found in level",level:"number"==typeof h.level?h.level:void 0})},y.handleSidxRequest=function(e,a){var h=new Uint8Array(e.data),m=Object(R.findBox)(h,["sidx"])[0];if(m){var i=Object(R.parseSegmentIndex)(m);if(i){var l=a.levelDetails;i.references.forEach(function(c,t){var s=c.info,u=l.fragments[t];if(0===u.byteRange.length&&u.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),u.initSegment){var n=Object(R.findBox)(h,["moov"])[0];u.initSegment.setByteRange(String(n?n.length:null)+"@0")}})}}},y.handleManifestParsingError=function(e,a,h,m){this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===v.PlaylistContextType.MANIFEST,url:e.url,reason:h,response:e,context:a,networkDetails:m})},y.handleNetworkError=function(e,a,h,m){void 0===h&&(h=!1),b.logger.warn("[playlist-loader]: A network "+(h?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var i=A.ErrorDetails.UNKNOWN,r=!1,l=this.getInternalLoader(e);switch(e.type){case v.PlaylistContextType.MANIFEST:i=h?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case v.PlaylistContextType.LEVEL:i=h?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case v.PlaylistContextType.AUDIO_TRACK:i=h?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case v.PlaylistContextType.SUBTITLE_TRACK:i=h?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}l&&this.resetInternalLoader(e.type);var c={type:A.ErrorTypes.NETWORK_ERROR,details:i,fatal:r,url:e.url,loader:l,context:e,networkDetails:a};m&&(c.response=m),this.hls.trigger(O.Events.ERROR,c)},y.handlePlaylistLoaded=function(e,a,h,m){var i=h.type,r=h.level,l=h.id,c=h.groupId,t=h.loader,s=h.levelDetails,u=h.deliveryDirectives;if(null!=s&&s.targetduration){if(t)switch(s.live&&(t.getCacheAge&&(s.ageHeader=t.getCacheAge()||0),(!t.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),i){case v.PlaylistContextType.MANIFEST:case v.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:s,level:r||0,id:l||0,stats:a,networkDetails:m,deliveryDirectives:u});break;case v.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:s,id:l||0,groupId:c||"",stats:a,networkDetails:m,deliveryDirectives:u});break;case v.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:s,id:l||0,groupId:c||"",stats:a,networkDetails:m,deliveryDirectives:u})}}else this.handleManifestParsingError(e,h,"invalid target duration",m)},T}()},"./src/polyfills/number.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"isFiniteNumber",function(){return C}),S.d(M,"MAX_SAFE_INTEGER",function(){return O});var C=Number.isFinite||function(A){return"number"==typeof A&&isFinite(A)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(G,M,S){"use strict";S.r(M),M.default=function(){function O(){}return O.getSilentFrame=function(b,R){if("mp4a.40.2"===b){if(1===R)return new Uint8Array([0,200,0,128,35,128]);if(2===R)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===R)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===R)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===R)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},O}()},"./src/remux/mp4-generator.ts":function(G,M,S){"use strict";S.r(M);var C=Math.pow(2,32)-1,O=function(){function A(){}return A.init=function(){var R;for(R in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})A.types.hasOwnProperty(R)&&(A.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),v=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:I,audio:v};var E=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=o,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var x=new Uint8Array([105,115,111,109]),p=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,x,T,x,p),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,E))},A.box=function(R){for(var I=8,v=arguments.length,E=new Array(v>1?v-1:0),o=1;o<v;o++)E[o-1]=arguments[o];for(var x=E.length,p=x;x--;)I+=E[x].byteLength;var T=new Uint8Array(I);for(T[0]=I>>24&255,T[1]=I>>16&255,T[2]=I>>8&255,T[3]=255&I,T.set(R,4),x=0,I=8;x<p;x++)T.set(E[x],I),I+=E[x].byteLength;return T},A.hdlr=function(R){return A.box(A.types.hdlr,A.HDLR_TYPES[R])},A.mdat=function(R){return A.box(A.types.mdat,R)},A.mdhd=function(R,I){I*=R;var v=Math.floor(I/(C+1)),E=Math.floor(I%(C+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,v>>24,v>>16&255,v>>8&255,255&v,E>>24,E>>16&255,E>>8&255,255&E,85,196,0,0]))},A.mdia=function(R){return A.box(A.types.mdia,A.mdhd(R.timescale,R.duration),A.hdlr(R.type),A.minf(R))},A.mfhd=function(R){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},A.minf=function(R){return A.box(A.types.minf,"audio"===R.type?A.box(A.types.smhd,A.SMHD):A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(R))},A.moof=function(R,I,v){return A.box(A.types.moof,A.mfhd(R),A.traf(v,I))},A.moov=function(R){for(var I=R.length,v=[];I--;)v[I]=A.trak(R[I]);return A.box.apply(null,[A.types.moov,A.mvhd(R[0].timescale,R[0].duration)].concat(v).concat(A.mvex(R)))},A.mvex=function(R){for(var I=R.length,v=[];I--;)v[I]=A.trex(R[I]);return A.box.apply(null,[A.types.mvex].concat(v))},A.mvhd=function(R,I){I*=R;var v=Math.floor(I/(C+1)),E=Math.floor(I%(C+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,v>>24,v>>16&255,v>>8&255,255&v,E>>24,E>>16&255,E>>8&255,255&E,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,o)},A.sdtp=function(R){var E,o,I=R.samples||[],v=new Uint8Array(4+I.length);for(E=0;E<I.length;E++)v[E+4]=(o=I[E].flags).dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return A.box(A.types.sdtp,v)},A.stbl=function(R){return A.box(A.types.stbl,A.stsd(R),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(R){var E,o,x,I=[],v=[];for(E=0;E<R.sps.length;E++)I.push((x=(o=R.sps[E]).byteLength)>>>8&255),I.push(255&x),I=I.concat(Array.prototype.slice.call(o));for(E=0;E<R.pps.length;E++)v.push((x=(o=R.pps[E]).byteLength)>>>8&255),v.push(255&x),v=v.concat(Array.prototype.slice.call(o));var p=A.box(A.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|R.sps.length].concat(I).concat([R.pps.length]).concat(v))),T=R.width,y=R.height,d=R.pixelRatio[0],e=R.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,255&T,y>>8&255,255&y,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e])))},A.esds=function(R){var I=R.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(R.config).concat([6,1,2]))},A.mp4a=function(R){var I=R.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]),A.box(A.types.esds,A.esds(R)))},A.mp3=function(R){var I=R.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]))},A.stsd=function(R){return A.box(A.types.stsd,A.STSD,"audio"===R.type?"mp3"===R.segmentCodec&&"mp3"===R.codec?A.mp3(R):A.mp4a(R):A.avc1(R))},A.tkhd=function(R){var I=R.id,v=R.duration*R.timescale,E=R.width,o=R.height,x=Math.floor(v/(C+1)),p=Math.floor(v%(C+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,0,0,0,0,x>>24,x>>16&255,x>>8&255,255&x,p>>24,p>>16&255,p>>8&255,255&p,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,E>>8&255,255&E,0,0,o>>8&255,255&o,0,0]))},A.traf=function(R,I){var v=A.sdtp(R),E=R.id,o=Math.floor(I/(C+1)),x=Math.floor(I%(C+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,E>>24,E>>16&255,E>>8&255,255&E])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,x>>24,x>>16&255,x>>8&255,255&x])),A.trun(R,v.length+16+20+8+16+8+8),v)},A.trak=function(R){return R.duration=R.duration||4294967295,A.box(A.types.trak,A.tkhd(R),A.mdia(R))},A.trex=function(R){var I=R.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(R,I){var p,T,y,d,e,a,v=R.samples||[],E=v.length,o=12+16*E,x=new Uint8Array(o);for(x.set(["video"===R.type?1:0,0,15,1,E>>>24&255,E>>>16&255,E>>>8&255,255&E,(I+=8+o)>>>24&255,I>>>16&255,I>>>8&255,255&I],0),p=0;p<E;p++)x.set([(y=(T=v[p]).duration)>>>24&255,y>>>16&255,y>>>8&255,255&y,(d=T.size)>>>24&255,d>>>16&255,d>>>8&255,255&d,(e=T.flags).isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,61440&e.degradPrio,15&e.degradPrio,(a=T.cts)>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*p);return A.box(A.types.trun,x)},A.initSegment=function(R){A.types||A.init();var I=A.moov(R),v=new Uint8Array(A.FTYP.byteLength+I.byteLength);return v.set(A.FTYP),v.set(I,A.FTYP.byteLength),v},A}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,M.default=O},"./src/remux/mp4-remuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return e}),S.d(M,"normalizePts",function(){return a}),S.d(M,"flushTextTrackMetadataCueSamples",function(){return m}),S.d(M,"flushTextTrackUserdataCueSamples",function(){return i});var C=S("./src/polyfills/number.ts"),O=S("./src/remux/aac-helper.ts"),A=S("./src/remux/mp4-generator.ts"),b=S("./src/events.ts"),R=S("./src/errors.ts"),I=S("./src/utils/logger.ts"),v=S("./src/types/loader.ts"),E=S("./src/utils/timescale-conversion.ts");function o(){return o=Object.assign?Object.assign.bind():function(c){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(c[u]=s[u])}return c},o.apply(this,arguments)}var y=null,d=null,e=function(){function c(s,u,n,f){if(void 0===f&&(f=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=s,this.config=u,this.typeSupported=n,this.ISGenerated=!1,null===y){var D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);y=D?parseInt(D[1]):0}if(null===d){var L=navigator.userAgent.match(/Safari\/(\d+)/i);d=L?parseInt(L[1]):0}}var t=c.prototype;return t.destroy=function(){},t.resetTimeStamp=function(u){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=u},t.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(u){var n=!1,f=u.reduce(function(g,D){var L=D.pts-g;return L<-4294967296?(n=!0,a(g,D.pts)):L>0?g:D.pts},u[0].pts);return n&&I.logger.debug("PTS rollover detected"),f},t.remux=function(u,n,f,g,D,L,P,B){var F,U,N,k,K,w,W=D,j=D,Y=n.pid>-1,z=n.samples.length,X=u.samples.length>0,H=P&&z>0||z>1;if((!(u.pid>-1)||X)&&(!Y||H)||this.ISGenerated||P){this.ISGenerated||(N=this.generateIS(u,n,D));var J,Q=this.isVideoContiguous,V=-1;if(H&&(V=function h(c){for(var t=0;t<c.length;t++)if(c[t].key)return t;return-1}(n.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,V>0){I.logger.warn("[mp4-remuxer]: Dropped "+V+" out of "+z+" video samples due to a missing keyframe");var Z=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(V),n.dropped+=V,J=j+=(n.samples[0].pts-Z)/n.inputTimeScale}else-1===V&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),w=!1);if(this.ISGenerated){if(X&&H){var q=this.getVideoStartPts(n.samples),ee=(a(u.samples[0].pts,q)-q)/n.inputTimeScale;W+=Math.max(0,ee),j+=Math.max(0,-ee)}if(X){if(u.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(u,n,D)),U=this.remuxAudio(u,W,this.isAudioContiguous,L,Y||H||B===v.PlaylistLevelType.AUDIO?j:void 0),H){var ue=U?U.endPTS-U.startPTS:0;n.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(u,n,D)),F=this.remuxVideo(n,j,Q,ue)}}else H&&(F=this.remuxVideo(n,j,Q,0));F&&(F.firstKeyFrame=V,F.independent=-1!==V,F.firstKeyFramePTS=J)}}return this.ISGenerated&&(f.samples.length&&(K=m(f,D,this._initPTS,this._initDTS)),g.samples.length&&(k=i(g,D,this._initPTS))),{audio:U,video:F,initSegment:N,independent:w,text:k,id3:K}},t.generateIS=function(u,n,f){var U,N,k,g=u.samples,D=n.samples,L=this.typeSupported,P={},B=!Object(C.isFiniteNumber)(this._initPTS),F="audio/mp4";if(B&&(U=N=1/0),u.config&&g.length&&("mp3"===(u.timescale=u.samplerate,u.segmentCodec)&&(L.mpeg?(F="audio/mpeg",u.codec=""):L.mp3&&(u.codec="mp3")),P.audio={id:"audio",container:F,codec:u.codec,initSegment:"mp3"===u.segmentCodec&&L.mpeg?new Uint8Array(0):A.default.initSegment([u]),metadata:{channelCount:u.channelCount}},B&&(k=u.inputTimeScale,U=N=g[0].pts-Math.round(k*f))),n.sps&&n.pps&&D.length&&(n.timescale=n.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:A.default.initSegment([n]),metadata:{width:n.width,height:n.height}},B)){k=n.inputTimeScale;var K=this.getVideoStartPts(D),w=Math.round(k*f);N=Math.min(N,a(D[0].dts,K)-w),U=Math.min(U,K-w)}if(Object.keys(P).length)return this.ISGenerated=!0,B&&(this._initPTS=U,this._initDTS=N),{tracks:P,initPTS:U,timescale:k}},t.remuxVideo=function(u,n,f,g){var K,w,D=u.inputTimeScale,L=u.samples,P=[],B=L.length,F=this._initPTS,U=this.nextAvcDts,N=8,k=this.videoSampleDuration,W=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,_=!1;f&&null!==U||(U=n*D-(L[0].pts-a(L[0].dts,L[0].pts)));for(var X=0;X<B;X++){var H=L[X];H.pts=a(H.pts-F,U),H.dts=a(H.dts-F,U),H.dts<L[X>0?X-1:X].dts&&(_=!0)}_&&L.sort(function(be,ke){return be.dts-ke.dts||be.pts-ke.pts});var $=L[L.length-1].dts-(K=L[0].dts),Q=$?Math.round($/(B-1)):k||u.inputTimeScale/30;if(f){var V=K-U,J=V>Q;if(J||V<-1){I.logger.warn(J?"AVC: "+Object(E.toMsFromMpegTsClock)(V,!0)+" ms ("+V+"dts) hole between fragments detected, filling it":"AVC: "+Object(E.toMsFromMpegTsClock)(-V,!0)+" ms ("+V+"dts) overlapping between fragments detected");var q=L[0].pts-V;L[0].dts=K=U,L[0].pts=q,I.logger.log("Video: First PTS/DTS adjusted: "+Object(E.toMsFromMpegTsClock)(q,!0)+"/"+Object(E.toMsFromMpegTsClock)(K,!0)+", delta: "+Object(E.toMsFromMpegTsClock)(V,!0)+" ms")}}K=Math.max(0,K);for(var oe=0,ee=0,ue=0;ue<B;ue++){for(var ne=L[ue],fe=ne.units,re=fe.length,de=0,ce=0;ce<re;ce++)de+=fe[ce].data.length;ee+=de,oe+=re,ne.length=de,ne.dts=Math.max(ne.dts,K),W=Math.min(ne.pts,W),j=Math.max(ne.pts,j)}w=L[B-1].dts;var he,ge=ee+4*oe+8;try{he=new Uint8Array(ge)}catch(be){return void this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge})}var ye=new DataView(he.buffer);ye.setUint32(0,ge),he.set(A.default.types.mdat,4);for(var le=!1,Te=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,se=Number.NEGATIVE_INFINITY,me=Number.NEGATIVE_INFINITY,ae=0;ae<B;ae++){for(var te=L[ae],xe=te.units,ve=0,De=0,Ie=xe.length;De<Ie;De++){var Ee=xe[De],Ce=Ee.data,Pe=Ee.data.byteLength;ye.setUint32(N,Pe),he.set(Ce,N+=4),N+=Pe,ve+=4+Pe}var Se=void 0;if(ae<B-1)k=L[ae+1].dts-te.dts,Se=L[ae+1].pts-te.pts;else{var Ae=this.config,Le=ae>0?te.dts-L[ae-1].dts:Q;if(Se=ae>0?te.pts-L[ae-1].pts:Q,Ae.stretchShortVideoTrack&&null!==this.nextAudioPts){var Re=Math.floor(Ae.maxBufferHole*D),Oe=(g?W+g*D:this.nextAudioPts)-te.pts;Oe>Re?((k=Oe-Le)<0?k=Le:le=!0,I.logger.log("[mp4-remuxer]: It is approximately "+Oe/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=Le}else k=Le}var we=Math.round(te.pts-te.dts);Te=Math.min(Te,k),se=Math.max(se,k),ie=Math.min(ie,Se),me=Math.max(me,Se),P.push(new r(te.key,k,ve,we))}if(P.length)if(y){if(y<70){var Be=P[0].flags;Be.dependsOn=2,Be.isNonSync=0}}else if(d&&me-ie<se-Te&&Q/se<.025&&0===P[0].cts){I.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Me=K,pe=0,Ue=P.length;pe<Ue;pe++){var Ne=Me+P[pe].duration;P[pe].duration=pe<Ue-1?Ne+P[pe+1].cts-(Me+P[pe].cts):pe?P[pe-1].duration:Q,P[pe].cts=0,Me=Ne}}console.assert(null!==k,"mp4SampleDuration must be computed"),this.nextAvcDts=U=w+(k=le||!k?Q:k),this.videoSampleDuration=k,this.isVideoContiguous=!0;var je={data1:A.default.moof(u.sequenceNumber++,K,o({},u,{samples:P})),data2:he,startPTS:W/D,endPTS:(j+k)/D,startDTS:K/D,endDTS:U/D,type:"video",hasAudio:!1,hasVideo:!0,nb:P.length,dropped:u.dropped};return u.samples=[],u.dropped=0,console.assert(he.length,"MDAT length must not be zero"),je},t.remuxAudio=function(u,n,f,g,D){var L=u.inputTimeScale,B=L/(u.samplerate?u.samplerate:L),F="aac"===u.segmentCodec?1024:1152,U=F*B,N=this._initPTS,k="mp3"===u.segmentCodec&&this.typeSupported.mpeg,K=[],w=void 0!==D,W=u.samples,j=k?0:8,_=this.nextAudioPts||-1,Y=n*L;if(this.isAudioContiguous=f=f||W.length&&_>0&&(g&&Math.abs(Y-_)<9e3||Math.abs(a(W[0].pts-N,Y)-_)<20*U),W.forEach(function(Ee){Ee.pts=a(Ee.pts-N,Y)}),!f||_<0){if(!(W=W.filter(function(Ee){return Ee.pts>=0})).length)return;_=0===D?0:g&&!w?Math.max(0,Y):W[0].pts}if("aac"===u.segmentCodec)for(var z=this.config.maxAudioFramesDrift,X=0,H=_;X<W.length;X++){var $=W[X],Q=$.pts,V=Q-H,J=Math.abs(1e3*V/L);if(V<=-z*U&&w)0===X&&(I.logger.warn("Audio frame @ "+(Q/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*V/L)+" ms."),this.nextAudioPts=_=H=Q);else if(V>=z*U&&J<1e4&&w){var Z=Math.round(V/U);(H=Q-Z*U)<0&&(Z--,H+=U),0===X&&(this.nextAudioPts=_=H),I.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(H/L).toFixed(3)+"s due to "+Math.round(1e3*V/L)+" ms gap.");for(var q=0;q<Z;q++){var oe=Math.max(H,0),ee=O.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);ee||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ee=$.unit.subarray()),W.splice(X,0,{unit:ee,pts:oe}),H+=U,X++}}$.pts=H,H+=U}for(var fe,ue=null,ne=null,re=0,de=W.length;de--;)re+=W[de].unit.byteLength;for(var ce=0,ge=W.length;ce<ge;ce++){var he=W[ce],ye=he.unit,le=he.pts;if(null!==ne)K[ce-1].duration=Math.round((le-ne)/B);else{if(f&&"aac"===u.segmentCodec&&(le=_),ue=le,!(re>0))return;re+=j;try{fe=new Uint8Array(re)}catch(Ee){return void this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:re,reason:"fail allocating audio mdat "+re})}k||(new DataView(fe.buffer).setUint32(0,re),fe.set(A.default.types.mdat,4))}fe.set(ye,j);var se=ye.byteLength;j+=se,K.push(new r(!0,F,se,0)),ne=le}var me=K.length;if(me){this.nextAudioPts=_=ne+B*K[K.length-1].duration;var te=k?new Uint8Array(0):A.default.moof(u.sequenceNumber++,ue/B,o({},u,{samples:K}));u.samples=[];var xe=ue/L,ve=_/L,Ie={data1:te,data2:fe,startPTS:xe,endPTS:ve,startDTS:xe,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:me};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Ie}},t.remuxEmptyAudio=function(u,n,f,g){var D=u.inputTimeScale,B=this.nextAudioPts,F=(null!==B?B:g.startDTS*D)+this._initDTS,N=D/(u.samplerate?u.samplerate:D)*1024,k=Math.ceil((g.endDTS*D+this._initDTS-F)/N),K=O.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),K){for(var w=[],W=0;W<k;W++){var j=F+W*N;w.push({unit:K,pts:j,dts:j})}return u.samples=w,this.remuxAudio(u,n,f,!1)}I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},c}();function a(c,t){var s;if(null===t)return c;for(s=t<c?-8589934592:8589934592;Math.abs(c-t)>4294967296;)c+=s;return c}function m(c,t,s,u){var n=c.samples.length;if(n){for(var f=c.inputTimeScale,g=0;g<n;g++){var D=c.samples[g];D.pts=a(D.pts-s,t*f)/f,D.dts=a(D.dts-u,t*f)/f}var L=c.samples;return c.samples=[],{samples:L}}}function i(c,t,s){var u=c.samples.length;if(u){for(var n=c.inputTimeScale,f=0;f<u;f++){var g=c.samples[f];g.pts=a(g.pts-s,t*n)/n}c.samples.sort(function(L,P){return L.pts-P.pts});var D=c.samples;return c.samples=[],{samples:D}}}var r=function(t,s,u,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=s,this.size=u,this.cts=n,this.flags=new l(t)},l=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/remux/mp4-remuxer.ts"),A=S("./src/utils/mp4-tools.ts"),b=S("./src/loader/fragment.ts"),R=S("./src/utils/logger.ts");function v(E,o){var x=null==E?void 0:E.codec;return x&&x.length>4?x:"hvc1"===x||"hev1"===x?"hvc1.1.c.L120.90":"av01"===x?"av01.0.04M.08":"avc1"===x||o===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=function(){function E(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var o=E.prototype;return o.destroy=function(){},o.resetTimeStamp=function(p){this.initPTS=p,this.lastEndTime=null},o.resetNextTimestamp=function(){this.lastEndTime=null},o.resetInitSegment=function(p,T,y){this.audioCodec=T,this.videoCodec=y,this.generateInitSegment(p),this.emitInitSegment=!0},o.generateInitSegment=function(p){var T=this.audioCodec,y=this.videoCodec;if(!p||!p.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var d=this.initData=Object(A.parseInitSegment)(p);T||(T=v(d.audio,b.ElementaryStreamTypes.AUDIO)),y||(y=v(d.video,b.ElementaryStreamTypes.VIDEO));var e={};d.audio&&d.video?e.audiovideo={container:"video/mp4",codec:T+","+y,initSegment:p,id:"main"}:d.audio?e.audio={container:"audio/mp4",codec:T,initSegment:p,id:"audio"}:d.video?e.video={container:"video/mp4",codec:y,initSegment:p,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},o.remux=function(p,T,y,d,e){var a,h=this.initPTS,m=this.lastEndTime,i={audio:void 0,video:void 0,text:d,id3:y,initSegment:void 0};Object(C.isFiniteNumber)(m)||(m=this.lastEndTime=e||0);var r=T.samples;if(!r||!r.length)return i;var l={initPTS:void 0,timescale:1},c=this.initData;if((!c||!c.length)&&(this.generateInitSegment(r),c=this.initData),!c||!c.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(l.tracks=this.initTracks,this.emitInitSegment=!1);var t=Object(A.getStartDTS)(c,r);Object(C.isFiniteNumber)(h)||(this.initPTS=l.initPTS=h=t-e);var s=Object(A.getDuration)(r,c),u=p?t-h:m,n=u+s;Object(A.offsetStartDTS)(c,r,h),s>0?this.lastEndTime=n:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var f=!!c.audio,g=!!c.video,D="";f&&(D+="audio"),g&&(D+="video");var L={data1:r,startPTS:u,startDTS:u,endPTS:n,endDTS:n,type:D,hasAudio:f,hasVideo:g,nb:1,dropped:0};i.audio="audio"===L.type?L:void 0,i.video="audio"!==L.type?L:void 0,i.initSegment=l;var P=null!=(a=this.initPTS)?a:0;return i.id3=Object(O.flushTextTrackMetadataCueSamples)(y,e,P,P),d.samples.length&&(i.text=Object(O.flushTextTrackUserdataCueSamples)(d,e,P)),i},E}()},"./src/task-loop.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=O.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},A.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},A.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},A.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},O}()},"./src/types/cmcd.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"CMCDVersion",function(){return C}),S.d(M,"CMCDObjectType",function(){return O}),S.d(M,"CMCDStreamingFormat",function(){return A}),S.d(M,"CMCDStreamType",function(){return b});var C=1,O=(()=>{return(R=O||(O={})).MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o",O;var R})(),A=(()=>{return(R=A||(A={})).DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o",A;var R})(),b=(()=>{return(R=b||(b={})).VOD="v",R.LIVE="l",b;var R})()},"./src/types/demuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"MetadataSchema",function(){return C});var C=(()=>{return(O=C||(C={})).audioId3="org.id3",O.dateRange="com.apple.quicktime.HLS",O.emsg="https://aomedia.org/emsg/ID3",C;var O})()},"./src/types/level.ts":function(G,M,S){"use strict";function C(v,E){for(var o=0;o<E.length;o++){var x=E[o];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(v,x.key,x)}}S.r(M),S.d(M,"HlsSkip",function(){return A}),S.d(M,"getSkipValue",function(){return b}),S.d(M,"HlsUrlParameters",function(){return R}),S.d(M,"Level",function(){return I});var A=(()=>{return(v=A||(A={})).No="",v.Yes="YES",v.v2="v2",A;var v})();function b(v,E){var o=v.canSkipUntil;return o&&(void 0!==E?E-v.endSN:0)<o?v.canSkipDateRanges?A.v2:A.Yes:A.No}var R=function(){function v(o,x,p){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=o,this.part=x,this.skip=p}return v.prototype.addDirectives=function(x){var p=new self.URL(x);return void 0!==this.msn&&p.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&p.searchParams.set("_HLS_part",this.part.toString()),this.skip&&p.searchParams.set("_HLS_skip",this.skip),p.toString()},v}(),I=function(){function v(E){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[E.url],this.attrs=E.attrs,this.bitrate=E.bitrate,E.details&&(this.details=E.details),this.id=E.id||0,this.name=E.name,this.width=E.width||0,this.height=E.height||0,this.audioCodec=E.audioCodec,this.videoCodec=E.videoCodec,this.unknownCodecs=E.unknownCodecs,this.codecSet=[E.videoCodec,E.audioCodec].filter(function(o){return o}).join(",").replace(/\.[^.,]+/g,"")}return function O(v,E,o){return E&&C(v.prototype,E),o&&C(v,o),Object.defineProperty(v,"prototype",{writable:!1}),v}(v,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(o){var x=o%this.url.length;this._urlId!==x&&(this.details=void 0,this._urlId=x)}}]),v}()},"./src/types/loader.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"PlaylistContextType",function(){return C}),S.d(M,"PlaylistLevelType",function(){return O});var C=(()=>{return(A=C||(C={})).MANIFEST="manifest",A.LEVEL="level",A.AUDIO_TRACK="audioTrack",A.SUBTITLE_TRACK="subtitleTrack",C;var A})(),O=(()=>{return(A=O||(O={})).MAIN="main",A.AUDIO="audio",A.SUBTITLE="subtitle",O;var A})()},"./src/types/transmuxer.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"ChunkMetadata",function(){return C});var C=function(b,R,I,v,E,o){void 0===v&&(v=0),void 0===E&&(E=-1),void 0===o&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=b,this.sn=R,this.id=I,this.size=v,this.part=E,this.partial=o}},"./src/utils/attr-list.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"AttrList",function(){return A});var C=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function b(I){for(var v in"string"==typeof I&&(I=b.parseAttrList(I)),I)I.hasOwnProperty(v)&&(this[v]=I[v])}var R=b.prototype;return R.decimalInteger=function(v){var E=parseInt(this[v],10);return E>Number.MAX_SAFE_INTEGER?1/0:E},R.hexadecimalInteger=function(v){if(this[v]){var E=(this[v]||"0x").slice(2);E=(1&E.length?"0":"")+E;for(var o=new Uint8Array(E.length/2),x=0;x<E.length/2;x++)o[x]=parseInt(E.slice(2*x,2*x+2),16);return o}return null},R.hexadecimalIntegerAsNumber=function(v){var E=parseInt(this[v],16);return E>Number.MAX_SAFE_INTEGER?1/0:E},R.decimalFloatingPoint=function(v){return parseFloat(this[v])},R.optionalFloat=function(v,E){var o=this[v];return o?parseFloat(o):E},R.enumeratedString=function(v){return this[v]},R.bool=function(v){return"YES"===this[v]},R.decimalResolution=function(v){var E=C.exec(this[v]);if(null!==E)return{width:parseInt(E[1],10),height:parseInt(E[2],10)}},b.parseAttrList=function(v){var E,o={};for(O.lastIndex=0;null!==(E=O.exec(v));){var p=E[2];0===p.indexOf('"')&&p.lastIndexOf('"')===p.length-1&&(p=p.slice(1,-1)),o[E[1]]=p}return o},b}()},"./src/utils/binary-search.ts":function(G,M,S){"use strict";S.r(M),M.default={search:function(A,b){for(var R=0,I=A.length-1,v=null,E=null;R<=I;){var o=b(E=A[v=(R+I)/2|0]);if(o>0)R=v+1;else{if(!(o<0))return E;I=v-1}}return null}}},"./src/utils/buffer-helper.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"BufferHelper",function(){return A});var C=S("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function b(){}return b.isBuffered=function(I,v){try{if(I)for(var E=b.getBuffered(I),o=0;o<E.length;o++)if(v>=E.start(o)&&v<=E.end(o))return!0}catch(x){}return!1},b.bufferInfo=function(I,v,E){try{if(I){var p,o=b.getBuffered(I),x=[];for(p=0;p<o.length;p++)x.push({start:o.start(p),end:o.end(p)});return this.bufferedInfo(x,v,E)}}catch(T){}return{len:0,start:v,end:v,nextStart:void 0}},b.bufferedInfo=function(I,v,E){v=Math.max(0,v),I.sort(function(r,l){return r.start-l.start||l.end-r.end});var o=[];if(E)for(var x=0;x<I.length;x++){var p=o.length;if(p){var T=o[p-1].end;I[x].start-T<E?I[x].end>T&&(o[p-1].end=I[x].end):o.push(I[x])}else o.push(I[x])}else o=I;for(var d,y=0,e=v,a=v,h=0;h<o.length;h++){var m=o[h].start,i=o[h].end;if(v+E>=m&&v<i)e=m,y=(a=i)-v;else if(v+E<m){d=m;break}}return{len:y,start:e||0,end:a||0,nextStart:d}},b.getBuffered=function(I){try{return I.buffered}catch(v){return C.logger.log("failed to get media.buffered",v),O}},b}()},"./src/utils/cea-608-parser.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"Row",function(){return a}),S.d(M,"CaptionScreen",function(){return h});var C=S("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A=function(s){var u=s;return O.hasOwnProperty(s)&&(u=O[s]),String.fromCharCode(u)},b=15,R=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},v={17:2,18:4,21:6,22:8,23:10,19:13,20:15},E={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},o={25:2,26:4,29:6,30:8,31:10,27:13,28:15},x=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],p=(()=>{return(t=p||(p={}))[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA",p;var t})(),T=function(){function t(){this.time=null,this.verboseLevel=p.ERROR}return t.prototype.log=function(n,f){this.verboseLevel>=n&&C.logger.log(this.time+" ["+n+"] "+f)},t}(),y=function(s){for(var u=[],n=0;n<s.length;n++)u.push(s[n].toString(16));return u},d=function(){function t(u,n,f,g,D){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=u||"white",this.underline=n||!1,this.italics=f||!1,this.background=g||"black",this.flash=D||!1}var s=t.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(n){for(var f=["foreground","underline","italics","background","flash"],g=0;g<f.length;g++){var D=f[g];n.hasOwnProperty(D)&&(this[D]=n[D])}},s.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},s.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},s.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),e=function(){function t(u,n,f,g,D,L){this.uchar=void 0,this.penState=void 0,this.uchar=u||" ",this.penState=new d(n,f,g,D,L)}var s=t.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(n,f){this.uchar=n,this.penState.copy(f)},s.setPenState=function(n){this.penState.copy(n)},s.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},s.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},s.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),a=function(){function t(u){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var n=0;n<R;n++)this.chars.push(new e);this.logger=u,this.pos=0,this.currPenState=new d}var s=t.prototype;return s.equals=function(n){for(var f=!0,g=0;g<R;g++)if(!this.chars[g].equals(n.chars[g])){f=!1;break}return f},s.copy=function(n){for(var f=0;f<R;f++)this.chars[f].copy(n.chars[f])},s.isEmpty=function(){for(var n=!0,f=0;f<R;f++)if(!this.chars[f].isEmpty()){n=!1;break}return n},s.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(p.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(p.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},s.moveCursor=function(n){var f=this.pos+n;if(n>1)for(var g=this.pos+1;g<f+1;g++)this.chars[g].setPenState(this.currPenState);this.setCursor(f)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(n){n>=144&&this.backSpace();var f=A(n);this.pos>=R?this.logger.log(p.ERROR,"Cannot insert "+n.toString(16)+" ("+f+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(f,this.currPenState),this.moveCursor(1))},s.clearFromPos=function(n){var f;for(f=n;f<R;f++)this.chars[f].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var n=[],f=!0,g=0;g<R;g++){var D=this.chars[g].uchar;" "!==D&&(f=!1),n.push(D)}return f?"":n.join("")},s.setPenStyles=function(n){this.currPenState.setStyles(n),this.chars[this.pos].setPenState(this.currPenState)},t}(),h=function(){function t(u){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var n=0;n<b;n++)this.rows.push(new a(u));this.logger=u,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=t.prototype;return s.reset=function(){for(var n=0;n<b;n++)this.rows[n].clear();this.currRow=14},s.equals=function(n){for(var f=!0,g=0;g<b;g++)if(!this.rows[g].equals(n.rows[g])){f=!1;break}return f},s.copy=function(n){for(var f=0;f<b;f++)this.rows[f].copy(n.rows[f])},s.isEmpty=function(){for(var n=!0,f=0;f<b;f++)if(!this.rows[f].isEmpty()){n=!1;break}return n},s.backSpace=function(){this.rows[this.currRow].backSpace()},s.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},s.insertChar=function(n){this.rows[this.currRow].insertChar(n)},s.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},s.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},s.setCursor=function(n){this.logger.log(p.INFO,"setCursor: "+n),this.rows[this.currRow].setCursor(n)},s.setPAC=function(n){this.logger.log(p.INFO,"pacData = "+JSON.stringify(n));var f=n.row-1;if(this.nrRollUpRows&&f<this.nrRollUpRows-1&&(f=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==f){for(var g=0;g<b;g++)this.rows[g].clear();var D=this.currRow+1-this.nrRollUpRows,L=this.lastOutputScreen;if(L){var P=L.rows[D].cueStartTime,B=this.logger.time;if(P&&null!==B&&P<B)for(var F=0;F<this.nrRollUpRows;F++)this.rows[f-this.nrRollUpRows+F+1].copy(L.rows[D+F])}}this.currRow=f;var U=this.rows[this.currRow];if(null!==n.indent){var k=Math.max(n.indent-1,0);U.setCursor(n.indent),n.color=U.chars[k].penState.foreground}this.setPen({foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1})},s.setBkgData=function(n){this.logger.log(p.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},s.setRollUpRows=function(n){this.nrRollUpRows=n},s.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(p.TEXT,this.getDisplayText());var f=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];f.clear(),this.rows.splice(this.currRow,0,f),this.logger.log(p.INFO,"Rolling up")}else this.logger.log(p.DEBUG,"roll_up but nrRollUpRows not set yet")},s.getDisplayText=function(n){n=n||!1;for(var f=[],g="",L=0;L<b;L++){var P=this.rows[L].getTextString();P&&f.push(n?"Row "+(L+1)+": '"+P+"'":P.trim())}return f.length>0&&(g=n?"["+f.join(" | ")+"]":f.join("\n")),g},s.getTextAndFormat=function(){return this.rows},t}(),m=function(){function t(u,n,f){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=u,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new h(f),this.nonDisplayedMemory=new h(f),this.lastOutputScreen=new h(f),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=f}var s=t.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(n){this.outputFilter=n},s.setPAC=function(n){this.writeScreen.setPAC(n)},s.setBkgData=function(n){this.writeScreen.setBkgData(n)},s.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(p.INFO,"MODE="+n),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},s.insertChars=function(n){for(var f=0;f<n.length;f++)this.writeScreen.insertChar(n[f]);this.logger.log(p.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(p.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(p.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(p.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(p.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(n){this.logger.log(p.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},s.ccFON=function(){this.logger.log(p.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(p.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(p.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(p.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(p.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(p.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(p.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(p.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(p.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(n){this.logger.log(p.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},s.ccMIDROW=function(n){var f={flash:!1};if(f.underline=n%2==1,f.italics=n>=46,f.italics)f.foreground="white";else{var g=Math.floor(n/2)-16;f.foreground=["white","green","blue","cyan","red","yellow","magenta"][g]}this.logger.log(p.INFO,"MIDROW: "+JSON.stringify(f)),this.writeScreen.setPen(f)},s.outputDataUpdate=function(n){void 0===n&&(n=!1);var f=this.logger.time;null!==f&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,f,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:f):this.cueStartTime=f,this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},t}();function r(t,s,u){u.a=t,u.b=s}function l(t,s,u){return u.a===t&&u.b===s}M.default=function(){function t(u,n,f){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var g=new T;this.channels=[null,new m(u,n,g),new m(u+1,f,g)],this.cmdHistory={a:null,b:null},this.logger=g}var s=t.prototype;return s.getHandler=function(n){return this.channels[n].getHandler()},s.setHandler=function(n,f){this.channels[n].setHandler(f)},s.addData=function(n,f){var g,D,L,P=!1;this.logger.time=n;for(var B=0;B<f.length;B+=2)if(L=127&f[B+1],0!=(D=127&f[B])||0!==L){if(this.logger.log(p.DATA,"["+y([f[B],f[B+1]])+"] -> ("+y([D,L])+")"),(g=this.parseCmd(D,L))||(g=this.parseMidrow(D,L)),g||(g=this.parsePAC(D,L)),g||(g=this.parseBackgroundAttributes(D,L)),!g&&(P=this.parseChars(D,L))){var F=this.currentChannel;F&&F>0?this.channels[F].insertChars(P):this.logger.log(p.WARNING,"No channel found yet. TEXT-MODE?")}!g&&!P&&this.logger.log(p.WARNING,"Couldn't parse cleaned data "+y([D,L])+" orig: "+y([f[B],f[B+1]]))}},s.parseCmd=function(n,f){var g=this.cmdHistory;if(!((20===n||28===n||21===n||29===n)&&f>=32&&f<=47||(23===n||31===n)&&f>=33&&f<=35))return!1;if(l(n,f,g))return r(null,null,g),this.logger.log(p.DEBUG,"Repeated command ("+y([n,f])+") is dropped"),!0;var P=20===n||21===n||23===n?1:2,B=this.channels[P];return 20===n||21===n||28===n||29===n?32===f?B.ccRCL():33===f?B.ccBS():34===f?B.ccAOF():35===f?B.ccAON():36===f?B.ccDER():37===f?B.ccRU(2):38===f?B.ccRU(3):39===f?B.ccRU(4):40===f?B.ccFON():41===f?B.ccRDC():42===f?B.ccTR():43===f?B.ccRTD():44===f?B.ccEDM():45===f?B.ccCR():46===f?B.ccENM():47===f&&B.ccEOC():B.ccTO(f-32),r(n,f,g),this.currentChannel=P,!0},s.parseMidrow=function(n,f){var g=0;if((17===n||25===n)&&f>=32&&f<=47){if((g=17===n?1:2)!==this.currentChannel)return this.logger.log(p.ERROR,"Mismatch channel in midrow parsing"),!1;var D=this.channels[g];return!!D&&(D.ccMIDROW(f),this.logger.log(p.DEBUG,"MIDROW ("+y([n,f])+")"),!0)}return!1},s.parsePAC=function(n,f){var D=this.cmdHistory;if(!((n>=17&&n<=23||n>=25&&n<=31)&&f>=64&&f<=127||(16===n||24===n)&&f>=64&&f<=95))return!1;if(l(n,f,D))return r(null,null,D),!0;var B=n<=23?1:2,F=this.channels[B];return!!F&&(F.setPAC(this.interpretPAC(f>=64&&f<=95?1===B?I[n]:E[n]:1===B?v[n]:o[n],f)),r(n,f,D),this.currentChannel=B,!0)},s.interpretPAC=function(n,f){var g,D={color:null,italics:!1,indent:null,underline:!1,row:n};return D.underline=1==(1&(g=f>95?f-96:f-64)),g<=13?D.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(g/2)]:g<=15?(D.italics=!0,D.color="white"):D.indent=4*Math.floor((g-16)/2),D},s.parseChars=function(n,f){var g,P,D=null,L=null;if(n>=25?(g=2,L=n-8):(g=1,L=n),L>=17&&L<=19?(this.logger.log(p.INFO,"Special char '"+A(P=17===L?f+80:18===L?f+112:f+144)+"' in channel "+g),D=[P]):n>=32&&n<=127&&(D=0===f?[n]:[n,f]),D){var B=y(D);this.logger.log(p.DEBUG,"Char codes =  "+B.join(",")),r(n,f,this.cmdHistory)}return D},s.parseBackgroundAttributes=function(n,f){if(!((16===n||24===n)&&f>=32&&f<=47||(23===n||31===n)&&f>=45&&f<=47))return!1;var L,P={};return 16===n||24===n?(L=Math.floor((f-32)/2),P.background=x[L],f%2==1&&(P.background=P.background+"_semi")):45===f?P.background="transparent":(P.foreground="black",47===f&&(P.underline=!0)),this.channels[n<=23?1:2].setBkgData(P),r(n,f,this.cmdHistory),!0},s.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var f=this.channels[n];f&&f.reset()}this.cmdHistory={a:null,b:null}},s.cueSplitAtTime=function(n){for(var f=0;f<this.channels.length;f++){var g=this.channels[f];g&&g.cueSplitAtTime(n)}},t}()},"./src/utils/codecs.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"isCodecType",function(){return O}),S.d(M,"isCodecSupportedInMp4",function(){return A});var C={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(b,R){var I=C[R];return!!I&&!0===I[b.slice(0,4)]}function A(b,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/utils/vttparser.ts"),O=S("./src/utils/webvtt-parser.ts"),A=S("./src/utils/texttrack-utils.ts"),b=/\s/;M.default={newCue:function(v,E,o,x){for(var T,y,d,e,a,p=[],h=self.VTTCue||self.TextTrackCue,m=0;m<x.rows.length;m++)if(d=!0,e=0,a="",!(T=x.rows[m]).isEmpty()){for(var i=0;i<T.chars.length;i++)b.test(T.chars[i].uchar)&&d?e++:(a+=T.chars[i].uchar,d=!1);T.cueStartTime=E,E===o&&(o+=1e-4),e>=16?e--:e++;var r=Object(C.fixLineBreaks)(a.trim()),l=Object(O.generateCueId)(E,o,r);(!v||!v.cues||!v.cues.getCueById(l))&&((y=new h(E,o,r)).id=l,y.line=m+1,y.align="left",y.position=10+Math.min(80,10*Math.floor(8*e/32)),p.push(y))}return v&&p.length&&(p.sort(function(c,t){return"auto"===c.line||"auto"===t.line?0:c.line>8&&t.line>8?t.line-c.line:c.line-t.line}),p.forEach(function(c){return Object(A.addCueToTrack)(v,c)})),p}}},"./src/utils/discontinuities.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"findFirstFragWithCC",function(){return b}),S.d(M,"shouldAlignOnDiscontinuities",function(){return R}),S.d(M,"findDiscontinuousReferenceFrag",function(){return I}),S.d(M,"adjustSlidingStart",function(){return E}),S.d(M,"alignStream",function(){return o}),S.d(M,"alignPDT",function(){return p}),S.d(M,"alignFragmentByPDTDelta",function(){return T}),S.d(M,"alignMediaPlaylistByPDT",function(){return y});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/logger.ts"),A=S("./src/controller/level-helper.ts");function b(d,e){for(var a=null,h=0,m=d.length;h<m;h++){var i=d[h];if(i&&i.cc===e){a=i;break}}return a}function R(d,e,a){return!(!e.details||!(a.endCC>a.startCC||d&&d.cc<a.startCC))}function I(d,e){var a=d.fragments,h=e.fragments;if(h.length&&a.length){var m=b(a,h[0].cc);if(m&&(!m||m.startPTS))return m;O.logger.log("No frag in previous level to align on")}else O.logger.log("No fragments to align")}function v(d,e){if(d){var a=d.start+e;d.start=d.startPTS=a,d.endPTS=a+d.duration}}function E(d,e){for(var a=e.fragments,h=0,m=a.length;h<m;h++)v(a[h],d);e.fragmentHint&&v(e.fragmentHint,d),e.alignedSliding=!0}function o(d,e,a){!e||(function x(d,e,a){if(R(d,a,e)){var h=I(a.details,e);h&&Object(C.isFiniteNumber)(h.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),E(h.start,e))}}(d,a,e),!a.alignedSliding&&e.details&&p(a,e.details),!a.alignedSliding&&e.details&&!a.skippedSegments&&Object(A.adjustSliding)(e.details,a))}function p(d,e){if(e.fragments.length&&d.hasProgramDateTime&&e.hasProgramDateTime){var a=e.fragments[0].programDateTime,h=d.fragments[0].programDateTime,m=(h-a)/1e3+e.fragments[0].start;m&&Object(C.isFiniteNumber)(m)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(h-a)+"ms, sliding:"+m.toFixed(3)+" "+d.url+" "),E(m,d))}}function T(d,e){var a=d.programDateTime;if(a){var h=(a-e)/1e3;d.start=d.startPTS=h,d.endPTS=h+d.duration}}function y(d,e){if(e.fragments.length&&d.hasProgramDateTime&&e.hasProgramDateTime){var m=e.fragments[0].programDateTime-1e3*e.fragments[0].start;d.fragments.forEach(function(i){T(i,m)}),d.fragmentHint&&T(d.fragmentHint,m),d.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/utils/ewma.ts");M.default=function(){function A(R,I,v){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=v,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new C.default(R),this.fast_=new C.default(I)}var b=A.prototype;return b.update=function(I,v){var E=this.slow_,o=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new C.default(I,E.getEstimate(),E.getTotalWeight())),this.fast_.halfLife!==v&&(this.fast_=new C.default(v,o.getEstimate(),o.getTotalWeight()))},b.sample=function(I,v){var o=(I=Math.max(I,this.minDelayMs_))/1e3,x=8*v/o;this.fast_.sample(o,x),this.slow_.sample(o,x)},b.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},A}()},"./src/utils/ewma.ts":function(G,M,S){"use strict";S.r(M),M.default=function(){function O(b,R,I){void 0===R&&(R=0),void 0===I&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=R,this.totalWeight_=I}var A=O.prototype;return A.sample=function(R,I){var v=Math.pow(this.alpha_,R);this.estimate_=I*(1-v)+v*this.estimate_,this.totalWeight_+=R},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},O}()},"./src/utils/fetch-loader.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"fetchSupported",function(){return T});var C=S("./src/polyfills/number.ts"),O=S("./src/loader/load-stats.ts"),A=S("./src/demux/chunk-cache.ts");function R(h){var m="function"==typeof Map?new Map:void 0;return R=function(r){if(null===r||!function E(h){return-1!==Function.toString.call(h).indexOf("[native code]")}(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==m){if(m.has(r))return m.get(r);m.set(r,l)}function l(){return I(r,arguments,x(this).constructor)}return l.prototype=Object.create(r.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o(l,r)},R(h)}function I(h,m,i){return(I=v()?Reflect.construct.bind():function(l,c,t){var s=[null];s.push.apply(s,c);var n=new(Function.bind.apply(l,s));return t&&o(n,t.prototype),n}).apply(null,arguments)}function v(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function o(h,m){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r})(h,m)}function x(h){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)})(h)}function p(){return p=Object.assign?Object.assign.bind():function(h){for(var m=1;m<arguments.length;m++){var i=arguments[m];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(h[r]=i[r])}return h},p.apply(this,arguments)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(h){}return!1}var y=function(){function h(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||e,this.controller=new self.AbortController,this.stats=new O.LoadStats}var m=h.prototype;return m.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},m.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},m.abort=function(){var r;this.abortInternal(),null!==(r=this.callbacks)&&void 0!==r&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},m.load=function(r,l,c){var t=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var u=function d(h,m){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers(p({},h.headers))};return h.rangeEnd&&i.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),i}(r,this.controller.signal),n=c.onProgress,f="arraybuffer"===r.responseType,g=f?"byteLength":"length";this.context=r,this.config=l,this.callbacks=c,this.request=this.fetchSetup(r,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){t.abortInternal(),c.onTimeout(s,r,t.response)},l.timeout),self.fetch(this.request).then(function(D){if(t.response=t.loader=D,!D.ok)throw new a(D.statusText||"fetch, bad network response",D.status,D);return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(D.headers.get("Content-Length")||"0"),n&&Object(C.isFiniteNumber)(l.highWaterMark)?t.loadProgressively(D,s,r,l.highWaterMark,n):f?D.arrayBuffer():D.text()}).then(function(D){var L=t.response;self.clearTimeout(t.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=D[g];var P={url:L.url,data:D};n&&!Object(C.isFiniteNumber)(l.highWaterMark)&&n(s,r,D,L),c.onSuccess(P,s,r,L)}).catch(function(D){self.clearTimeout(t.requestTimeout),s.aborted||c.onError({code:D&&D.code||0,text:D?D.message:null},r,D?D.details:null)})},m.getCacheAge=function(){var r=null;if(this.response){var l=this.response.headers.get("age");r=l?parseFloat(l):null}return r},m.loadProgressively=function(r,l,c,t,s){void 0===t&&(t=0);var u=new A.default,n=r.body.getReader();return function g(){return n.read().then(function(D){if(D.done)return u.dataLength&&s(l,c,u.flush(),r),Promise.resolve(new ArrayBuffer(0));var L=D.value,P=L.length;return l.loaded+=P,P<t||u.dataLength?(u.push(L),u.dataLength>=t&&s(l,c,u.flush(),r)):s(l,c,L,r),g()}).catch(function(){return Promise.reject()})}()},h}();function e(h,m){return new self.Request(h.url,m)}var a=function(h){function m(i,r,l){var c;return(c=h.call(this,i)||this).code=void 0,c.details=void 0,c.code=r,c.details=l,c}return function b(h,m){h.prototype=Object.create(m.prototype),h.prototype.constructor=h,o(h,m)}(m,h),m}(R(Error));M.default=y},"./src/utils/imsc1-ttml-parser.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"IMSC1_CODEC",function(){return E}),S.d(M,"parseIMSC1",function(){return T});var C=S("./src/utils/mp4-tools.ts"),O=S("./src/utils/vttparser.ts"),A=S("./src/utils/vttcue.ts"),b=S("./src/demux/id3.ts"),R=S("./src/utils/timescale-conversion.ts"),I=S("./src/utils/webvtt-parser.ts");function v(){return v=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n])}return t},v.apply(this,arguments)}var E="stpp.ttml.im1t",o=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,x=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(t,s,u,n,f){var g=Object(C.findBox)(new Uint8Array(t),["mdat"]);if(0!==g.length){var D=g.map(function(P){return Object(b.utf8ArrayToStr)(P)}),L=Object(R.toTimescaleFromScale)(s,1,u);try{D.forEach(function(P){return n(function y(t,s){var f=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!f)throw new Error("Invalid ttml");var g={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},D=Object.keys(g).reduce(function(U,N){return U[N]=f.getAttribute("ttp:"+N)||g[N],U},{}),L="preserve"!==f.getAttribute("xml:space"),P=e(d(f,"styling","style")),B=e(d(f,"layout","region")),F=d(f,"body","[begin]");return[].map.call(F,function(U){var N=a(U,L);if(!N||!U.hasAttribute("begin"))return null;var k=r(U.getAttribute("begin"),D),K=r(U.getAttribute("dur"),D),w=r(U.getAttribute("end"),D);if(null===k)throw i(U);if(null===w){if(null===K)throw i(U);w=k+K}var W=new A.default(k-s,w-s,N);W.id=Object(I.generateCueId)(W.startTime,W.endTime,W.text);var j=B[U.getAttribute("region")],_=P[U.getAttribute("style")];W.position=10,W.size=80;var Y=function h(t,s,u){var n="http://www.w3.org/ns/ttml#styling",f=null,g=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],D=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return D&&u.hasOwnProperty(D)&&(f=u[D]),g.reduce(function(L,P){var B=m(s,n,P)||m(t,n,P)||m(f,n,P);return B&&(L[P]=B),L},{})}(j,_,P),z=Y.textAlign;if(z){var X=p[z];X&&(W.lineAlign=X),W.align=z}return v(W,Y),W}).filter(function(U){return null!==U})}(P,L))})}catch(P){f(P)}}else f(new Error("Could not parse IMSC1 mdat"))}function d(t,s,u){var n=t.getElementsByTagName(s)[0];return n?[].slice.call(n.querySelectorAll(u)):[]}function e(t){return t.reduce(function(s,u){var n=u.getAttribute("xml:id");return n&&(s[n]=u),s},{})}function a(t,s){return[].slice.call(t.childNodes).reduce(function(u,n,f){var g;return"br"===n.nodeName&&f?u+"\n":null!==(g=n.childNodes)&&void 0!==g&&g.length?a(n,s):s?u+n.textContent.trim().replace(/\s+/g," "):u+n.textContent},"")}function m(t,s,u){return t&&t.hasAttributeNS(s,u)?t.getAttributeNS(s,u):null}function i(t){return new Error("Could not parse ttml timestamp "+t)}function r(t,s){if(!t)return null;var u=Object(O.parseTimeStamp)(t);return null===u&&(o.test(t)?u=function l(t,s){var u=o.exec(t);return 3600*(0|u[1])+60*(0|u[2])+(0|u[3])+((0|u[4])+(0|u[5])/s.subFrameRate)/s.frameRate}(t,s):x.test(t)&&(u=function c(t,s){var u=x.exec(t),n=Number(u[1]);switch(u[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/s.frameRate;case"t":return n/s.tickRate}return n}(t,s))),u}},"./src/utils/logger.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"enableLogs",function(){return I}),S.d(M,"logger",function(){return v});var C=function(){},O={trace:C,debug:C,log:C,warn:C,info:C,error:C},A=O;function b(E){var o=self.console[E];return o?o.bind(self.console,"["+E+"] >"):C}function I(E){if(self.console&&!0===E||"object"==typeof E){!function R(E){for(var o=arguments.length,x=new Array(o>1?o-1:0),p=1;p<o;p++)x[p-1]=arguments[p];x.forEach(function(T){A[T]=E[T]?E[T].bind(E):b(T)})}(E,"debug","log","info","warn","error");try{A.log()}catch(o){A=O}}else A=O}var v=O},"./src/utils/mediakeys-helper.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"KeySystems",function(){return C}),S.d(M,"requestMediaKeySystemAccess",function(){return O});var C=(()=>{return(A=C||(C={})).WIDEVINE="com.widevine.alpha",A.PLAYREADY="com.microsoft.playready",C;var A})(),O="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(G,M,S){"use strict";function C(){return self.MediaSource||self.WebKitMediaSource}S.r(M),S.d(M,"getMediaSource",function(){return C})},"./src/utils/mp4-tools.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"RemuxerTrackIdConfig",function(){return I}),S.d(M,"bin2str",function(){return v}),S.d(M,"readUint16",function(){return E}),S.d(M,"readUint32",function(){return o}),S.d(M,"readSint32",function(){return x}),S.d(M,"writeUint32",function(){return p}),S.d(M,"findBox",function(){return T}),S.d(M,"parseSegmentIndex",function(){return y}),S.d(M,"parseInitSegment",function(){return d}),S.d(M,"getStartDTS",function(){return e}),S.d(M,"getDuration",function(){return a}),S.d(M,"computeRawDurationFromSamples",function(){return h}),S.d(M,"offsetStartDTS",function(){return m}),S.d(M,"segmentValidRange",function(){return i}),S.d(M,"appendUint8Array",function(){return r}),S.d(M,"parseSamples",function(){return l}),S.d(M,"parseSEIMessageFromNALu",function(){return s}),S.d(M,"parseEmsg",function(){return n});var C=S("./src/utils/typed-array.ts"),O=S("./src/loader/fragment.ts"),A=S("./src/demux/id3.ts"),b=Math.pow(2,32)-1,R=[].push,I={video:1,audio:2,id3:3,text:4};function v(f){return String.fromCharCode.apply(null,f)}function E(f,g){var D=f[g]<<8|f[g+1];return D<0?65536+D:D}function o(f,g){var D=x(f,g);return D<0?4294967296+D:D}function x(f,g){return f[g]<<24|f[g+1]<<16|f[g+2]<<8|f[g+3]}function p(f,g,D){f[g]=D>>24,f[g+1]=D>>16&255,f[g+2]=D>>8&255,f[g+3]=255&D}function T(f,g){var D=[];if(!g.length)return D;for(var L=f.byteLength,P=0;P<L;){var B=o(f,P),U=B>1?P+B:L;if(v(f.subarray(P+4,P+8))===g[0])if(1===g.length)D.push(f.subarray(P+8,U));else{var N=T(f.subarray(P+8,U),g.slice(1));N.length&&R.apply(D,N)}P=U}return D}function y(f){var g=[],D=f[0],L=8,P=o(f,L);L+=4;L+=0===D?8:16;var U=f.length+0,N=E(f,L+=2);L+=2;for(var k=0;k<N;k++){var K=L,w=o(f,K);K+=4;var W=2147483647&w;if(1==(2147483648&w)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var _=o(f,K);K+=4,g.push({referenceSize:W,subsegmentDuration:_,info:{duration:_/P,start:U,end:U+W-1}}),U+=W,L=K+=4}return{earliestPresentationTime:0,timescale:P,version:D,referencesCount:N,references:g}}function d(f){for(var g=[],D=T(f,["moov","trak"]),L=0;L<D.length;L++){var P=D[L],B=T(P,["tkhd"])[0];if(B){var F=B[0],U=0===F?12:20,N=o(B,U),k=T(P,["mdia","mdhd"])[0];if(k){var K=o(k,U=0===(F=k[0])?12:20),w=T(P,["mdia","hdlr"])[0];if(w){var W=v(w.subarray(8,12)),j={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[W];if(j){var _=T(P,["mdia","minf","stbl","stsd"])[0],Y=void 0;_&&(Y=v(_.subarray(12,16))),g[N]={timescale:K,type:j},g[j]={timescale:K,id:N,codec:Y}}}}}}return T(f,["moov","mvex","trex"]).forEach(function(X){var H=o(X,4),$=g[H];$&&($.default={duration:o(X,12),flags:o(X,20)})}),g}function e(f,g){return T(g,["moof","traf"]).reduce(function(D,L){var P=T(L,["tfdt"])[0],B=P[0],F=T(L,["tfhd"]).reduce(function(U,N){var k=o(N,4),K=f[k];if(K){var w=o(P,4);1===B&&(w*=Math.pow(2,32),w+=o(P,8));var j=w/(K.timescale||9e4);if(isFinite(j)&&(null===U||j<U))return j}return U},null);return null!==F&&isFinite(F)&&(null===D||F<D)?F:D},null)||0}function a(f,g){for(var D=0,L=0,P=0,B=T(f,["moof","traf"]),F=0;F<B.length;F++){var U=B[F],N=T(U,["tfhd"])[0],K=g[o(N,4)];if(K){var w=K.default,W=o(N,0)|(null==w?void 0:w.flags),j=null==w?void 0:w.duration;8&W&&(j=o(N,2&W?12:8));for(var _=K.timescale||9e4,Y=T(U,["trun"]),z=0;z<Y.length;z++)!(D=h(Y[z]))&&j&&(D=j*o(Y[z],4)),K.type===O.ElementaryStreamTypes.VIDEO?L+=D/_:K.type===O.ElementaryStreamTypes.AUDIO&&(P+=D/_)}}if(0===L&&0===P){for(var H=0,$=T(f,["sidx"]),Q=0;Q<$.length;Q++){var V=y($[Q]);null!=V&&V.references&&(H+=V.references.reduce(function(J,Z){return J+Z.info.duration||0},0))}return H}return L||P}function h(f){var g=o(f,0),D=8;1&g&&(D+=4),4&g&&(D+=4);for(var L=0,P=o(f,4),B=0;B<P;B++)256&g&&(L+=o(f,D),D+=4),512&g&&(D+=4),1024&g&&(D+=4),2048&g&&(D+=4);return L}function m(f,g,D){T(g,["moof","traf"]).forEach(function(L){T(L,["tfhd"]).forEach(function(P){var B=o(P,4),F=f[B];if(F){var U=F.timescale||9e4;T(L,["tfdt"]).forEach(function(N){var k=N[0],K=o(N,4);if(0===k)K-=D*U,p(N,4,K=Math.max(K,0));else{K*=Math.pow(2,32),K+=o(N,8),K-=D*U,K=Math.max(K,0);var w=Math.floor(K/(b+1)),W=Math.floor(K%(b+1));p(N,4,w),p(N,8,W)}})}})})}function i(f){var g={valid:null,remainder:null},D=T(f,["moof"]);if(!D)return g;if(D.length<2)return g.remainder=f,g;var L=D[D.length-1];return g.valid=Object(C.sliceUint8)(f,0,L.byteOffset-8),g.remainder=Object(C.sliceUint8)(f,L.byteOffset-8),g}function r(f,g){var D=new Uint8Array(f.length+g.length);return D.set(f),D.set(g,f.length),D}function l(f,g){var D=[],L=g.samples,P=g.timescale,B=g.id,F=!1;return T(L,["moof"]).map(function(N){var k=N.byteOffset-8;T(N,["traf"]).map(function(w){var W=T(w,["tfdt"]).map(function(j){var _=j[0],Y=o(j,4);return 1===_&&(Y*=Math.pow(2,32),Y+=o(j,8)),Y/P})[0];return void 0!==W&&(f=W),T(w,["tfhd"]).map(function(j){var _=o(j,4),Y=16777215&o(j,0),$=0,Q=0!=(16&Y),V=0,J=0!=(32&Y),Z=8;_===B&&(0!=(1&Y)&&(Z+=8),0!=(2&Y)&&(Z+=4),0!=(8&Y)&&($=o(j,Z),Z+=4),Q&&(V=o(j,Z),Z+=4),J&&(Z+=4),"video"===g.type&&(F=function c(f){if(!f)return!1;var g=f.indexOf("."),D=g<0?f:f.substring(0,g);return"hvc1"===D||"hev1"===D||"dvh1"===D||"dvhe"===D}(g.codec)),T(w,["trun"]).map(function(q){var oe=q[0],ee=16777215&o(q,0),ue=0!=(1&ee),ne=0,fe=0!=(4&ee),re=0!=(256&ee),de=0,ce=0!=(512&ee),ge=0,he=0!=(1024&ee),ye=0!=(2048&ee),le=0,Te=o(q,4),ie=8;ue&&(ne=o(q,ie),ie+=4),fe&&(ie+=4);for(var se=ne+k,me=0;me<Te;me++){if(re?(de=o(q,ie),ie+=4):de=$,ce?(ge=o(q,ie),ie+=4):ge=V,he&&(ie+=4),ye&&(le=0===oe?o(q,ie):x(q,ie),ie+=4),g.type===O.ElementaryStreamTypes.VIDEO)for(var ae=0;ae<ge;){var te=o(L,se);t(F,31&L[se+=4])&&s(L.subarray(se,se+te),f+le/P,D),se+=te,ae+=te+4}f+=de/P}}))})})}),D}function t(f,g){return f?39===g||40===g:6===g}function s(f,g,D){var L=function u(f){for(var g=f.byteLength,D=[],L=1;L<g-2;)0===f[L]&&0===f[L+1]&&3===f[L+2]?(D.push(L+2),L+=2):L++;if(0===D.length)return f;var P=g-D.length,B=new Uint8Array(P),F=0;for(L=0;L<P;F++,L++)F===D[0]&&(F++,D.shift()),B[L]=f[F];return B}(f),P=0;P++;for(var B=0,F=0,U=!1,N=0;P<L.length;){B=0;do{if(P>=L.length)break;B+=N=L[P++]}while(255===N);F=0;do{if(P>=L.length)break;F+=N=L[P++]}while(255===N);var k=L.length-P;if(!U&&4===B&&P<L.length){if(U=!0,181===L[P++]){var w=E(L,P);if(P+=2,49===w){var W=o(L,P);if(P+=4,1195456820===W){var j=L[P++];if(3===j){var _=L[P++],z=64&_,X=z?2+3*(31&_):0,H=new Uint8Array(X);if(z){H[0]=_;for(var $=1;$<X;$++)H[$]=L[P++]}D.push({type:j,payloadType:B,pts:g,bytes:H})}}}}}else if(5===B&&F<k){if(U=!0,F>16){for(var Q=[],V=0;V<16;V++){var J=L[P++].toString(16);Q.push(1==J.length?"0"+J:J),(3===V||5===V||7===V||9===V)&&Q.push("-")}for(var Z=F-16,q=new Uint8Array(Z),oe=0;oe<Z;oe++)q[oe]=L[P++];D.push({payloadType:B,pts:g,uuid:Q.join(""),userData:Object(A.utf8ArrayToStr)(q),userDataBytes:q})}}else if(F<k)P+=F;else if(F>k)break}}function n(f){var g=f[0],D="",L="",P=0,B=0,F=0,U=0,N=0,k=0;if(0===g){for(;"\0"!==v(f.subarray(k,k+1));)D+=v(f.subarray(k,k+1)),k+=1;for(D+=v(f.subarray(k,k+1)),k+=1;"\0"!==v(f.subarray(k,k+1));)L+=v(f.subarray(k,k+1)),k+=1;L+=v(f.subarray(k,k+1)),k+=1,P=o(f,12),B=o(f,16),U=o(f,20),N=o(f,24),k=28}else if(1===g){P=o(f,k+=4);var K=o(f,k+=4),w=o(f,k+=4);for(k+=4,F=Math.pow(2,32)*K+w,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),U=o(f,k),N=o(f,k+=4),k+=4;"\0"!==v(f.subarray(k,k+1));)D+=v(f.subarray(k,k+1)),k+=1;for(D+=v(f.subarray(k,k+1)),k+=1;"\0"!==v(f.subarray(k,k+1));)L+=v(f.subarray(k,k+1)),k+=1;L+=v(f.subarray(k,k+1)),k+=1}return{schemeIdUri:D,value:L,timeScale:P,presentationTime:F,presentationTimeDelta:B,eventDuration:U,id:N,payload:f.subarray(k,f.byteLength)}}},"./src/utils/output-filter.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=R}var A=O.prototype;return A.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(R,I,v){(null===this.startTime||this.startTime>R)&&(this.startTime=R),this.endTime=I,this.screen=v,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[],this.startTime=null},O}()},"./src/utils/texttrack-utils.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"sendAddTrackEvent",function(){return O}),S.d(M,"addCueToTrack",function(){return A}),S.d(M,"clearCurrentCues",function(){return b}),S.d(M,"removeCuesInRange",function(){return R}),S.d(M,"getCuesInRange",function(){return v});var C=S("./src/utils/logger.ts");function O(E,o){var x;try{x=new Event("addtrack")}catch(p){(x=document.createEvent("Event")).initEvent("addtrack",!1,!1)}x.track=E,o.dispatchEvent(x)}function A(E,o){var x=E.mode;if("disabled"===x&&(E.mode="hidden"),E.cues&&!E.cues.getCueById(o.id))try{if(E.addCue(o),!E.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(T){C.logger.debug("[texttrack-utils]: "+T);var p=new self.TextTrackCue(o.startTime,o.endTime,o.text);p.id=o.id,E.addCue(p)}"disabled"===x&&(E.mode=x)}function b(E){var o=E.mode;if("disabled"===o&&(E.mode="hidden"),E.cues)for(var x=E.cues.length;x--;)E.removeCue(E.cues[x]);"disabled"===o&&(E.mode=o)}function R(E,o,x,p){var T=E.mode;if("disabled"===T&&(E.mode="hidden"),E.cues&&E.cues.length>0)for(var y=v(E.cues,o,x),d=0;d<y.length;d++)(!p||p(y[d]))&&E.removeCue(y[d]);"disabled"===T&&(E.mode=T)}function v(E,o,x){var p=[],T=function I(E,o){if(o<E[0].startTime)return 0;var x=E.length-1;if(o>E[x].endTime)return-1;for(var p=0,T=x;p<=T;){var y=Math.floor((T+p)/2);if(o<E[y].startTime)T=y-1;else{if(!(o>E[y].startTime&&p<x))return y;p=y+1}}return E[p].startTime-o<o-E[T].startTime?p:T}(E,o);if(T>-1)for(var y=T,d=E.length;y<d;y++){var e=E[y];if(e.startTime>=o&&e.endTime<=x)p.push(e);else if(e.startTime>x)return p}return p}},"./src/utils/time-ranges.ts":function(G,M,S){"use strict";S.r(M),M.default={toString:function(A){for(var b="",R=A.length,I=0;I<R;I++)b+="["+A.start(I).toFixed(3)+","+A.end(I).toFixed(3)+"]";return b}}},"./src/utils/timescale-conversion.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"toTimescaleFromBase",function(){return O}),S.d(M,"toTimescaleFromScale",function(){return A}),S.d(M,"toMsFromMpegTsClock",function(){return b}),S.d(M,"toMpegTsClockFromTimescale",function(){return R});function O(I,v,E,o){void 0===E&&(E=1),void 0===o&&(o=!1);var x=I*v*E;return o?Math.round(x):x}function A(I,v,E,o){return void 0===E&&(E=1),void 0===o&&(o=!1),O(I,v,1/E,o)}function b(I,v){return void 0===v&&(v=!1),O(I,1e3,1/9e4,v)}function R(I,v){return void 0===v&&(v=1),O(I,9e4,1/v)}},"./src/utils/typed-array.ts":function(G,M,S){"use strict";function C(O,A,b){return Uint8Array.prototype.slice?O.slice(A,b):new Uint8Array(Array.prototype.slice.call(O,A,b))}S.r(M),S.d(M,"sliceUint8",function(){return C})},"./src/utils/vttcue.ts":function(G,M,S){"use strict";S.r(M),M.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var C=["","lr","rl"],O=["start","middle","end","left","right"];function A(E,o){if("string"!=typeof o||!Array.isArray(E))return!1;var x=o.toLowerCase();return!!~E.indexOf(x)&&x}function R(E){return A(O,E)}function I(E){for(var o=arguments.length,x=new Array(o>1?o-1:0),p=1;p<o;p++)x[p-1]=arguments[p];for(var T=1;T<arguments.length;T++){var y=arguments[T];for(var d in y)E[d]=y[d]}return E}function v(E,o,x){var p=this,T={enumerable:!0};p.hasBeenReset=!1;var y="",d=!1,e=E,a=o,h=x,m=null,i="",r=!0,l="auto",c="start",t=50,s="middle",u=50,n="middle";Object.defineProperty(p,"id",I({},T,{get:function(){return y},set:function(g){y=""+g}})),Object.defineProperty(p,"pauseOnExit",I({},T,{get:function(){return d},set:function(g){d=!!g}})),Object.defineProperty(p,"startTime",I({},T,{get:function(){return e},set:function(g){if("number"!=typeof g)throw new TypeError("Start time must be set to a number.");e=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"endTime",I({},T,{get:function(){return a},set:function(g){if("number"!=typeof g)throw new TypeError("End time must be set to a number.");a=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"text",I({},T,{get:function(){return h},set:function(g){h=""+g,this.hasBeenReset=!0}})),Object.defineProperty(p,"region",I({},T,{get:function(){return m},set:function(g){m=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"vertical",I({},T,{get:function(){return i},set:function(g){var D=function b(E){return A(C,E)}(g);if(!1===D)throw new SyntaxError("An invalid or illegal string was specified.");i=D,this.hasBeenReset=!0}})),Object.defineProperty(p,"snapToLines",I({},T,{get:function(){return r},set:function(g){r=!!g,this.hasBeenReset=!0}})),Object.defineProperty(p,"line",I({},T,{get:function(){return l},set:function(g){if("number"!=typeof g&&"auto"!==g)throw new SyntaxError("An invalid number or illegal string was specified.");l=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"lineAlign",I({},T,{get:function(){return c},set:function(g){var D=R(g);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");c=D,this.hasBeenReset=!0}})),Object.defineProperty(p,"position",I({},T,{get:function(){return t},set:function(g){if(g<0||g>100)throw new Error("Position must be between 0 and 100.");t=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"positionAlign",I({},T,{get:function(){return s},set:function(g){var D=R(g);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");s=D,this.hasBeenReset=!0}})),Object.defineProperty(p,"size",I({},T,{get:function(){return u},set:function(g){if(g<0||g>100)throw new Error("Size must be between 0 and 100.");u=g,this.hasBeenReset=!0}})),Object.defineProperty(p,"align",I({},T,{get:function(){return n},set:function(g){var D=R(g);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");n=D,this.hasBeenReset=!0}})),p.displayState=void 0}return v.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},v}()},"./src/utils/vttparser.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"parseTimeStamp",function(){return A}),S.d(M,"fixLineBreaks",function(){return o}),S.d(M,"VTTParser",function(){return x});var C=S("./src/utils/vttcue.ts"),O=function(){function p(){}return p.prototype.decode=function(d,e){if(!d)return"";if("string"!=typeof d)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(d))},p}();function A(p){function T(d,e,a,h){return 3600*(0|d)+60*(0|e)+(0|a)+parseFloat(h||0)}var y=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return y?parseFloat(y[2])>59?T(y[2],y[3],0,y[4]):T(y[1],y[2],y[3],y[4]):null}var b=function(){function p(){this.values=Object.create(null)}var T=p.prototype;return T.set=function(d,e){!this.get(d)&&""!==e&&(this.values[d]=e)},T.get=function(d,e,a){return a?this.has(d)?this.values[d]:e[a]:this.has(d)?this.values[d]:e},T.has=function(d){return d in this.values},T.alt=function(d,e,a){for(var h=0;h<a.length;++h)if(e===a[h]){this.set(d,e);break}},T.integer=function(d,e){/^-?\d+$/.test(e)&&this.set(d,parseInt(e,10))},T.percent=function(d,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var a=parseFloat(e);if(a>=0&&a<=100)return this.set(d,a),!0}return!1},p}();function R(p,T,y,d){var e=d?p.split(d):[p];for(var a in e)if("string"==typeof e[a]){var h=e[a].split(y);2===h.length&&T(h[0],h[1])}}var I=new C.default(0,0,""),v="middle"===I.align?"middle":"center";function E(p,T,y){var d=p;function e(){var m=A(p);if(null===m)throw new Error("Malformed timestamp: "+d);return p=p.replace(/^[^\sa-zA-Z-]+/,""),m}function h(){p=p.replace(/^\s+/,"")}if(h(),T.startTime=e(),h(),"--\x3e"!==p.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+d);p=p.slice(3),h(),T.endTime=e(),h(),function a(m,i){var r=new b;R(m,function(t,s){var u;switch(t){case"region":for(var n=y.length-1;n>=0;n--)if(y[n].id===s){r.set(t,y[n].region);break}break;case"vertical":r.alt(t,s,["rl","lr"]);break;case"line":u=s.split(","),r.integer(t,u[0]),r.percent(t,u[0])&&r.set("snapToLines",!1),r.alt(t,u[0],["auto"]),2===u.length&&r.alt("lineAlign",u[1],["start",v,"end"]);break;case"position":u=s.split(","),r.percent(t,u[0]),2===u.length&&r.alt("positionAlign",u[1],["start",v,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,s);break;case"align":r.alt(t,s,["start",v,"end","left","right"])}},/:/,/\s/),i.region=r.get("region",null),i.vertical=r.get("vertical","");var l=r.get("line","auto");"auto"===l&&-1===I.line&&(l=-1),i.line=l,i.lineAlign=r.get("lineAlign","start"),i.snapToLines=r.get("snapToLines",!0),i.size=r.get("size",100),i.align=r.get("align",v);var c=r.get("position","auto");"auto"===c&&50===I.position&&(c="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=c}(p,T)}function o(p){return p.replace(/<br(?: \/)?>/gi,"\n")}var x=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=p.prototype;return T.parse=function(d){var e=this;function a(){var c=e.buffer,t=0;for(c=o(c);t<c.length&&"\r"!==c[t]&&"\n"!==c[t];)++t;var s=c.slice(0,t);return"\r"===c[t]&&++t,"\n"===c[t]&&++t,e.buffer=c.slice(t),s}d&&(e.buffer+=e.decoder.decode(d,{stream:!0}));try{var m="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var i=(m=a()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var r=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:m=a(),e.state){case"HEADER":/:/.test(m)?R(m,function(t,s){},/:/):m||(e.state="ID");continue;case"NOTE":m||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(m)){e.state="NOTE";break}if(!m)continue;if(e.cue=new C.default(0,0,""),e.state="CUE",-1===m.indexOf("--\x3e")){e.cue.id=m;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{E(m,e.cue,e.regionList)}catch(c){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var l=-1!==m.indexOf("--\x3e");if(!m||l&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=m;continue;case"BADCUE":m||(e.state="ID")}}}catch(c){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var d=this;try{if((d.cue||"HEADER"===d.state)&&(d.buffer+="\n\n",d.parse()),"INITIAL"===d.state||"BADWEBVTT"===d.state)throw new Error("Malformed WebVTT signature.")}catch(e){d.onparsingerror&&d.onparsingerror(e)}return d.onflush&&d.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(G,M,S){"use strict";S.r(M),S.d(M,"generateCueId",function(){return x}),S.d(M,"parseWebVTT",function(){return T});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/vttparser.ts"),A=S("./src/demux/id3.ts"),b=S("./src/utils/timescale-conversion.ts"),R=S("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,v=function(d,e,a){return void 0===a&&(a=0),d.slice(a,a+e.length)===e},o=function(d){for(var e=5381,a=d.length;a;)e=33*e^d.charCodeAt(--a);return(e>>>0).toString()};function x(y,d,e){return o(y.toString())+o(d.toString())+o(e)}function T(y,d,e,a,h,m,i,r){var g,l=new O.VTTParser,c=Object(A.utf8ArrayToStr)(new Uint8Array(y)).trim().replace(I,"\n").split("\n"),t=[],s=Object(b.toMpegTsClockFromTimescale)(d,e),u="00:00.000",n=0,f=0,D=!0;l.oncue=function(L){var P=a[h],B=a.ccOffset,F=(n-s)/9e4;null!=P&&P.new&&(void 0!==f?B=a.ccOffset=P.start:function(d,e,a){var h=d[e],m=d[h.prevCC];if(!m||!m.new&&h.new)return d.ccOffset=d.presentationOffset=h.start,void(h.new=!1);for(;null!==(i=m)&&void 0!==i&&i.new;){var i;d.ccOffset+=h.start-m.start,h.new=!1,m=d[(h=m).prevCC]}d.presentationOffset=a}(a,h,F)),F&&(B=F-a.presentationOffset);var U=L.endTime-L.startTime,N=Object(R.normalizePts)(9e4*(L.startTime+B-f),9e4*m)/9e4;L.startTime=Math.max(N,0),L.endTime=Math.max(N+U,0);var k=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(k)),L.id||(L.id=x(L.startTime,L.endTime,k)),L.endTime>0&&t.push(L)},l.onparsingerror=function(L){g=L},l.onflush=function(){g?r(g):i(t)},c.forEach(function(L){if(D){if(v(L,"X-TIMESTAMP-MAP=")){D=!1,L.slice(16).split(",").forEach(function(P){v(P,"LOCAL:")?u=P.slice(6):v(P,"MPEGTS:")&&(n=parseInt(P.slice(7)))});try{f=function(d){var e=parseInt(d.slice(-3)),a=parseInt(d.slice(-6,-4)),h=parseInt(d.slice(-9,-7)),m=d.length>9?parseInt(d.substring(0,d.indexOf(":"))):0;if(!(Object(C.isFiniteNumber)(e)&&Object(C.isFiniteNumber)(a)&&Object(C.isFiniteNumber)(h)&&Object(C.isFiniteNumber)(m)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+d);return e+=1e3*a,(e+=6e4*h)+36e5*m}(u)/1e3}catch(P){g=P}return}""===L&&(D=!1)}l.parse(L+"\n")}),l.flush()}},"./src/utils/xhr-loader.ts":function(G,M,S){"use strict";S.r(M);var C=S("./src/utils/logger.ts"),O=S("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m;M.default=function(){function R(v){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=v?v.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var I=R.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var E=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),E&&(E.onreadystatechange=null,E.onprogress=null,4!==E.readyState&&(this.stats.aborted=!0,E.abort()))},I.abort=function(){var E;this.abortInternal(),null!==(E=this.callbacks)&&void 0!==E&&E.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(E,o,x){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=E,this.config=o,this.callbacks=x,this.retryDelay=o.retryDelay,this.loadInternal()},I.loadInternal=function(){var E=this.config,o=this.context;if(E){var x=this.loader=new self.XMLHttpRequest,p=this.stats;p.loading.first=0,p.loaded=0;var T=this.xhrSetup;try{if(T)try{T(x,o.url)}catch(e){x.open("GET",o.url,!0),T(x,o.url)}x.readyState||x.open("GET",o.url,!0);var y=this.context.headers;if(y)for(var d in y)x.setRequestHeader(d,y[d])}catch(e){return void this.callbacks.onError({code:x.status,text:e.message},o,x)}o.rangeEnd&&x.setRequestHeader("Range","bytes="+o.rangeStart+"-"+(o.rangeEnd-1)),x.onreadystatechange=this.readystatechange.bind(this),x.onprogress=this.loadprogress.bind(this),x.responseType=o.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout),x.send()}},I.readystatechange=function(){var E=this.context,o=this.loader,x=this.stats;if(E&&o){var p=o.readyState,T=this.config;if(!x.aborted&&p>=2)if(self.clearTimeout(this.requestTimeout),0===x.loading.first&&(x.loading.first=Math.max(self.performance.now(),x.loading.start)),4===p){o.onreadystatechange=null,o.onprogress=null;var y=o.status;if(y>=200&&y<300){var d,e;if(x.loading.end=Math.max(self.performance.now(),x.loading.first),e="arraybuffer"===E.responseType?(d=o.response).byteLength:(d=o.responseText).length,x.loaded=x.total=e,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(x,E,d,o),!this.callbacks)return;this.callbacks.onSuccess({url:o.responseURL,data:d},x,E,o)}else x.retry>=T.maxRetry||y>=400&&y<499?(C.logger.error(y+" while loading "+E.url),this.callbacks.onError({code:y,text:o.statusText},E,o)):(C.logger.warn(y+" while loading "+E.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),x.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},I.loadtimeout=function(){C.logger.warn("timeout while loading "+this.context.url);var E=this.callbacks;E&&(this.abortInternal(),E.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(E){var o=this.stats;o.loaded=E.loaded,E.lengthComputable&&(o.total=E.total)},I.getCacheAge=function(){var E=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var o=this.loader.getResponseHeader("age");E=o?parseFloat(o):null}return E},R}()}}).default)}}]);